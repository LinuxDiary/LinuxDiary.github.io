<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FTP Sever | 个人文档库</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="运维知识文档">
    
    <link rel="preload" href="/assets/css/0.styles.86682925.css" as="style"><link rel="preload" href="/assets/js/app.6ea617b8.js" as="script"><link rel="preload" href="/assets/js/2.6e381248.js" as="script"><link rel="preload" href="/assets/js/15.366e462e.js" as="script"><link rel="prefetch" href="/assets/js/10.dd27a2bb.js"><link rel="prefetch" href="/assets/js/11.ec440828.js"><link rel="prefetch" href="/assets/js/12.c67fbef0.js"><link rel="prefetch" href="/assets/js/13.a53b31f6.js"><link rel="prefetch" href="/assets/js/14.fac02fcf.js"><link rel="prefetch" href="/assets/js/16.ae609dff.js"><link rel="prefetch" href="/assets/js/17.7976f036.js"><link rel="prefetch" href="/assets/js/18.3f258419.js"><link rel="prefetch" href="/assets/js/19.0ad2626e.js"><link rel="prefetch" href="/assets/js/20.bdf3dbe2.js"><link rel="prefetch" href="/assets/js/21.04180477.js"><link rel="prefetch" href="/assets/js/22.f4cf519a.js"><link rel="prefetch" href="/assets/js/23.9e5b52cd.js"><link rel="prefetch" href="/assets/js/24.b0159ef8.js"><link rel="prefetch" href="/assets/js/25.e38d986a.js"><link rel="prefetch" href="/assets/js/26.b44e8359.js"><link rel="prefetch" href="/assets/js/27.164897ca.js"><link rel="prefetch" href="/assets/js/28.30c3dcb6.js"><link rel="prefetch" href="/assets/js/29.0ea1763d.js"><link rel="prefetch" href="/assets/js/3.87c14ff3.js"><link rel="prefetch" href="/assets/js/30.b6b9f227.js"><link rel="prefetch" href="/assets/js/31.d7d6e5fa.js"><link rel="prefetch" href="/assets/js/32.a71c64f7.js"><link rel="prefetch" href="/assets/js/33.6e421306.js"><link rel="prefetch" href="/assets/js/34.0f46b74a.js"><link rel="prefetch" href="/assets/js/35.1d02fd3c.js"><link rel="prefetch" href="/assets/js/36.fc5cc9cb.js"><link rel="prefetch" href="/assets/js/37.af7e5661.js"><link rel="prefetch" href="/assets/js/38.cdd11312.js"><link rel="prefetch" href="/assets/js/39.30bb1d36.js"><link rel="prefetch" href="/assets/js/4.91553c08.js"><link rel="prefetch" href="/assets/js/40.c4740fee.js"><link rel="prefetch" href="/assets/js/41.37a38f62.js"><link rel="prefetch" href="/assets/js/42.df5bcbd7.js"><link rel="prefetch" href="/assets/js/43.0c0ab294.js"><link rel="prefetch" href="/assets/js/44.1dcaa2ac.js"><link rel="prefetch" href="/assets/js/45.c3b4bbca.js"><link rel="prefetch" href="/assets/js/46.7659ce01.js"><link rel="prefetch" href="/assets/js/47.d6eb360d.js"><link rel="prefetch" href="/assets/js/48.ca9d607b.js"><link rel="prefetch" href="/assets/js/49.8c09eac0.js"><link rel="prefetch" href="/assets/js/5.6d5ca1ce.js"><link rel="prefetch" href="/assets/js/50.3694eddb.js"><link rel="prefetch" href="/assets/js/51.0868c6f4.js"><link rel="prefetch" href="/assets/js/52.513df7cc.js"><link rel="prefetch" href="/assets/js/53.9dcabf12.js"><link rel="prefetch" href="/assets/js/54.70a6c075.js"><link rel="prefetch" href="/assets/js/55.a1d14f80.js"><link rel="prefetch" href="/assets/js/56.7029bd26.js"><link rel="prefetch" href="/assets/js/57.1b116307.js"><link rel="prefetch" href="/assets/js/58.bb74acae.js"><link rel="prefetch" href="/assets/js/59.610e7d4f.js"><link rel="prefetch" href="/assets/js/6.ee71a04b.js"><link rel="prefetch" href="/assets/js/60.98e611f4.js"><link rel="prefetch" href="/assets/js/61.05109453.js"><link rel="prefetch" href="/assets/js/62.f4adfb83.js"><link rel="prefetch" href="/assets/js/63.b63e1591.js"><link rel="prefetch" href="/assets/js/64.1235f2bd.js"><link rel="prefetch" href="/assets/js/65.bfa7cab9.js"><link rel="prefetch" href="/assets/js/66.2574fbb1.js"><link rel="prefetch" href="/assets/js/67.09935f72.js"><link rel="prefetch" href="/assets/js/68.af1ee108.js"><link rel="prefetch" href="/assets/js/69.7a2f9a81.js"><link rel="prefetch" href="/assets/js/7.ed4c5699.js"><link rel="prefetch" href="/assets/js/70.605c490c.js"><link rel="prefetch" href="/assets/js/8.c8b45379.js"><link rel="prefetch" href="/assets/js/9.9d028748.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86682925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人文档库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CentOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CentOS/boot_order.html" class="sidebar-link">启动顺序</a></li><li><a href="/CentOS/system_initialization.html" class="sidebar-link">系统常用配置</a></li><li><a href="/CentOS/yum.html" class="sidebar-link">yum命令</a></li><li><a href="/CentOS/rpm.html" class="sidebar-link">rpm命令</a></li><li><a href="/CentOS/date_command_opstions.html" class="sidebar-link">date命令选项</a></li><li><a href="/CentOS/system_logs.html" class="sidebar-link">系统日志说明</a></li><li><a href="/CentOS/grep_sed_awk.html" class="sidebar-link">grep sed awk</a></li><li><a href="/CentOS/file_descriptor.html" class="sidebar-link">文件描述符</a></li><li><a href="/CentOS/stdin_stdout_stderr.html" class="sidebar-link">输入输出重定向</a></li><li><a href="/CentOS/iptables.html" class="sidebar-link">iptables</a></li><li><a href="/CentOS/sysctl.html" class="sidebar-link">sysctl基本优化</a></li><li><a href="/CentOS/load_balance.html" class="sidebar-link">双网卡绑定和负载均衡</a></li><li><a href="/CentOS/lvm.html" class="sidebar-link">lvm管理</a></li><li><a href="/CentOS/sendmail.html" class="sidebar-link">sendmail</a></li><li><a href="/CentOS/dns_server.html" class="sidebar-link">DNS Sever</a></li><li><a href="/CentOS/ftp_server.html" aria-current="page" class="active sidebar-link">FTP Sever</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#工作模式" class="sidebar-link">工作模式</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#宿主用户" class="sidebar-link">宿主用户</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#主配置文件" class="sidebar-link">主配置文件</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#chroot-list" class="sidebar-link">chroot_list</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#虚拟用户" class="sidebar-link">虚拟用户</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#selinux" class="sidebar-link">SELINUX</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#防火墙" class="sidebar-link">防火墙</a></li><li class="sidebar-sub-header"><a href="/CentOS/ftp_server.html#重启" class="sidebar-link">重启</a></li></ul></li><li><a href="/CentOS/nfs_server.html" class="sidebar-link">NFS Server</a></li><li><a href="/CentOS/ntp_server.html" class="sidebar-link">NTP Sever</a></li><li><a href="/CentOS/lsyncd.html" class="sidebar-link">lsyncd</a></li><li><a href="/CentOS/kvm_virtulization_deploy.html" class="sidebar-link">KVM</a></li><li><a href="/CentOS/vmware_extend_disk.html" class="sidebar-link">VMware虚拟机扩展磁盘容量</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/docker_app.html" class="sidebar-link">Docker应用</a></li><li><a href="/Docker/docker_compose_app.html" class="sidebar-link">Docker-Compose应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Nginx/" class="sidebar-link">介绍</a></li><li><a href="/Nginx/nginx_install.html" class="sidebar-link">安装</a></li><li><a href="/Nginx/nginx_config_files.html" class="sidebar-link">配置文件</a></li><li><a href="/Nginx/nginx_proxy.html" class="sidebar-link">反向代理</a></li><li><a href="/Nginx/nginx_max_clients.html" class="sidebar-link">并发数</a></li><li><a href="/Nginx/linux_optimization_for_nginx.html" class="sidebar-link">内核调优</a></li><li><a href="/Nginx/nginx_php_fpm.html" class="sidebar-link">使用PHP-FPM</a></li><li><a href="/Nginx/keepalived_nginx.html" class="sidebar-link">Keepalived + Nginx</a></li><li><a href="/Nginx/configs.html" class="sidebar-link">常用配置</a></li><li><a href="/Nginx/nginx_log_scripts.html" class="sidebar-link">nginx日志分析</a></li><li><a href="/Nginx/http_code.html" class="sidebar-link">HTTP状态码</a></li><li><a href="/Nginx/error_handle.html" class="sidebar-link">常见错误处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/MySQL/" class="sidebar-link">介绍</a></li><li><a href="/MySQL/mysql_installation.html" class="sidebar-link">安装</a></li><li><a href="/MySQL/variables.html" class="sidebar-link">参数</a></li><li><a href="/MySQL/command.html" class="sidebar-link">命令</a></li><li><a href="/MySQL/sql.html" class="sidebar-link">SQL</a></li><li><a href="/MySQL/mysql_scripts.html" class="sidebar-link">脚本</a></li><li><a href="/MySQL/log.html" class="sidebar-link">日志分类</a></li><li><a href="/MySQL/reset_password.html" class="sidebar-link">重置密码</a></li><li><a href="/MySQL/backup.html" class="sidebar-link">备份与恢复</a></li><li><a href="/MySQL/duplication.html" class="sidebar-link">主从复制</a></li><li><a href="/MySQL/optimization.html" class="sidebar-link">运行环境优化</a></li><li><a href="/MySQL/tools.html" class="sidebar-link">实时监控工具</a></li><li><a href="/MySQL/error_code.html" class="sidebar-link">常见错误代码</a></li><li><a href="/MySQL/errors.html" class="sidebar-link">错误处理</a></li><li><a href="/MySQL/innodb.html" class="sidebar-link">InnoDB特性</a></li><li><a href="/MySQL/duplication_case.html" class="sidebar-link">迁移案例</a></li><li><a href="/MySQL/mysql_innodb_cluster.html" class="sidebar-link">MySQL innodb cluster</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/install_python.html" class="sidebar-link">安装</a></li><li><a href="/Python/django_deployment.html" class="sidebar-link">Django项目部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Others/ffmpeg.html" class="sidebar-link">ffmpeg</a></li><li><a href="/Others/mac_tips.html" class="sidebar-link">Mac技巧</a></li><li><a href="/Others/raid_level.html" class="sidebar-link">Raid级别</a></li><li><a href="/Others/servers.html" class="sidebar-link">服务器规划</a></li><li><a href="/Others/memcached.html" class="sidebar-link">Memcached基础</a></li><li><a href="/Others/tomcat_deploy.html" class="sidebar-link">Tomcat部署</a></li><li><a href="/Others/tcp_handshake.html" class="sidebar-link">TCP三次握手四次挥手</a></li><li><a href="/Others/aria2_filebrowser.html" class="sidebar-link">Aria2 离线下载</a></li><li><a href="/Others/word_page_num.html" class="sidebar-link">Word页码编排</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ftp-sever"><a href="#ftp-sever" class="header-anchor">#</a> FTP Sever</h1> <h2 id="工作模式"><a href="#工作模式" class="header-anchor">#</a> 工作模式</h2> <p><strong>主动模式</strong></p> <ul><li>命令连接：客户端 &gt;1023端口 -&gt; 服务器 21端口</li> <li>数据连接：客户端 &gt;1023端口 &lt;- 服务器 20端口</li></ul> <p><strong>被动模式</strong></p> <ul><li>命令连接：客户端 &gt;1023端口 -&gt; 服务器 21端口</li> <li>数据连接：客户端 &gt;1023端口 -&gt; 服务器 &gt;1023端口</li></ul> <p>参考：<a href="https://www.cnblogs.com/xiaohh/p/4789813.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/xiaohh/p/4789813.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <table><thead><tr><th>配置文件</th> <th>说明</th></tr></thead> <tbody><tr><td>/etc/vsftpd/vsftpd.conf</td> <td>主配置文件</td></tr> <tr><td>/etc/vsftpd/ftpusers</td> <td>黑名单</td></tr> <tr><td>/etc/vsftpd/vsftpd_conf_migrate.sh</td> <td>迁移脚本</td></tr> <tr><td>/etc/vsftpd/user_list</td> <td>用户列表，与userlist_enbale和userlist_deny选项密切相关</td></tr></tbody></table> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>安装 <code>vsftpd</code> 以及 <code>Berkeley DB</code> (用于生成虚拟用户认证文件)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> vsftpd
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libdb-utils      <span class="token comment">#CentOS7是libdb-utils</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> db4 db4-utils    <span class="token comment">#CentOS6是db4-utils</span>
</code></pre></div><h2 id="宿主用户"><a href="#宿主用户" class="header-anchor">#</a> 宿主用户</h2> <p>创建宿主用户，即 <code>guest_username</code> ，所有虚拟用户都是映射宿主用户的目录权限。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">useradd</span> <span class="token parameter variable">-d</span> /var/vsftp <span class="token parameter variable">-s</span> /sbin/nologin vsftp
</code></pre></div><h2 id="主配置文件"><a href="#主配置文件" class="header-anchor">#</a> 主配置文件</h2> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># /etc/vsftpd/vsftpd.conf</span>

<span class="token comment">#关闭匿名访问</span>
<span class="token key attr-name">anonymous_enable</span><span class="token punctuation">=</span><span class="token value attr-value">NO</span>
<span class="token comment">#启用本地系统用户，包括虚拟用户</span>
<span class="token key attr-name">local_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token comment">#允许执行FTP命令，如果禁用，将不能进行上传、下载、删除、重命名等操作</span>
<span class="token key attr-name">write_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token comment">#本地用户umask值</span>
<span class="token key attr-name">local_umask</span><span class="token punctuation">=</span><span class="token value attr-value">022</span>
<span class="token key attr-name">dirmessage_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token comment">#启用日志</span>
<span class="token key attr-name">xferlog_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">xferlog_std_format</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token comment">#关闭ftp-data端口，相当于不使用主动模式</span>
<span class="token key attr-name">connect_from_port_20</span><span class="token punctuation">=</span><span class="token value attr-value">NO</span>
<span class="token comment">#限制用户不能离开FTP主目录，启用并设置例外用户清单</span>
<span class="token key attr-name">chroot_local_user</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">chroot_list_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">chroot_list_file</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/vsftpd/chroot_list</span>
<span class="token comment">#使用ipv4进行监听</span>
<span class="token key attr-name">listen</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">listen_ipv6</span><span class="token punctuation">=</span><span class="token value attr-value">NO</span>
<span class="token comment">#pam认证文件名称，位于/etc/pam.d/</span>
<span class="token key attr-name">pam_service_name</span><span class="token punctuation">=</span><span class="token value attr-value">vsftpd</span>
<span class="token comment">#启用全局用户例外清单</span>
<span class="token key attr-name">userlist_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token comment">#启用tcp封装</span>
<span class="token key attr-name">tcp_wrappers</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>

<span class="token comment">#虚拟用户权限是否与本地用户相同。为NO时，将与匿名用户的权限相同，在每个虚拟用户配置文件里设置匿名用户的选项等于虚拟用户的权限</span>
<span class="token key attr-name">virtual_use_local_privs</span><span class="token punctuation">=</span><span class="token value attr-value">NO</span>

<span class="token comment">#启用guest后，所有非匿名用户将映射到guest_username进行访问，包括本地系统用户也不能使用，并且转换成一个虚拟用户，与其他虚拟用户的配置方法一样</span>
<span class="token key attr-name">guest_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">guest_username</span><span class="token punctuation">=</span><span class="token value attr-value">vsftp</span>
<span class="token comment">#虚拟用户配置文件目录</span>
<span class="token key attr-name">user_config_dir</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/vsftpd/vuser_conf</span>
<span class="token comment">#启用pasv模式</span>
<span class="token key attr-name">pasv_enable</span><span class="token punctuation">=</span><span class="token value attr-value">YES</span>
<span class="token key attr-name">pasv_min_port</span><span class="token punctuation">=</span><span class="token value attr-value">33000</span>
<span class="token key attr-name">pasv_max_port</span><span class="token punctuation">=</span><span class="token value attr-value">34000</span>
</code></pre></div><p>其他选项参考：<a href="https://security.appspot.com/vsftpd/vsftpd_conf.html" target="_blank" rel="noopener noreferrer">https://security.appspot.com/vsftpd/vsftpd_conf.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="chroot-list"><a href="#chroot-list" class="header-anchor">#</a> chroot_list</h2> <p><code>chroot()</code> 会检查 <code>chroot_list</code> 文件，如果没有，连接 <code>FTP</code> 服务时会报错，提示找不到 <code>chroot_list</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> /etc/vsftpd/chroot_list
</code></pre></div><h2 id="虚拟用户"><a href="#虚拟用户" class="header-anchor">#</a> 虚拟用户</h2> <p><strong>虚拟用户列表文件</strong></p> <p>创建一个虚拟用户列表文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/etc/vsftpd/vuser
</code></pre></div><p>奇行为用户名，偶行为密码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ftpserver
<span class="token number">111111</span>
</code></pre></div><p><strong>虚拟用户认证文件</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>db_load <span class="token parameter variable">-T</span> <span class="token parameter variable">-t</span> <span class="token builtin class-name">hash</span> <span class="token parameter variable">-f</span> /etc/vsftpd/vuser /etc/vsftpd/vuser.db
<span class="token function">chmod</span> <span class="token number">600</span> /etc/vsftpd/vuser.db
</code></pre></div><p><strong>虚拟用户认证配置</strong></p> <p>在 <code>/etc/pam.d/vsftpd</code> 中注释掉其他本地用户认证的内容，因为启用了 <code>guest_enable</code> 后，本地用户将失效，所有非匿名用户变成虚拟用户</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/pam.d/vsftpd</span>

<span class="token comment"># system user</span>
<span class="token comment">#session    optional     pam_keyinit.so    force revoke</span>
<span class="token comment">#auth       required    pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span>
<span class="token comment">#auth       required    pam_shells.so</span>
<span class="token comment">#auth       include     password-auth</span>
<span class="token comment">#account    include     password-auth</span>
<span class="token comment">#session    required     pam_loginuid.so</span>
<span class="token comment">#session    include     password-auth</span>

<span class="token comment"># virtual user</span>
auth required /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/vuser
account required /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/vuser
</code></pre></div><p><strong>虚拟用户配置文件</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /etc/vsftpd/vuser_conf/
<span class="token function">touch</span> /etc/vsftpd/vuser_conf/ftpserver
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /etc/vsftpd/vuser_conf/ftpserver</span>

<span class="token assign-left variable">local_root</span><span class="token operator">=</span>/var/vsftp/ftpserver
<span class="token assign-left variable">anon_umask</span><span class="token operator">=</span>077
<span class="token assign-left variable">anon_world_readable_only</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_upload_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_mkdir_write_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_other_write_enable</span><span class="token operator">=</span>YES
</code></pre></div><p>其中虚拟用户的配置文件名称需要与 <code>/etc/vsftpd/vuser</code> 中配置的用户名对应，此处为 <code>ftpserver</code> ， <code>local_root</code> 为当前虚拟用户的根目录，且属主和属组都必须为最开始创建的宿主用户 <code>vsftp</code> 。在 <code>vsftpd</code> 主配置文件中已经规定，虚拟用户权限取匿名用户的权限配置，因此这里配置的以 <code>anon</code> 开头的选项都对应当前虚拟用户的权限。</p> <p><strong>虚拟用户主目录和权限</strong></p> <p>最新版 <code>vsftpd</code> 不允许用户主目录有 <code>w</code> 权限，因此在主目录下新建一个子目录，赋予 <code>700</code> 权限。所有上传、下载、删除、重命名等操作只能在子目录中进行</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/vsftp/ftpserver/newdir
<span class="token function">chown</span> <span class="token parameter variable">-R</span> vsftp.vsftp /var/vsftp
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">500</span> /var/vsftp
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">700</span> /var/vsftp/ftpserver/newdir
</code></pre></div><p><strong>删除虚拟用户</strong></p> <p>如果需要删除某个已经创建的虚拟用户，首先在 <code>/etc/vsftpd/vuser</code> 中删除用户密码配置，然后在 <code>/etc/vsftpd/vuser_conf/</code> 下删除对应虚拟用户的配置文件，最后删除 <code>/etc/vsftpd/vuser.db</code> 重新创建认证文件，然后重启服务 <code>systemctl restart vsftpd.service</code></p> <h2 id="selinux"><a href="#selinux" class="header-anchor">#</a> SELINUX</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>setsebool <span class="token parameter variable">-P</span> ftpd_full_access on
</code></pre></div><h2 id="防火墙"><a href="#防火墙" class="header-anchor">#</a> 防火墙</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">33000</span>:34000 <span class="token parameter variable">-j</span> ACCEPT
iptables-save <span class="token operator">&gt;</span>/etc/sysconfig/iptables
</code></pre></div><h2 id="重启"><a href="#重启" class="header-anchor">#</a> 重启</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl restart vsftpd.service
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CentOS/dns_server.html" class="prev">
        DNS Sever
      </a></span> <span class="next"><a href="/CentOS/nfs_server.html">
        NFS Server
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ea617b8.js" defer></script><script src="/assets/js/2.6e381248.js" defer></script><script src="/assets/js/15.366e462e.js" defer></script>
  </body>
</html>
