<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker应用 | 个人文档库</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="运维知识文档">
    
    <link rel="preload" href="/assets/css/0.styles.86682925.css" as="style"><link rel="preload" href="/assets/js/app.6ea617b8.js" as="script"><link rel="preload" href="/assets/js/2.6e381248.js" as="script"><link rel="preload" href="/assets/js/31.d7d6e5fa.js" as="script"><link rel="prefetch" href="/assets/js/10.dd27a2bb.js"><link rel="prefetch" href="/assets/js/11.ec440828.js"><link rel="prefetch" href="/assets/js/12.c67fbef0.js"><link rel="prefetch" href="/assets/js/13.a53b31f6.js"><link rel="prefetch" href="/assets/js/14.fac02fcf.js"><link rel="prefetch" href="/assets/js/15.366e462e.js"><link rel="prefetch" href="/assets/js/16.ae609dff.js"><link rel="prefetch" href="/assets/js/17.7976f036.js"><link rel="prefetch" href="/assets/js/18.3f258419.js"><link rel="prefetch" href="/assets/js/19.0ad2626e.js"><link rel="prefetch" href="/assets/js/20.bdf3dbe2.js"><link rel="prefetch" href="/assets/js/21.04180477.js"><link rel="prefetch" href="/assets/js/22.f4cf519a.js"><link rel="prefetch" href="/assets/js/23.9e5b52cd.js"><link rel="prefetch" href="/assets/js/24.b0159ef8.js"><link rel="prefetch" href="/assets/js/25.e38d986a.js"><link rel="prefetch" href="/assets/js/26.b44e8359.js"><link rel="prefetch" href="/assets/js/27.164897ca.js"><link rel="prefetch" href="/assets/js/28.30c3dcb6.js"><link rel="prefetch" href="/assets/js/29.0ea1763d.js"><link rel="prefetch" href="/assets/js/3.87c14ff3.js"><link rel="prefetch" href="/assets/js/30.b6b9f227.js"><link rel="prefetch" href="/assets/js/32.a71c64f7.js"><link rel="prefetch" href="/assets/js/33.6e421306.js"><link rel="prefetch" href="/assets/js/34.0f46b74a.js"><link rel="prefetch" href="/assets/js/35.1d02fd3c.js"><link rel="prefetch" href="/assets/js/36.fc5cc9cb.js"><link rel="prefetch" href="/assets/js/37.af7e5661.js"><link rel="prefetch" href="/assets/js/38.cdd11312.js"><link rel="prefetch" href="/assets/js/39.30bb1d36.js"><link rel="prefetch" href="/assets/js/4.91553c08.js"><link rel="prefetch" href="/assets/js/40.c4740fee.js"><link rel="prefetch" href="/assets/js/41.37a38f62.js"><link rel="prefetch" href="/assets/js/42.df5bcbd7.js"><link rel="prefetch" href="/assets/js/43.0c0ab294.js"><link rel="prefetch" href="/assets/js/44.1dcaa2ac.js"><link rel="prefetch" href="/assets/js/45.c3b4bbca.js"><link rel="prefetch" href="/assets/js/46.7659ce01.js"><link rel="prefetch" href="/assets/js/47.d6eb360d.js"><link rel="prefetch" href="/assets/js/48.ca9d607b.js"><link rel="prefetch" href="/assets/js/49.8c09eac0.js"><link rel="prefetch" href="/assets/js/5.6d5ca1ce.js"><link rel="prefetch" href="/assets/js/50.3694eddb.js"><link rel="prefetch" href="/assets/js/51.0868c6f4.js"><link rel="prefetch" href="/assets/js/52.513df7cc.js"><link rel="prefetch" href="/assets/js/53.9dcabf12.js"><link rel="prefetch" href="/assets/js/54.70a6c075.js"><link rel="prefetch" href="/assets/js/55.a1d14f80.js"><link rel="prefetch" href="/assets/js/56.7029bd26.js"><link rel="prefetch" href="/assets/js/57.1b116307.js"><link rel="prefetch" href="/assets/js/58.bb74acae.js"><link rel="prefetch" href="/assets/js/59.610e7d4f.js"><link rel="prefetch" href="/assets/js/6.ee71a04b.js"><link rel="prefetch" href="/assets/js/60.98e611f4.js"><link rel="prefetch" href="/assets/js/61.05109453.js"><link rel="prefetch" href="/assets/js/62.f4adfb83.js"><link rel="prefetch" href="/assets/js/63.b63e1591.js"><link rel="prefetch" href="/assets/js/64.1235f2bd.js"><link rel="prefetch" href="/assets/js/65.bfa7cab9.js"><link rel="prefetch" href="/assets/js/66.2574fbb1.js"><link rel="prefetch" href="/assets/js/67.09935f72.js"><link rel="prefetch" href="/assets/js/68.af1ee108.js"><link rel="prefetch" href="/assets/js/69.7a2f9a81.js"><link rel="prefetch" href="/assets/js/7.ed4c5699.js"><link rel="prefetch" href="/assets/js/70.605c490c.js"><link rel="prefetch" href="/assets/js/8.c8b45379.js"><link rel="prefetch" href="/assets/js/9.9d028748.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86682925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人文档库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CentOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CentOS/boot_order.html" class="sidebar-link">启动顺序</a></li><li><a href="/CentOS/system_initialization.html" class="sidebar-link">系统常用配置</a></li><li><a href="/CentOS/yum.html" class="sidebar-link">yum命令</a></li><li><a href="/CentOS/rpm.html" class="sidebar-link">rpm命令</a></li><li><a href="/CentOS/date_command_opstions.html" class="sidebar-link">date命令选项</a></li><li><a href="/CentOS/system_logs.html" class="sidebar-link">系统日志说明</a></li><li><a href="/CentOS/grep_sed_awk.html" class="sidebar-link">grep sed awk</a></li><li><a href="/CentOS/file_descriptor.html" class="sidebar-link">文件描述符</a></li><li><a href="/CentOS/stdin_stdout_stderr.html" class="sidebar-link">输入输出重定向</a></li><li><a href="/CentOS/iptables.html" class="sidebar-link">iptables</a></li><li><a href="/CentOS/sysctl.html" class="sidebar-link">sysctl基本优化</a></li><li><a href="/CentOS/load_balance.html" class="sidebar-link">双网卡绑定和负载均衡</a></li><li><a href="/CentOS/lvm.html" class="sidebar-link">lvm管理</a></li><li><a href="/CentOS/sendmail.html" class="sidebar-link">sendmail</a></li><li><a href="/CentOS/dns_server.html" class="sidebar-link">DNS Sever</a></li><li><a href="/CentOS/ftp_server.html" class="sidebar-link">FTP Sever</a></li><li><a href="/CentOS/nfs_server.html" class="sidebar-link">NFS Server</a></li><li><a href="/CentOS/ntp_server.html" class="sidebar-link">NTP Sever</a></li><li><a href="/CentOS/lsyncd.html" class="sidebar-link">lsyncd</a></li><li><a href="/CentOS/kvm_virtulization_deploy.html" class="sidebar-link">KVM</a></li><li><a href="/CentOS/vmware_extend_disk.html" class="sidebar-link">VMware虚拟机扩展磁盘容量</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/docker_app.html" aria-current="page" class="active sidebar-link">Docker应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#portainer" class="sidebar-link">Portainer</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#qbittorrent" class="sidebar-link">qbittorrent</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#zabbix-agent" class="sidebar-link">zabbix-agent</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#cloudreve" class="sidebar-link">cloudreve</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#kodbox" class="sidebar-link">kodbox</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#frp" class="sidebar-link">frp</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#vsftpd" class="sidebar-link">vsftpd</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#nginx-rtmp" class="sidebar-link">nginx-rtmp</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#mosquitto" class="sidebar-link">mosquitto</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#redis" class="sidebar-link">Redis</a></li><li class="sidebar-sub-header"><a href="/Docker/docker_app.html#mssql" class="sidebar-link">mssql</a></li></ul></li><li><a href="/Docker/docker_compose_app.html" class="sidebar-link">Docker-Compose应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Nginx/" class="sidebar-link">介绍</a></li><li><a href="/Nginx/nginx_install.html" class="sidebar-link">安装</a></li><li><a href="/Nginx/nginx_config_files.html" class="sidebar-link">配置文件</a></li><li><a href="/Nginx/nginx_proxy.html" class="sidebar-link">反向代理</a></li><li><a href="/Nginx/nginx_max_clients.html" class="sidebar-link">并发数</a></li><li><a href="/Nginx/linux_optimization_for_nginx.html" class="sidebar-link">内核调优</a></li><li><a href="/Nginx/nginx_php_fpm.html" class="sidebar-link">使用PHP-FPM</a></li><li><a href="/Nginx/keepalived_nginx.html" class="sidebar-link">Keepalived + Nginx</a></li><li><a href="/Nginx/configs.html" class="sidebar-link">常用配置</a></li><li><a href="/Nginx/nginx_log_scripts.html" class="sidebar-link">nginx日志分析</a></li><li><a href="/Nginx/http_code.html" class="sidebar-link">HTTP状态码</a></li><li><a href="/Nginx/error_handle.html" class="sidebar-link">常见错误处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/MySQL/" class="sidebar-link">介绍</a></li><li><a href="/MySQL/mysql_installation.html" class="sidebar-link">安装</a></li><li><a href="/MySQL/variables.html" class="sidebar-link">参数</a></li><li><a href="/MySQL/command.html" class="sidebar-link">命令</a></li><li><a href="/MySQL/sql.html" class="sidebar-link">SQL</a></li><li><a href="/MySQL/mysql_scripts.html" class="sidebar-link">脚本</a></li><li><a href="/MySQL/log.html" class="sidebar-link">日志分类</a></li><li><a href="/MySQL/reset_password.html" class="sidebar-link">重置密码</a></li><li><a href="/MySQL/backup.html" class="sidebar-link">备份与恢复</a></li><li><a href="/MySQL/duplication.html" class="sidebar-link">主从复制</a></li><li><a href="/MySQL/optimization.html" class="sidebar-link">运行环境优化</a></li><li><a href="/MySQL/tools.html" class="sidebar-link">实时监控工具</a></li><li><a href="/MySQL/error_code.html" class="sidebar-link">常见错误代码</a></li><li><a href="/MySQL/errors.html" class="sidebar-link">错误处理</a></li><li><a href="/MySQL/innodb.html" class="sidebar-link">InnoDB特性</a></li><li><a href="/MySQL/duplication_case.html" class="sidebar-link">迁移案例</a></li><li><a href="/MySQL/mysql_innodb_cluster.html" class="sidebar-link">MySQL innodb cluster</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/install_python.html" class="sidebar-link">安装</a></li><li><a href="/Python/django_deployment.html" class="sidebar-link">Django项目部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Others/ffmpeg.html" class="sidebar-link">ffmpeg</a></li><li><a href="/Others/mac_tips.html" class="sidebar-link">Mac技巧</a></li><li><a href="/Others/raid_level.html" class="sidebar-link">Raid级别</a></li><li><a href="/Others/servers.html" class="sidebar-link">服务器规划</a></li><li><a href="/Others/memcached.html" class="sidebar-link">Memcached基础</a></li><li><a href="/Others/tomcat_deploy.html" class="sidebar-link">Tomcat部署</a></li><li><a href="/Others/tcp_handshake.html" class="sidebar-link">TCP三次握手四次挥手</a></li><li><a href="/Others/aria2_filebrowser.html" class="sidebar-link">Aria2 离线下载</a></li><li><a href="/Others/word_page_num.html" class="sidebar-link">Word页码编排</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker应用"><a href="#docker应用" class="header-anchor">#</a> Docker应用</h1> <h2 id="portainer"><a href="#portainer" class="header-anchor">#</a> Portainer</h2> <p><strong>server</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9443</span>:9443 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> portainer <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/portainer/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/portainer/public:/public <span class="token punctuation">\</span>
portainer/portainer-ce:latest
</code></pre></div><p><strong>agent</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9001</span>:9001 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> portainer_agent <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/lib/docker/volumes:/var/lib/docker/volumes <span class="token punctuation">\</span>
portainer/agent:latest
</code></pre></div><h2 id="qbittorrent"><a href="#qbittorrent" class="header-anchor">#</a> qbittorrent</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>qbittorrent <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">WEBUIPORT</span><span class="token operator">=</span><span class="token number">82</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6881</span>:6881 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6881</span>:6881/udp <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">82</span>:82  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/qbittorrent/config:/config <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/qbittorrent/Downloads:/Downloads <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> unless-stopped <span class="token punctuation">\</span>
johngong/qbittorrent:latest
</code></pre></div><h2 id="zabbix-agent"><a href="#zabbix-agent" class="header-anchor">#</a> zabbix-agent</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> zabbix-agent <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token function">host</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ZBX_HOSTNAME</span><span class="token operator">=</span><span class="token string">&quot;Zabbix server&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ZBX_SERVER_HOST</span><span class="token operator">=</span><span class="token string">&quot;172.18.0.10&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\</span>
zabbix/zabbix-agent:alpine-5.0-latest
</code></pre></div><blockquote><p>监控本机的时候，ZBX_SERVER_HOST需填zabbix server的容器IP，而非宿主IP，且使用宿主机网络<code>--network host</code></p></blockquote> <h2 id="cloudreve"><a href="#cloudreve" class="header-anchor">#</a> cloudreve</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> cloudreve <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">&quot;Asia/Shanghai&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">81</span>:5212 <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/cloudreve/uploads:/cloudreve/uploads <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/cloudreve/config:/cloudreve/config <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/cloudreve/db:/cloudreve/db <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/cloudreve/avatar:/cloudreve/avatar <span class="token punctuation">\</span>
xavierniu/cloudreve
</code></pre></div><h2 id="kodbox"><a href="#kodbox" class="header-anchor">#</a> kodbox</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> kodbox <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/kodbox:/var/www/html <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> unless-stopped <span class="token punctuation">\</span>
kodcloud/kodbox
</code></pre></div><h2 id="frp"><a href="#frp" class="header-anchor">#</a> frp</h2> <p><strong>frps</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token function">host</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/frp/frps.ini:/etc/frp/frps.ini <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> frps <span class="token punctuation">\</span>
snowdreamtech/frps
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># frps.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">bind_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>
<span class="token key attr-name">vhost_http_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7070</span>
</code></pre></div><p><strong>frpc</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token function">host</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /etc/localtime:/etc/localtime <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/frp/frpc.ini:/etc/frp/frpc.ini <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> frpc <span class="token punctuation">\</span>
snowdreamtech/frpc
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment"># frpc.ini</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">x.x.x.x</span>
<span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">web</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">http</span>
<span class="token key attr-name">custom_domains</span> <span class="token punctuation">=</span> <span class="token value attr-value">x.x.x.x</span>
<span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">84</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">ssh</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">tcp</span>
<span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22</span>
<span class="token key attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">6000</span>
</code></pre></div><p>使用安全的TCP连接</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment">#受访问的内网ssh服务器</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">x.x.x.x</span>
<span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">secret_ssh</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">stcp</span>
<span class="token key attr-name">sk</span> <span class="token punctuation">=</span> <span class="token value attr-value">abc123  #安全访问key</span>
<span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22</span>
</code></pre></div><div class="language-ini extra-class"><pre class="language-ini"><code><span class="token comment">#发起访问请求的客户端PC</span>
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">x.x.x.x</span>
<span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">secret_ssh_visitor</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">stcp</span>
<span class="token key attr-name">role</span> <span class="token punctuation">=</span> <span class="token value attr-value">visitor</span>
<span class="token key attr-name">server_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">secret_ssh</span>
<span class="token key attr-name">sk</span> <span class="token punctuation">=</span> <span class="token value attr-value">abc123  #安全访问key</span>
<span class="token key attr-name">bind_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">bind_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">6000</span>
</code></pre></div><p>在Windows上可把frpc做成Windows服务，开机自启动，使用winsw</p> <blockquote><p>frpc下载地址：https://github.com/fatedier/frp/releases/download/v0.38.0/frp_0.38.0_windows_amd64.zip
https://github.91chifun.workers.dev/https://github.com//fatedier/frp/releases/download/v0.38.0/frp_0.38.0_windows_amd64.zip （加速）</p> <p>winsw下载地址：https://github.com/winsw/winsw/releases/download/v2.10.3/WinSW.NET4.exe
https://github.91chifun.workers.dev/https://github.com//winsw/winsw/releases/download/v2.10.3/WinSW.NET4.exe （加速）</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code>#winsw.xml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 该服务的唯一标识 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>frpc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 该服务的名称 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>frpc客户端<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 该服务的描述 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>frpc客户端 这个服务用 frpc 实现内网穿透<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 要运行的程序路径 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">&gt;</span></span>D:\frp_0.38.0_windows_amd64\frpc.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 携带的参数 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arguments</span><span class="token punctuation">&gt;</span></span>-c D:\frp_0.38.0_windows_amd64\frpc.ini<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arguments</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 第一次启动失败 60秒重启 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onfailure</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>restart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>60 sec<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 第二次启动失败 120秒后重启 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onfailure</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>restart<span class="token punctuation">&quot;</span></span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120 sec<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 日志模式 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logmode</span><span class="token punctuation">&gt;</span></span>append<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logmode</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定日志文件目录(相对于executable配置的路径) --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logpath</span><span class="token punctuation">&gt;</span></span>D:\frp_0.38.0_windows_amd64\logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logpath</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>把winsw和winsw.xml放置同一目录下</p> <div class="language-sh extra-class"><pre class="language-sh"><code>winsw.exe <span class="token function">install</span>  <span class="token comment">#注册服务</span>
winsw.exe uninstall  <span class="token comment">#卸载服务</span>
winsw.exe start  <span class="token comment">#启动服务</span>
winsw.exe stop  <span class="token comment">#停止服务</span>
winsw.exe restart  <span class="token comment">#重启服务</span>
winsw.exe status  <span class="token comment">#查看状态</span>
</code></pre></div><p>服务启动以后，连接ssh服务器，IP和端口在本机frpc.ini中配置</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">ssh</span> <span class="token number">127.0</span>.0.1 <span class="token number">6000</span>
</code></pre></div><h2 id="vsftpd"><a href="#vsftpd" class="header-anchor">#</a> vsftpd</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/vsftpd:/home/vsftpd <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">20</span>:20 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">21</span>:21 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">21000</span>-21007:21000-21007 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">FTP_USER</span><span class="token operator">=</span>rootadmin <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">FTP_PASS</span><span class="token operator">=</span>Abc@123456 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PASV_ADDRESS</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PASV_MIN_PORT</span><span class="token operator">=</span><span class="token number">21100</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PASV_MAX_PORT</span><span class="token operator">=</span><span class="token number">21110</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> vsftpd <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
fauria/vsftpd
</code></pre></div><h2 id="nginx-rtmp"><a href="#nginx-rtmp" class="header-anchor">#</a> nginx-rtmp</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1935</span>:1935 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> nginx-rtmp <span class="token punctuation">\</span>
alfg/nginx-rtmp
</code></pre></div><p>nginx配置文件位置：/etc/nginx/nginx.conf</p> <h2 id="mosquitto"><a href="#mosquitto" class="header-anchor">#</a> mosquitto</h2> <p>映射文件时需要提前创建</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /root/u01/mosquitto/<span class="token punctuation">{</span>config,data,log<span class="token punctuation">}</span>
<span class="token function">touch</span> /root/u01/mosquitto/config/mosquitto.conf
</code></pre></div><p>配置文件内容 <code>mosquitto.conf</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code>persistence true
persistence_location /mosquitto/data
log_dest file /mosquitto/log/mosquitto.log

listener 1883 
protocol mqtt

listener 1884
protocol websockets
</code></pre></div><p>启动容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> mosquitto <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> unless-stopped <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1883</span>:1883 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1884</span>:1884 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/config/mosquitto.conf:/mosquitto/config/mosquitto.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/data:/mosquitto/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/log:/mosquitto/log <span class="token punctuation">\</span>
eclipse-mosquitto:2
</code></pre></div><p>配置账户密码步骤：</p> <p>1、添加配置 <code>mosquitto.conf</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code>allow_anonymous false
password_file /mosquitto/config/pwfile.conf
</code></pre></div><p>2、进入容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mosquitto <span class="token function">sh</span>
</code></pre></div><p>3、在容器中创建密码文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">touch</span> /mosquitto/config/pwfile.conf
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /mosquitto/config/pwfile.conf
mosquitto_passwd <span class="token parameter variable">-b</span> /mosquitto/config/pwfile.conf car wwwww
</code></pre></div><p>4、重启容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> restart mosquitto
</code></pre></div><h3 id="启用ssl步骤-pem证书"><a href="#启用ssl步骤-pem证书" class="header-anchor">#</a> 启用ssl步骤(pem证书)</h3> <p>1、自签证书</p> <p>自签ca证书</p> <div class="language-bash extra-class"><pre class="language-bash"><code>openssl genrsa <span class="token parameter variable">-out</span> ca.key <span class="token number">2048</span>
openssl req <span class="token parameter variable">-x509</span> <span class="token parameter variable">-new</span> <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-key</span> ca.key <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token parameter variable">-out</span> ca.pem
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class="token string">'.'</span>, the field will be left blank.
-----
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>XX<span class="token punctuation">]</span>:CN
string is too long, it needs to be <span class="token function">less</span> than  <span class="token number">2</span> bytes long
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>XX<span class="token punctuation">]</span>:CN
State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:HUBEI
Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default City<span class="token punctuation">]</span>:WUHAN
Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default Company Ltd<span class="token punctuation">]</span>:5W
Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:5W    
Common Name <span class="token punctuation">(</span>eg, your name or your server's <span class="token function">hostname</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:
Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:
</code></pre></div><p>创建授权私钥</p> <div class="language-bash extra-class"><pre class="language-bash"><code>openssl genrsa <span class="token parameter variable">-out</span> mqtt-client.key <span class="token number">2048</span>
</code></pre></div><p>新建 <code>openssl.cnf</code> 文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>req<span class="token punctuation">]</span>
default_bits  <span class="token operator">=</span> <span class="token number">2048</span>
distinguished_name <span class="token operator">=</span> req_distinguished_name <span class="token comment">#根据情况修改</span>
req_extensions <span class="token operator">=</span> req_ext
x509_extensions <span class="token operator">=</span> v3_req
prompt <span class="token operator">=</span> no
<span class="token punctuation">[</span>req_distinguished_name<span class="token punctuation">]</span>
countryName <span class="token operator">=</span> CN
stateOrProvinceName <span class="token operator">=</span> HUBEI
localityName <span class="token operator">=</span> WUHAN
organizationName <span class="token operator">=</span> 5W
commonName <span class="token operator">=</span> Server certificate
<span class="token punctuation">[</span>req_ext<span class="token punctuation">]</span>
subjectAltName <span class="token operator">=</span> @alt_names
<span class="token punctuation">[</span>v3_req<span class="token punctuation">]</span>
subjectAltName <span class="token operator">=</span> @alt_names
<span class="token punctuation">[</span>alt_names<span class="token punctuation">]</span>
IP.1 <span class="token operator">=</span> <span class="token number">192.168</span>.3.28  <span class="token comment">#要连接的服务器IP,可以写多个IP</span>
IP.2 <span class="token operator">=</span> <span class="token number">120.211</span>.228.246
DNS.1 <span class="token operator">=</span> <span class="token number">127.0</span>.0.1
</code></pre></div><p>以这个密钥和配置签发一个证书请求</p> <div class="language-bash extra-class"><pre class="language-bash"><code>openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-key</span> mqtt-client.key <span class="token parameter variable">-config</span> openssl.cnf <span class="token parameter variable">-out</span> mqtt-client.csr
</code></pre></div><p>以根证书来签发实体证书</p> <div class="language-bash extra-class"><pre class="language-bash"><code>openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-in</span> mqtt-client.csr <span class="token parameter variable">-CA</span> ca.pem <span class="token parameter variable">-CAkey</span> ca.key <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-out</span> mqtt-client.pem <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-extensions</span> v3_req <span class="token parameter variable">-extfile</span> openssl.cnf
</code></pre></div><p>验证证书</p> <div class="language-bash extra-class"><pre class="language-bash"><code>openssl verify <span class="token parameter variable">-CAfile</span> ca.pem mqtt-client.pem
mqtt-client.pem: OK
</code></pre></div><p>2、拷贝证书</p> <p>复制 <code>ca.pem</code> <code>mqtt-client.pem</code> <code>mqtt-client.key</code> 到 <code>/root/u01/mosquitto/data/ca</code>下</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cp</span> ca.pem mqtt-client.pem mqtt-client.key /root/u01/mosquitto/data/ca
</code></pre></div><p>3、修改配置，添加如下配置</p> <div class="language-bash extra-class"><pre class="language-bash"><code>listener <span class="token number">1883</span> 
protocol mqtt

listener <span class="token number">8883</span> 
protocol mqtt
cafile /mosquitto/data/ca/ca.pem
certfile /mosquitto/data/ca/mqtt-client.pem
keyfile /mosquitto/data/ca/mqtt-client.key
require_certificate <span class="token boolean">true</span>
use_identity_as_username <span class="token boolean">true</span>
</code></pre></div><p>如果启用<code>8883</code>端口，需要重新创建容器，加<code>-p 8883:8883</code>配置，也可以使用<code>1883</code>端口配置，添加证书配置</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> mosquitto <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> unless-stopped <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1883</span>:1883 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1884</span>:1884 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8883</span>:8883 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/config/mosquitto.conf:/mosquitto/config/mosquitto.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/data:/mosquitto/data <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mosquitto/log:/mosquitto/log <span class="token punctuation">\</span>
eclipse-mosquitto:2
</code></pre></div><p>完整配置</p> <div class="language-bash extra-class"><pre class="language-bash"><code>persistence <span class="token boolean">true</span>
persistence_location /mosquitto/data
log_dest <span class="token function">file</span> /mosquitto/log/mosquitto.log

listener <span class="token number">1883</span> 
protocol mqtt

listener <span class="token number">1884</span>
protocol websockets

allow_anonymous <span class="token boolean">false</span>
password_file /mosquitto/config/pwfile.conf

listener <span class="token number">8883</span> 
protocol mqtt
cafile /mosquitto/data/ca/ca.pem
certfile /mosquitto/data/ca/mqtt-client.pem
keyfile /mosquitto/data/ca/mqtt-client.key
require_certificate <span class="token boolean">true</span>
use_identity_as_username <span class="token boolean">true</span>
</code></pre></div><p>4、重启容器</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> restart mosquitto
</code></pre></div><p>5、客户端连接</p> <p>启动ssl，配置<code>ca.pem</code> <code>mqtt-client.pem</code> <code>mqtt-client.key</code>路径即可</p> <p>参考：https://www.emqx.com/zh/blog/emqx-server-ssl-tls-secure-connection-configuration-guide</p> <h3 id="启用ssl步骤-crt证书"><a href="#启用ssl步骤-crt证书" class="header-anchor">#</a> 启用ssl步骤(crt证书)</h3> <p>1、生成ca证书</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ openssl genrsa <span class="token parameter variable">-des3</span> <span class="token parameter variable">-out</span> ca.key <span class="token number">2048</span>
Generating RSA private key, <span class="token number">2048</span> bit long modulus
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++
e is <span class="token number">65537</span> <span class="token punctuation">(</span>0x10001<span class="token punctuation">)</span>
Enter pass phrase <span class="token keyword">for</span> ca.key:
Verifying - Enter pass phrase <span class="token keyword">for</span> ca.key:
$ openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-x509</span> <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token parameter variable">-key</span> ca.key <span class="token parameter variable">-out</span> ca.crt
Enter pass phrase <span class="token keyword">for</span> ca.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class="token string">'.'</span>, the field will be left blank.
-----
Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>XX<span class="token punctuation">]</span>:CN
State or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:HB
Locality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default City<span class="token punctuation">]</span>:WH
Organization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Default Company Ltd<span class="token punctuation">]</span>:5w
Organizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:5w
Common Name <span class="token punctuation">(</span>eg, your name or your server<span class="token string">'s hostname) []:
Email Address []:
$ openssl genrsa -out server.key 2048
Generating RSA private key, 2048 bit long modulus
....+++
.................................................................................................................+++
e is 65537 (0x10001)
$ openssl req -new -out server.csr -key server.key
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '</span><span class="token builtin class-name">.</span><span class="token string">', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:HB
Locality Name (eg, city) [Default City]:WH
Organization Name (eg, company) [Default Company Ltd]:5w
Organizational Unit Name (eg, section) []:5w
Common Name (eg, your name or your server'</span>s <span class="token function">hostname</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:
Email Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:

Please enter the following <span class="token string">'extra'</span> attributes
to be sent with your certificate request
A challenge password <span class="token punctuation">[</span><span class="token punctuation">]</span>:
An optional company name <span class="token punctuation">[</span><span class="token punctuation">]</span>:
$ openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-in</span> server.csr <span class="token parameter variable">-CA</span> ca.crt <span class="token parameter variable">-CAkey</span> ca.key <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-out</span> server.crt <span class="token parameter variable">-days</span> <span class="token number">3600</span>
Signature ok
<span class="token assign-left variable">subject</span><span class="token operator">=</span>/C<span class="token operator">=</span>CN/ST<span class="token operator">=</span>HB/L<span class="token operator">=</span>WH/O<span class="token operator">=</span>5w/OU<span class="token operator">=</span>5w
Getting CA Private Key
Enter pass phrase <span class="token keyword">for</span> ca.key:
</code></pre></div><p>2、验证证书</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ openssl verify <span class="token parameter variable">-CAfile</span> ca.crt server.crt
server.crt: C <span class="token operator">=</span> CN, ST <span class="token operator">=</span> HB, L <span class="token operator">=</span> WH, O <span class="token operator">=</span> 5w, OU <span class="token operator">=</span> 5w
error <span class="token number">18</span> at <span class="token number">0</span> depth lookup:self signed certificate
OK
</code></pre></div><p>3、如果需要<code>pfx</code>证书，可以用下面命令转换，密码是前面生成证书的密码<code>123456</code>，在使用的时候，也需要这个密码</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ openssl pkcs12 <span class="token parameter variable">-export</span> <span class="token parameter variable">-clcerts</span> <span class="token parameter variable">-in</span> ca.crt <span class="token parameter variable">-inkey</span> ca.key <span class="token parameter variable">-out</span> ca.pfx
Enter pass phrase <span class="token keyword">for</span> ca.key:
Enter Export Password:
Verifying - Enter Export Password:
$ openssl pkcs12 <span class="token parameter variable">-export</span> <span class="token parameter variable">-clcerts</span> <span class="token parameter variable">-in</span> server.crt <span class="token parameter variable">-inkey</span> server.key <span class="token parameter variable">-out</span> server.pfx
Enter Export Password:
Verifying - Enter Export Password:
</code></pre></div><p>对应<code>mosquitto</code>的配置，下面几项需要注释掉</p> <div class="language-ini extra-class"><pre class="language-ini"><code>listener 8883 
cafile /mosquitto/data/ca/ca.crt
certfile /mosquitto/data/ca/server.crt
keyfile /mosquitto/data/ca/server.key
<span class="token comment">#protocol mqtt</span>
<span class="token comment">#require_certificate true</span>
<span class="token comment">#use_identity_as_username true</span>
</code></pre></div><p>连接时可以使用三个文件，或者只使用<code>ca.crt</code>即可</p> <h2 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> redis <span class="token punctuation">\</span>
<span class="token parameter variable">--restart</span> unless-stopped <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6379</span>:6379 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/redis:/data <span class="token punctuation">\</span>
redis <span class="token punctuation">\</span>
<span class="token parameter variable">--requirepass</span> <span class="token string">&quot;123456&quot;</span>
</code></pre></div><h2 id="mssql"><a href="#mssql" class="header-anchor">#</a> mssql</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /root/u01/mssql/data
<span class="token function">chown</span> <span class="token number">10001</span>:root /root/u01/mssql/data
<span class="token function">docker</span> run <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token parameter variable">-e</span> <span class="token string">&quot;ACCEPT_EULA=Y&quot;</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;SA_PASSWORD=Abc@123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">1433</span>:1433 <span class="token parameter variable">--name</span> mssql <span class="token parameter variable">--hostname</span> mssql <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /root/u01/mssql/data:/var/opt/mssql/data <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> mcr.microsoft.com/mssql/server:2019-latest
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CentOS/vmware_extend_disk.html" class="prev">
        VMware虚拟机扩展磁盘容量
      </a></span> <span class="next"><a href="/Docker/docker_compose_app.html">
        Docker-Compose应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ea617b8.js" defer></script><script src="/assets/js/2.6e381248.js" defer></script><script src="/assets/js/31.d7d6e5fa.js" defer></script>
  </body>
</html>
