<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>备份与恢复 | 个人文档库</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="运维知识文档">
    
    <link rel="preload" href="/assets/css/0.styles.86682925.css" as="style"><link rel="preload" href="/assets/js/app.6ea617b8.js" as="script"><link rel="preload" href="/assets/js/2.6e381248.js" as="script"><link rel="preload" href="/assets/js/34.0f46b74a.js" as="script"><link rel="prefetch" href="/assets/js/10.dd27a2bb.js"><link rel="prefetch" href="/assets/js/11.ec440828.js"><link rel="prefetch" href="/assets/js/12.c67fbef0.js"><link rel="prefetch" href="/assets/js/13.a53b31f6.js"><link rel="prefetch" href="/assets/js/14.fac02fcf.js"><link rel="prefetch" href="/assets/js/15.366e462e.js"><link rel="prefetch" href="/assets/js/16.ae609dff.js"><link rel="prefetch" href="/assets/js/17.7976f036.js"><link rel="prefetch" href="/assets/js/18.3f258419.js"><link rel="prefetch" href="/assets/js/19.0ad2626e.js"><link rel="prefetch" href="/assets/js/20.bdf3dbe2.js"><link rel="prefetch" href="/assets/js/21.04180477.js"><link rel="prefetch" href="/assets/js/22.f4cf519a.js"><link rel="prefetch" href="/assets/js/23.9e5b52cd.js"><link rel="prefetch" href="/assets/js/24.b0159ef8.js"><link rel="prefetch" href="/assets/js/25.e38d986a.js"><link rel="prefetch" href="/assets/js/26.b44e8359.js"><link rel="prefetch" href="/assets/js/27.164897ca.js"><link rel="prefetch" href="/assets/js/28.30c3dcb6.js"><link rel="prefetch" href="/assets/js/29.0ea1763d.js"><link rel="prefetch" href="/assets/js/3.87c14ff3.js"><link rel="prefetch" href="/assets/js/30.b6b9f227.js"><link rel="prefetch" href="/assets/js/31.d7d6e5fa.js"><link rel="prefetch" href="/assets/js/32.a71c64f7.js"><link rel="prefetch" href="/assets/js/33.6e421306.js"><link rel="prefetch" href="/assets/js/35.1d02fd3c.js"><link rel="prefetch" href="/assets/js/36.fc5cc9cb.js"><link rel="prefetch" href="/assets/js/37.af7e5661.js"><link rel="prefetch" href="/assets/js/38.cdd11312.js"><link rel="prefetch" href="/assets/js/39.30bb1d36.js"><link rel="prefetch" href="/assets/js/4.91553c08.js"><link rel="prefetch" href="/assets/js/40.c4740fee.js"><link rel="prefetch" href="/assets/js/41.37a38f62.js"><link rel="prefetch" href="/assets/js/42.df5bcbd7.js"><link rel="prefetch" href="/assets/js/43.0c0ab294.js"><link rel="prefetch" href="/assets/js/44.1dcaa2ac.js"><link rel="prefetch" href="/assets/js/45.c3b4bbca.js"><link rel="prefetch" href="/assets/js/46.7659ce01.js"><link rel="prefetch" href="/assets/js/47.d6eb360d.js"><link rel="prefetch" href="/assets/js/48.ca9d607b.js"><link rel="prefetch" href="/assets/js/49.8c09eac0.js"><link rel="prefetch" href="/assets/js/5.6d5ca1ce.js"><link rel="prefetch" href="/assets/js/50.3694eddb.js"><link rel="prefetch" href="/assets/js/51.0868c6f4.js"><link rel="prefetch" href="/assets/js/52.513df7cc.js"><link rel="prefetch" href="/assets/js/53.9dcabf12.js"><link rel="prefetch" href="/assets/js/54.70a6c075.js"><link rel="prefetch" href="/assets/js/55.a1d14f80.js"><link rel="prefetch" href="/assets/js/56.7029bd26.js"><link rel="prefetch" href="/assets/js/57.1b116307.js"><link rel="prefetch" href="/assets/js/58.bb74acae.js"><link rel="prefetch" href="/assets/js/59.610e7d4f.js"><link rel="prefetch" href="/assets/js/6.ee71a04b.js"><link rel="prefetch" href="/assets/js/60.98e611f4.js"><link rel="prefetch" href="/assets/js/61.05109453.js"><link rel="prefetch" href="/assets/js/62.f4adfb83.js"><link rel="prefetch" href="/assets/js/63.b63e1591.js"><link rel="prefetch" href="/assets/js/64.1235f2bd.js"><link rel="prefetch" href="/assets/js/65.bfa7cab9.js"><link rel="prefetch" href="/assets/js/66.2574fbb1.js"><link rel="prefetch" href="/assets/js/67.09935f72.js"><link rel="prefetch" href="/assets/js/68.af1ee108.js"><link rel="prefetch" href="/assets/js/69.7a2f9a81.js"><link rel="prefetch" href="/assets/js/7.ed4c5699.js"><link rel="prefetch" href="/assets/js/70.605c490c.js"><link rel="prefetch" href="/assets/js/8.c8b45379.js"><link rel="prefetch" href="/assets/js/9.9d028748.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86682925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人文档库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CentOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CentOS/boot_order.html" class="sidebar-link">启动顺序</a></li><li><a href="/CentOS/system_initialization.html" class="sidebar-link">系统常用配置</a></li><li><a href="/CentOS/yum.html" class="sidebar-link">yum命令</a></li><li><a href="/CentOS/rpm.html" class="sidebar-link">rpm命令</a></li><li><a href="/CentOS/date_command_opstions.html" class="sidebar-link">date命令选项</a></li><li><a href="/CentOS/system_logs.html" class="sidebar-link">系统日志说明</a></li><li><a href="/CentOS/grep_sed_awk.html" class="sidebar-link">grep sed awk</a></li><li><a href="/CentOS/file_descriptor.html" class="sidebar-link">文件描述符</a></li><li><a href="/CentOS/stdin_stdout_stderr.html" class="sidebar-link">输入输出重定向</a></li><li><a href="/CentOS/iptables.html" class="sidebar-link">iptables</a></li><li><a href="/CentOS/sysctl.html" class="sidebar-link">sysctl基本优化</a></li><li><a href="/CentOS/load_balance.html" class="sidebar-link">双网卡绑定和负载均衡</a></li><li><a href="/CentOS/lvm.html" class="sidebar-link">lvm管理</a></li><li><a href="/CentOS/sendmail.html" class="sidebar-link">sendmail</a></li><li><a href="/CentOS/dns_server.html" class="sidebar-link">DNS Sever</a></li><li><a href="/CentOS/ftp_server.html" class="sidebar-link">FTP Sever</a></li><li><a href="/CentOS/nfs_server.html" class="sidebar-link">NFS Server</a></li><li><a href="/CentOS/ntp_server.html" class="sidebar-link">NTP Sever</a></li><li><a href="/CentOS/lsyncd.html" class="sidebar-link">lsyncd</a></li><li><a href="/CentOS/kvm_virtulization_deploy.html" class="sidebar-link">KVM</a></li><li><a href="/CentOS/vmware_extend_disk.html" class="sidebar-link">VMware虚拟机扩展磁盘容量</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/docker_app.html" class="sidebar-link">Docker应用</a></li><li><a href="/Docker/docker_compose_app.html" class="sidebar-link">Docker-Compose应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Nginx/" class="sidebar-link">介绍</a></li><li><a href="/Nginx/nginx_install.html" class="sidebar-link">安装</a></li><li><a href="/Nginx/nginx_config_files.html" class="sidebar-link">配置文件</a></li><li><a href="/Nginx/nginx_proxy.html" class="sidebar-link">反向代理</a></li><li><a href="/Nginx/nginx_max_clients.html" class="sidebar-link">并发数</a></li><li><a href="/Nginx/linux_optimization_for_nginx.html" class="sidebar-link">内核调优</a></li><li><a href="/Nginx/nginx_php_fpm.html" class="sidebar-link">使用PHP-FPM</a></li><li><a href="/Nginx/keepalived_nginx.html" class="sidebar-link">Keepalived + Nginx</a></li><li><a href="/Nginx/configs.html" class="sidebar-link">常用配置</a></li><li><a href="/Nginx/nginx_log_scripts.html" class="sidebar-link">nginx日志分析</a></li><li><a href="/Nginx/http_code.html" class="sidebar-link">HTTP状态码</a></li><li><a href="/Nginx/error_handle.html" class="sidebar-link">常见错误处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/MySQL/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/MySQL/mysql_installation.html" class="sidebar-link">安装</a></li><li><a href="/MySQL/variables.html" class="sidebar-link">参数</a></li><li><a href="/MySQL/command.html" class="sidebar-link">命令</a></li><li><a href="/MySQL/sql.html" class="sidebar-link">SQL</a></li><li><a href="/MySQL/mysql_scripts.html" class="sidebar-link">脚本</a></li><li><a href="/MySQL/log.html" class="sidebar-link">日志分类</a></li><li><a href="/MySQL/reset_password.html" class="sidebar-link">重置密码</a></li><li><a href="/MySQL/backup.html" aria-current="page" class="active sidebar-link">备份与恢复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MySQL/backup.html#mysqldump" class="sidebar-link">mysqldump</a></li><li class="sidebar-sub-header"><a href="/MySQL/backup.html#xtrabackup" class="sidebar-link">Xtrabackup</a></li><li class="sidebar-sub-header"><a href="/MySQL/backup.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/MySQL/duplication.html" class="sidebar-link">主从复制</a></li><li><a href="/MySQL/optimization.html" class="sidebar-link">运行环境优化</a></li><li><a href="/MySQL/tools.html" class="sidebar-link">实时监控工具</a></li><li><a href="/MySQL/error_code.html" class="sidebar-link">常见错误代码</a></li><li><a href="/MySQL/errors.html" class="sidebar-link">错误处理</a></li><li><a href="/MySQL/innodb.html" class="sidebar-link">InnoDB特性</a></li><li><a href="/MySQL/duplication_case.html" class="sidebar-link">迁移案例</a></li><li><a href="/MySQL/mysql_innodb_cluster.html" class="sidebar-link">MySQL innodb cluster</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/install_python.html" class="sidebar-link">安装</a></li><li><a href="/Python/django_deployment.html" class="sidebar-link">Django项目部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Others/ffmpeg.html" class="sidebar-link">ffmpeg</a></li><li><a href="/Others/mac_tips.html" class="sidebar-link">Mac技巧</a></li><li><a href="/Others/raid_level.html" class="sidebar-link">Raid级别</a></li><li><a href="/Others/servers.html" class="sidebar-link">服务器规划</a></li><li><a href="/Others/memcached.html" class="sidebar-link">Memcached基础</a></li><li><a href="/Others/tomcat_deploy.html" class="sidebar-link">Tomcat部署</a></li><li><a href="/Others/tcp_handshake.html" class="sidebar-link">TCP三次握手四次挥手</a></li><li><a href="/Others/aria2_filebrowser.html" class="sidebar-link">Aria2 离线下载</a></li><li><a href="/Others/word_page_num.html" class="sidebar-link">Word页码编排</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="备份与恢复"><a href="#备份与恢复" class="header-anchor">#</a> 备份与恢复</h1> <p></p><div class="table-of-contents"><ul><li><a href="#mysqldump">mysqldump</a><ul><li><a href="#备份方法">备份方法</a></li><li><a href="#备份方案">备份方案</a></li><li><a href="#恢复方法">恢复方法</a></li></ul></li><li><a href="#xtrabackup">Xtrabackup</a><ul><li><a href="#安装">安装</a></li><li><a href="#备份方法">备份方法</a></li><li><a href="#备份方案">备份方案</a></li><li><a href="#备份脚本和计划任务">备份脚本和计划任务</a></li><li><a href="#恢复数据">恢复数据</a></li></ul></li><li><a href="#参考链接">参考链接</a></li></ul></div><p></p> <p><code>MySQL</code> 版本为 <code>5.36</code> ，已启用 <code>log_bin</code> ，使用 <code>InnoDB</code> 存储引擎，二进制日志格式为 <code>ROW</code> ， <code>binlog-do-db</code> 为 <code>db1</code> ，只记录 <code>db1</code> 的二进制日志，备份与恢复主要只针对 <code>db1</code> 。</p> <h2 id="mysqldump"><a href="#mysqldump" class="header-anchor">#</a> mysqldump</h2> <p><code>mysqldump</code> 是逻辑备份工具，导出的是逻辑的 <code>SQL</code> 脚本文件，可以根据实际情况编辑 <code>SQL</code> 文件。</p> <h3 id="备份方法"><a href="#备份方法" class="header-anchor">#</a> 备份方法</h3> <p>整库备份时如果同时有 <code>MyISAM</code> 和 <code>InnoDB</code> 数据库，则需要加上 <code>--lock-all-tables</code> 选项，在备份期间会加上全局读锁。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--opt</span> --master-data<span class="token operator">=</span><span class="token number">2</span> --lock-all-tables <span class="token parameter variable">--events</span> <span class="token parameter variable">--routines</span> <span class="token parameter variable">--triggers</span> --flush-logs --all-databases <span class="token operator">&gt;</span> all_data.sql
</code></pre></div><p>使用压缩</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--opt</span> --master-data<span class="token operator">=</span><span class="token number">2</span> --lock-all-tables <span class="token parameter variable">--events</span> <span class="token parameter variable">--routines</span> <span class="token parameter variable">--triggers</span> --flush-logs --all-databases <span class="token operator">|</span> <span class="token function">gzip</span> <span class="token operator">&gt;</span> all_data.sql.gz
</code></pre></div><p>如果需要对某一个或几个数据库备份，则使用 <code>--databases</code> 选项并指定库名，即 <code>--databases db1 db2</code> 。在备份 <code>MyISAM</code> 数据库时，使用 <code>--lock-all-tables</code> 选项，而备份 <code>InnoDB</code> 数据库时，使用 <code>--single-transaction</code> 选项启用单事务处理，不影响其他事务的执行。</p> <h3 id="备份方案"><a href="#备份方案" class="header-anchor">#</a> 备份方案</h3> <p>以周为单位，采用全量+增量的备份方式，每周一凌晨 <code>1:00</code> 对 <code>db1</code> 执行全量备份，然后每周一至周日 <code>23:55</code> 对 <code>db1</code> 执行增量备份，增量备份的频率可以根据实际情况调整。在这种方案下，一个单位备份之后，会缺失周日 <code>23:55</code> 到周一 <code>1:00</code> 之间的增量，一般来说可以接受。</p> <h4 id="周一全量备份"><a href="#周一全量备份" class="header-anchor">#</a> 周一全量备份</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/backup/week1
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--opt</span> --master-data<span class="token operator">=</span><span class="token number">2</span> --single-transaction <span class="token parameter variable">--events</span> <span class="token parameter variable">--routines</span> <span class="token parameter variable">--triggers</span> --flush-logs <span class="token parameter variable">--databases</span> db1 <span class="token operator">&gt;</span> ~/backup/week1/db1_full_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>.sql
</code></pre></div><h4 id="周一增量备份"><a href="#周一增量备份" class="header-anchor">#</a> 周一增量备份</h4> <p>获取周一全量备份时记录的 <code>CHANGE MASTER</code> 信息</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span> db1_full_2017-12-12.sql <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">'CHANGE MASTER'</span>
-- CHANGE MASTER TO <span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">'binlog.000006'</span>, <span class="token assign-left variable">MASTER_LOG_POS</span><span class="token operator">=</span><span class="token number">191</span><span class="token punctuation">;</span>
</code></pre></div><p>也就是说增量备份的起点是 <code>binlog.000006</code> <code>191</code> ，此时再检查当前的二进制日志情况</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> -p<span class="token string">'PASSWORD'</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;show master status;&quot;</span>
+---------------+----------+--------------+------------------+--------------------------------------------+
<span class="token operator">|</span> File          <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set                          <span class="token operator">|</span>
+---------------+----------+--------------+------------------+--------------------------------------------+
<span class="token operator">|</span> binlog.000006 <span class="token operator">|</span>     <span class="token number">5486</span> <span class="token operator">|</span> db1          <span class="token operator">|</span>                  <span class="token operator">|</span> 2d1581e0-781b-11e8-acb7-525400e231bc:1-646 <span class="token operator">|</span>
+---------------+----------+--------------+------------------+--------------------------------------------+
</code></pre></div><p>由此得知周一 <code>1:00</code> 至此时的增量二进制日志全部在 <code>binlog.000006</code> 文件中，且此时位置是 <code>5486</code> ，因此将增量部分导出到备份目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysqlbinlog --base64-output<span class="token operator">=</span>decode-rows <span class="token parameter variable">-vv</span> --start-position<span class="token operator">=</span><span class="token number">191</span> --stop-position<span class="token operator">=</span><span class="token number">5486</span> ~/u01/mysql/binlog/binlog.000006 <span class="token operator">&gt;&gt;</span> ~/backup/week1/db1_incre_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>.sql
</code></pre></div><p>如果增量涉及到多个 <code>binlog</code> 文件，就多次执行 <code>mysqlbinlog</code> 命令，将日志追加到增量 <code>db1_incre</code> 文件中。后面周二到周日的增量备份步骤相同，可以写成脚本加入到计划任务中。</p> <h3 id="恢复方法"><a href="#恢复方法" class="header-anchor">#</a> 恢复方法</h3> <p>依次导入全备和增量的 <code>SQL</code> 脚本文件，例如 <code>db1_full_2017-12-12.sql</code> 和 <code>db1_incre_2017-12-13.sql</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> db1_full_2017-12-12.sql
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> db1_incre_2017-12-13.sql
</code></pre></div><h2 id="xtrabackup"><a href="#xtrabackup" class="header-anchor">#</a> Xtrabackup</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libev perl-DBD-MySQL perl-Digest-MD5 <span class="token function">rsync</span>
<span class="token function">sudo</span> <span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.12/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm
</code></pre></div><h3 id="备份方法-2"><a href="#备份方法-2" class="header-anchor">#</a> 备份方法</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/home/mysql/u01/mysql/etc/my.cnf <span class="token punctuation">\</span>
    --no-timestamp <span class="token punctuation">\</span>
    --use-memory<span class="token operator">=</span>1G <span class="token punctuation">\</span>
    <span class="token parameter variable">--parallel</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--user</span><span class="token operator">=</span>backup <span class="token punctuation">\</span>
    <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'PASSWORD'</span> /home/mysql/backup <span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    /home/mysql/backup_log/backup-progress-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre></div><p><code>--no-timestamp</code> 表示不自动生成时间戳，直接备份到指定目录 <code>/home/mysql/backup</code> 中， <code>--parallel</code> 表示并行数。 <code>innobackupex</code> 支持备份单个 <code>InnoDB</code> 数据库，指定参数 <code>--databases db1</code> 。也可以通过指定 <code>--host</code> 和 <code>--port</code> 参数备份远程数据库。如果是 <code>Slave</code> 库，可以指定 <code>--slave-info</code> 记录 <code>slave</code> 相关信息。最后输出 <code>completed OK!</code> 表示执行成功。</p> <h3 id="备份方案-2"><a href="#备份方案-2" class="header-anchor">#</a> 备份方案</h3> <p>和前面的方案一样，每周一凌晨 <code>1:00</code> 执行全量备份，然后每周一至周日半夜 <code>23:55</code> 执行增量备份。与前面不同的是，这里对整库执行备份，恢复时比较方便。 <code>Xtrabackup</code> 是基于 <code>LSN</code> 进行增量备份的，可以通过查看 <code>xtrabackup_checkpoints</code> 获取 <code>LSN</code> 的位置。</p> <h4 id="周一全量备份-2"><a href="#周一全量备份-2" class="header-anchor">#</a> 周一全量备份</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/backup/week1/full
$ innobackupex <span class="token punctuation">\</span>
    --defaults-file<span class="token operator">=</span>/home/mysql/u01/mysql/etc/my.cnf <span class="token punctuation">\</span>
    --no-timestamp <span class="token punctuation">\</span>
    <span class="token parameter variable">--parallel</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
    <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'PASSWORD'</span> /home/mysql/week1/full
</code></pre></div><h4 id="周一增量备份-2"><a href="#周一增量备份-2" class="header-anchor">#</a> 周一增量备份</h4> <p>第一个增量备份基于全量的 <code>LSN</code> 位置进行增量</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/mysql/backup/week1/incre<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%u<span class="token variable">`</span></span>_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
innobackupex <span class="token punctuation">\</span>
    --defaults-file<span class="token operator">=</span>/home/mysql/u01/mysql/etc/my.cnf <span class="token punctuation">\</span>
    --no-timestamp <span class="token punctuation">\</span>
    <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
    <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'PASSWORD'</span> <span class="token punctuation">\</span>
    --incremental-basedir<span class="token operator">=</span>/home/mysql/week1/full <span class="token punctuation">\</span>
    <span class="token parameter variable">--incremental</span> /home/mysql/backup/week1/incre<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%u<span class="token variable">`</span></span>_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
</code></pre></div><h4 id="周二增量备份"><a href="#周二增量备份" class="header-anchor">#</a> 周二增量备份</h4> <p>第二个增量备份基于第一个增量的 <code>LSN</code> 位置进行增量，后面每个增量执行方法一样。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/mysql/backup/week1/incre<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%u<span class="token variable">`</span></span>_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
innobackupex <span class="token punctuation">\</span>
    --defaults-file<span class="token operator">=</span>/home/mysql/u01/mysql/etc/my.cnf <span class="token punctuation">\</span>
    --no-timestamp <span class="token punctuation">\</span>
    <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
    <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'PASSWORD'</span> <span class="token punctuation">\</span>
    --incremental-basedir<span class="token operator">=</span>/home/mysql/week1/incre<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">'last day'</span> +%u<span class="token variable">`</span></span>_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">'last day'</span> +%F<span class="token variable">`</span></span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--incremental</span> /home/mysql/backup/week1/incre<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%u<span class="token variable">`</span></span>_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
</code></pre></div><h4 id="查看lsn"><a href="#查看lsn" class="header-anchor">#</a> 查看LSN</h4> <p>分别查看全量、增量1、增量2的 <code>xtrabackup_checkpoints</code></p> <p><strong>full</strong></p> <div class="language- extra-class"><pre class="language-text"><code>backup_type = full-backuped
from_lsn = 0
to_lsn = 2120671
last_lsn = 2120671
compact = 0
recover_binlog_info = 0
</code></pre></div><p><strong>incre1</strong></p> <div class="language- extra-class"><pre class="language-text"><code>backup_type = incremental
from_lsn = 2120671
to_lsn = 2123065
last_lsn = 2123065
compact = 0
recover_binlog_info = 0
</code></pre></div><p><strong>incre2</strong></p> <div class="language- extra-class"><pre class="language-text"><code>backup_type = incremental
from_lsn = 2123065
to_lsn = 2126937
last_lsn = 2126937
compact = 0
recover_binlog_info = 0
</code></pre></div><h3 id="备份脚本和计划任务"><a href="#备份脚本和计划任务" class="header-anchor">#</a> 备份脚本和计划任务</h3> <p>使用 <code>Xtrabackup</code> 作为备份工具，编写周一全量备份脚本 <code>full.backup.sh</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;PASSWORD&quot;</span>
<span class="token assign-left variable">cnf</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/u01/mysql/etc/my.cnf&quot;</span>
<span class="token assign-left variable">socket</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/u01/mysql/run/mysql.sock&quot;</span>
<span class="token assign-left variable">week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%V<span class="token variable">)</span></span>
<span class="token assign-left variable">full_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/full_<span class="token variable">$day</span>&quot;</span>
<span class="token assign-left variable">log_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/log&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$full_dir</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/bin/mkdir <span class="token parameter variable">-p</span> <span class="token variable">$full_dir</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$log_dir</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/bin/mkdir <span class="token parameter variable">-p</span> <span class="token variable">$log_dir</span>
<span class="token keyword">fi</span>

/usr/bin/innobackupex <span class="token punctuation">\</span>
    --defaults-file<span class="token operator">=</span><span class="token variable">$cnf</span> <span class="token punctuation">\</span>
    --no-timestamp <span class="token punctuation">\</span>
    --use-memory<span class="token operator">=</span>1G <span class="token punctuation">\</span>
    <span class="token parameter variable">--parallel</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--socket</span><span class="token operator">=</span><span class="token variable">$socket</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token variable">$user</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token variable">$password</span> <span class="token variable">$full_dir</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">\</span>
    <span class="token variable">$log_dir</span>/full_backup_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre></div><p>周一至周日的增量备份脚本 <code>incre.backup.sh</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;PASSWORD&quot;</span>
<span class="token assign-left variable">cnf</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/u01/mysql/etc/my.cnf&quot;</span>
<span class="token assign-left variable">socket</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/u01/mysql/run/mysql.sock&quot;</span>
<span class="token assign-left variable">week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%V<span class="token variable">)</span></span>
<span class="token assign-left variable">full_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/full_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>&quot;</span>
<span class="token assign-left variable">log_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/log&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%u<span class="token variable">)</span></span> <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token assign-left variable">last_dir</span><span class="token operator">=</span><span class="token variable">$full_dir</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">last_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/incre<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">'last day'</span> +%u<span class="token variable">)</span></span>_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">'last day'</span> +%F<span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">incre_dir</span><span class="token operator">=</span><span class="token string">&quot;/home/mysql/week/<span class="token variable">$week</span>/incre<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%u<span class="token variable">)</span></span>_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$log_dir</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/bin/mkdir <span class="token parameter variable">-p</span> <span class="token variable">$log_dir</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable">$incre_dir</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/bin/mkdir <span class="token parameter variable">-p</span> <span class="token variable">$incre_dir</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span>/usr/bin/ls <span class="token parameter variable">-A</span> $last_dir <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> /dev/null<span class="token variable">)</span></span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /usr/bin/innobackupex <span class="token punctuation">\</span>
        --defaults-file<span class="token operator">=</span><span class="token variable">$cnf</span> <span class="token punctuation">\</span>
        --no-timestamp <span class="token punctuation">\</span>
        --use-memory<span class="token operator">=</span>1G <span class="token punctuation">\</span>
        <span class="token parameter variable">--parallel</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--socket</span><span class="token operator">=</span><span class="token variable">$socket</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token variable">$user</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token variable">$password</span> <span class="token punctuation">\</span>
        --incremental-basedir<span class="token operator">=</span><span class="token variable">$last_dir</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--incremental</span> <span class="token variable">$incre_dir</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">\</span>
        <span class="token variable">$log_dir</span>/incre_backup_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;incremental basedir is empty,quit...&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">$log_dir</span>/error_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>.log
<span class="token keyword">fi</span>
</code></pre></div><p>脚本包含了数据库明文密码，注意权限</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">700</span> full.backup.sh incre.backup.sh
</code></pre></div><p>在 <code>mysql</code> 用户 <code>bash</code> 下设置 <code>crontab</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">crontab</span> <span class="token parameter variable">-l</span>
00 01 * * <span class="token number">1</span> /bin/bash /home/mysql/full.backup.sh
<span class="token number">55</span> <span class="token number">23</span> * * * /bin/bash /home/mysql/incre.backup.sh
</code></pre></div><h3 id="恢复数据"><a href="#恢复数据" class="header-anchor">#</a> 恢复数据</h3> <p>以 <code>周一全备+周一增量+周二增量</code> 为例，将数据库恢复到周二，此时数据如下</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">+</span><span class="token comment">-----+---------+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span> name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+---------+</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> mysql1  <span class="token operator">|</span>
     ······
<span class="token operator">|</span> <span class="token number">156</span> <span class="token operator">|</span> mysql7  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">157</span> <span class="token operator">|</span> mysql8  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">158</span> <span class="token operator">|</span> mysql9  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">159</span> <span class="token operator">|</span> mysql10 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">160</span> <span class="token operator">|</span> mysql11 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">161</span> <span class="token operator">|</span> mysql12 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">162</span> <span class="token operator">|</span> mysql13 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+---------+</span>
</code></pre></div><p>将备份恢复到与原数据库配置完全相同的新数据库中，首先停止新库运行，然后备份数据库根目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--socket</span><span class="token operator">=</span>/home/mysql/u01/mysql-5.6.39/run/mysql.sock <span class="token function">shutdown</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /home/mysql/u01/mysql-5.6.39 /home/mysql/u01/mysql-5.6.39.bak
</code></pre></div><p>预备恢复数据，只有最后一个增量不加 <code>--redo-only</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ innobackupex <span class="token punctuation">\</span>
    --apply-log <span class="token punctuation">\</span>
    --redo-only /home/mysql/week1/full
InnoDB: Shutdown completed<span class="token punctuation">;</span> log sequence number <span class="token number">2120680</span>
InnoDB: Number of pools: <span class="token number">1</span>
<span class="token number">171218</span> <span class="token number">14</span>:52:35 completed OK<span class="token operator">!</span>

$ innobackupex <span class="token punctuation">\</span>
    --apply-log <span class="token punctuation">\</span>
    --redo-only /home/mysql/week1/full <span class="token punctuation">\</span>
    --incremental-dir<span class="token operator">=</span>/home/mysql/week1/incre1_2017-12-11
<span class="token number">171218</span> <span class="token number">15</span>:10:46 completed OK<span class="token operator">!</span>

$ innobackupex <span class="token punctuation">\</span>
    --apply-log /home/mysql/week1/full <span class="token punctuation">\</span>
    --incremental-dir<span class="token operator">=</span>/home/mysql/week1/incre2_2017-12-12
InnoDB: Shutdown completed<span class="token punctuation">;</span> log sequence number <span class="token number">2132520</span>
<span class="token number">171218</span> <span class="token number">15</span>:11:25 completed OK<span class="token operator">!</span>
</code></pre></div><p>清空数据文件和 <code>InnoDB</code> 日志文件，一般是 <code>data</code> 目录。如果它们是分开存放，则需要分别删除，例如 <code>data</code> <code>iblog</code> <code>ibdata</code> 目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /home/mysql/u01/mysql-5.6.39/<span class="token punctuation">{</span>data,iblog,ibdata<span class="token punctuation">}</span>/*
</code></pre></div><p>拷贝预备好的备份目录 <code>backup</code> 到新库服务器中，数据库处于关闭状态，执行恢复操作</p> <div class="language-bash extra-class"><pre class="language-bash"><code>innobackupex --defaults-file<span class="token operator">=</span>/home/mysql/u01/mysql/etc/my.cnf --copy-back /home/mysql/backup/
</code></pre></div><p>直到提示 <code>completed OK!</code> 表示恢复成功，然后验证恢复</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token operator">-</span>e <span class="token string">'select * from db1.table1;'</span>
<span class="token operator">+</span><span class="token comment">-----+---------+</span>
<span class="token operator">|</span> id  <span class="token operator">|</span> name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+---------+</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> mysql1  <span class="token operator">|</span>
     ······
<span class="token operator">|</span> <span class="token number">156</span> <span class="token operator">|</span> mysql7  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">157</span> <span class="token operator">|</span> mysql8  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">158</span> <span class="token operator">|</span> mysql9  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">159</span> <span class="token operator">|</span> mysql10 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">160</span> <span class="token operator">|</span> mysql11 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">161</span> <span class="token operator">|</span> mysql12 <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">162</span> <span class="token operator">|</span> mysql13 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+---------+</span>
</code></pre></div><h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/incremental_backups_innobackupex.html" target="_blank" rel="noopener noreferrer">https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/incremental_backups_innobackupex.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/restoring_individual_tables_ibk.html" target="_blank" rel="noopener noreferrer">https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/restoring_individual_tables_ibk.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.yunweipai.com/archives/13462.html" target="_blank" rel="noopener noreferrer">http://www.yunweipai.com/archives/13462.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MySQL/reset_password.html" class="prev">
        重置密码
      </a></span> <span class="next"><a href="/MySQL/duplication.html">
        主从复制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ea617b8.js" defer></script><script src="/assets/js/2.6e381248.js" defer></script><script src="/assets/js/34.0f46b74a.js" defer></script>
  </body>
</html>
