<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>错误处理 | 个人文档库</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="运维知识文档">
    
    <link rel="preload" href="/assets/css/0.styles.86682925.css" as="style"><link rel="preload" href="/assets/js/app.6ea617b8.js" as="script"><link rel="preload" href="/assets/js/2.6e381248.js" as="script"><link rel="preload" href="/assets/js/39.30bb1d36.js" as="script"><link rel="prefetch" href="/assets/js/10.dd27a2bb.js"><link rel="prefetch" href="/assets/js/11.ec440828.js"><link rel="prefetch" href="/assets/js/12.c67fbef0.js"><link rel="prefetch" href="/assets/js/13.a53b31f6.js"><link rel="prefetch" href="/assets/js/14.fac02fcf.js"><link rel="prefetch" href="/assets/js/15.366e462e.js"><link rel="prefetch" href="/assets/js/16.ae609dff.js"><link rel="prefetch" href="/assets/js/17.7976f036.js"><link rel="prefetch" href="/assets/js/18.3f258419.js"><link rel="prefetch" href="/assets/js/19.0ad2626e.js"><link rel="prefetch" href="/assets/js/20.bdf3dbe2.js"><link rel="prefetch" href="/assets/js/21.04180477.js"><link rel="prefetch" href="/assets/js/22.f4cf519a.js"><link rel="prefetch" href="/assets/js/23.9e5b52cd.js"><link rel="prefetch" href="/assets/js/24.b0159ef8.js"><link rel="prefetch" href="/assets/js/25.e38d986a.js"><link rel="prefetch" href="/assets/js/26.b44e8359.js"><link rel="prefetch" href="/assets/js/27.164897ca.js"><link rel="prefetch" href="/assets/js/28.30c3dcb6.js"><link rel="prefetch" href="/assets/js/29.0ea1763d.js"><link rel="prefetch" href="/assets/js/3.87c14ff3.js"><link rel="prefetch" href="/assets/js/30.b6b9f227.js"><link rel="prefetch" href="/assets/js/31.d7d6e5fa.js"><link rel="prefetch" href="/assets/js/32.a71c64f7.js"><link rel="prefetch" href="/assets/js/33.6e421306.js"><link rel="prefetch" href="/assets/js/34.0f46b74a.js"><link rel="prefetch" href="/assets/js/35.1d02fd3c.js"><link rel="prefetch" href="/assets/js/36.fc5cc9cb.js"><link rel="prefetch" href="/assets/js/37.af7e5661.js"><link rel="prefetch" href="/assets/js/38.cdd11312.js"><link rel="prefetch" href="/assets/js/4.91553c08.js"><link rel="prefetch" href="/assets/js/40.c4740fee.js"><link rel="prefetch" href="/assets/js/41.37a38f62.js"><link rel="prefetch" href="/assets/js/42.df5bcbd7.js"><link rel="prefetch" href="/assets/js/43.0c0ab294.js"><link rel="prefetch" href="/assets/js/44.1dcaa2ac.js"><link rel="prefetch" href="/assets/js/45.c3b4bbca.js"><link rel="prefetch" href="/assets/js/46.7659ce01.js"><link rel="prefetch" href="/assets/js/47.d6eb360d.js"><link rel="prefetch" href="/assets/js/48.ca9d607b.js"><link rel="prefetch" href="/assets/js/49.8c09eac0.js"><link rel="prefetch" href="/assets/js/5.6d5ca1ce.js"><link rel="prefetch" href="/assets/js/50.3694eddb.js"><link rel="prefetch" href="/assets/js/51.0868c6f4.js"><link rel="prefetch" href="/assets/js/52.513df7cc.js"><link rel="prefetch" href="/assets/js/53.9dcabf12.js"><link rel="prefetch" href="/assets/js/54.70a6c075.js"><link rel="prefetch" href="/assets/js/55.a1d14f80.js"><link rel="prefetch" href="/assets/js/56.7029bd26.js"><link rel="prefetch" href="/assets/js/57.1b116307.js"><link rel="prefetch" href="/assets/js/58.bb74acae.js"><link rel="prefetch" href="/assets/js/59.610e7d4f.js"><link rel="prefetch" href="/assets/js/6.ee71a04b.js"><link rel="prefetch" href="/assets/js/60.98e611f4.js"><link rel="prefetch" href="/assets/js/61.05109453.js"><link rel="prefetch" href="/assets/js/62.f4adfb83.js"><link rel="prefetch" href="/assets/js/63.b63e1591.js"><link rel="prefetch" href="/assets/js/64.1235f2bd.js"><link rel="prefetch" href="/assets/js/65.bfa7cab9.js"><link rel="prefetch" href="/assets/js/66.2574fbb1.js"><link rel="prefetch" href="/assets/js/67.09935f72.js"><link rel="prefetch" href="/assets/js/68.af1ee108.js"><link rel="prefetch" href="/assets/js/69.7a2f9a81.js"><link rel="prefetch" href="/assets/js/7.ed4c5699.js"><link rel="prefetch" href="/assets/js/70.605c490c.js"><link rel="prefetch" href="/assets/js/8.c8b45379.js"><link rel="prefetch" href="/assets/js/9.9d028748.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86682925.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人文档库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.linuxd.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HOLA
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/LinuxDiary/scripts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  脚本
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CentOS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CentOS/boot_order.html" class="sidebar-link">启动顺序</a></li><li><a href="/CentOS/system_initialization.html" class="sidebar-link">系统常用配置</a></li><li><a href="/CentOS/yum.html" class="sidebar-link">yum命令</a></li><li><a href="/CentOS/rpm.html" class="sidebar-link">rpm命令</a></li><li><a href="/CentOS/date_command_opstions.html" class="sidebar-link">date命令选项</a></li><li><a href="/CentOS/system_logs.html" class="sidebar-link">系统日志说明</a></li><li><a href="/CentOS/grep_sed_awk.html" class="sidebar-link">grep sed awk</a></li><li><a href="/CentOS/file_descriptor.html" class="sidebar-link">文件描述符</a></li><li><a href="/CentOS/stdin_stdout_stderr.html" class="sidebar-link">输入输出重定向</a></li><li><a href="/CentOS/iptables.html" class="sidebar-link">iptables</a></li><li><a href="/CentOS/sysctl.html" class="sidebar-link">sysctl基本优化</a></li><li><a href="/CentOS/load_balance.html" class="sidebar-link">双网卡绑定和负载均衡</a></li><li><a href="/CentOS/lvm.html" class="sidebar-link">lvm管理</a></li><li><a href="/CentOS/sendmail.html" class="sidebar-link">sendmail</a></li><li><a href="/CentOS/dns_server.html" class="sidebar-link">DNS Sever</a></li><li><a href="/CentOS/ftp_server.html" class="sidebar-link">FTP Sever</a></li><li><a href="/CentOS/nfs_server.html" class="sidebar-link">NFS Server</a></li><li><a href="/CentOS/ntp_server.html" class="sidebar-link">NTP Sever</a></li><li><a href="/CentOS/lsyncd.html" class="sidebar-link">lsyncd</a></li><li><a href="/CentOS/kvm_virtulization_deploy.html" class="sidebar-link">KVM</a></li><li><a href="/CentOS/vmware_extend_disk.html" class="sidebar-link">VMware虚拟机扩展磁盘容量</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/docker_app.html" class="sidebar-link">Docker应用</a></li><li><a href="/Docker/docker_compose_app.html" class="sidebar-link">Docker-Compose应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Nginx/" class="sidebar-link">介绍</a></li><li><a href="/Nginx/nginx_install.html" class="sidebar-link">安装</a></li><li><a href="/Nginx/nginx_config_files.html" class="sidebar-link">配置文件</a></li><li><a href="/Nginx/nginx_proxy.html" class="sidebar-link">反向代理</a></li><li><a href="/Nginx/nginx_max_clients.html" class="sidebar-link">并发数</a></li><li><a href="/Nginx/linux_optimization_for_nginx.html" class="sidebar-link">内核调优</a></li><li><a href="/Nginx/nginx_php_fpm.html" class="sidebar-link">使用PHP-FPM</a></li><li><a href="/Nginx/keepalived_nginx.html" class="sidebar-link">Keepalived + Nginx</a></li><li><a href="/Nginx/configs.html" class="sidebar-link">常用配置</a></li><li><a href="/Nginx/nginx_log_scripts.html" class="sidebar-link">nginx日志分析</a></li><li><a href="/Nginx/http_code.html" class="sidebar-link">HTTP状态码</a></li><li><a href="/Nginx/error_handle.html" class="sidebar-link">常见错误处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/MySQL/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/MySQL/mysql_installation.html" class="sidebar-link">安装</a></li><li><a href="/MySQL/variables.html" class="sidebar-link">参数</a></li><li><a href="/MySQL/command.html" class="sidebar-link">命令</a></li><li><a href="/MySQL/sql.html" class="sidebar-link">SQL</a></li><li><a href="/MySQL/mysql_scripts.html" class="sidebar-link">脚本</a></li><li><a href="/MySQL/log.html" class="sidebar-link">日志分类</a></li><li><a href="/MySQL/reset_password.html" class="sidebar-link">重置密码</a></li><li><a href="/MySQL/backup.html" class="sidebar-link">备份与恢复</a></li><li><a href="/MySQL/duplication.html" class="sidebar-link">主从复制</a></li><li><a href="/MySQL/optimization.html" class="sidebar-link">运行环境优化</a></li><li><a href="/MySQL/tools.html" class="sidebar-link">实时监控工具</a></li><li><a href="/MySQL/error_code.html" class="sidebar-link">常见错误代码</a></li><li><a href="/MySQL/errors.html" aria-current="page" class="active sidebar-link">错误处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MySQL/errors.html#主从复制错误1" class="sidebar-link">主从复制错误1</a></li><li class="sidebar-sub-header"><a href="/MySQL/errors.html#主从复制错误2" class="sidebar-link">主从复制错误2</a></li><li class="sidebar-sub-header"><a href="/MySQL/errors.html#不能打开innodb-index-stats表" class="sidebar-link">不能打开innodbindexstats表</a></li><li class="sidebar-sub-header"><a href="/MySQL/errors.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/MySQL/innodb.html" class="sidebar-link">InnoDB特性</a></li><li><a href="/MySQL/duplication_case.html" class="sidebar-link">迁移案例</a></li><li><a href="/MySQL/mysql_innodb_cluster.html" class="sidebar-link">MySQL innodb cluster</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python/install_python.html" class="sidebar-link">安装</a></li><li><a href="/Python/django_deployment.html" class="sidebar-link">Django项目部署</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Others/ffmpeg.html" class="sidebar-link">ffmpeg</a></li><li><a href="/Others/mac_tips.html" class="sidebar-link">Mac技巧</a></li><li><a href="/Others/raid_level.html" class="sidebar-link">Raid级别</a></li><li><a href="/Others/servers.html" class="sidebar-link">服务器规划</a></li><li><a href="/Others/memcached.html" class="sidebar-link">Memcached基础</a></li><li><a href="/Others/tomcat_deploy.html" class="sidebar-link">Tomcat部署</a></li><li><a href="/Others/tcp_handshake.html" class="sidebar-link">TCP三次握手四次挥手</a></li><li><a href="/Others/aria2_filebrowser.html" class="sidebar-link">Aria2 离线下载</a></li><li><a href="/Others/word_page_num.html" class="sidebar-link">Word页码编排</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h1> <h2 id="主从复制错误1"><a href="#主从复制错误1" class="header-anchor">#</a> 主从复制错误1</h2> <p><strong>错误代码</strong></p> <blockquote><p>Last_Errno: 1146
Last_Error: Error executing row event: 'Table 'zhcj.z_nzdlhk2wi7pd5aqw' doesn't exist'</p> <p>Last_Errno: 1051
Last_Error: Error 'Unknown table 'zhcj.z_nzdlhk2wi7pd5aqw'' on query. Default database: 'zhcj'. Query: 'DROP TABLE z_nzdlhk2wi7pd5aqw /* generated by server */'</p></blockquote> <p><strong>错误分析</strong></p> <p>以上错误代码是先后出现，处理完 <code>1146</code> 错误之后，出现 <code>1051</code> 错误。 <code>1146</code> 错误提示 <code>z_nzdlhk2wi7pd5aqw</code> 表在 <code>Slave</code> 中不存在，该表是研发人员用程序创建的临时表，并且已经删除，由于之前的 MySQL 账号权限问题导致 <code>Slave</code> 中没有创建这张表，导致了 <code>1146</code> 错误。随后处理之后，因为本身不存在这张表，所以又出现 <code>1051</code> 错误，无法删除表。因此可以直接跳过这两个出错的事务。</p> <p><strong>错误处理</strong></p> <p>这里 <code>MySQL</code> 采用的 <code>GTID</code> 方式的主从复制，跳过这两个报错的事务，让 <code>Slave</code> 继续同步。</p> <p><code>1146</code> 错误时，对应的 <code>Executed_Gtid_Set</code> 是 <code>076a961d-4452-11e8-9b07-c81f66fba165:1-5:7-6267248</code> ，表示事务进行到 <code>6267248</code> 时就停止了，因此这里跳过下一个出错的事务</p> <div class="language-sql extra-class"><pre class="language-sql"><code>STOP SLAVE<span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">'076a961d-4452-11e8-9b07-c81f66fba165:6267249'</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">&quot;AUTOMATIC&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> SLAVE <span class="token keyword">USER</span><span class="token operator">=</span><span class="token string">'rep_user'</span> PASSWORD<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">;</span>
</code></pre></div><p><code>1051</code> 错误时，对应的 <code>Executed_Gtid_Set</code> 是 <code>076a961d-4452-11e8-9b07-c81f66fba165:1-5:7-6267249</code> ，同样跳过处理</p> <div class="language-sql extra-class"><pre class="language-sql"><code>STOP SLAVE<span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">'076a961d-4452-11e8-9b07-c81f66fba165:6267250'</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">&quot;AUTOMATIC&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> SLAVE <span class="token keyword">USER</span><span class="token operator">=</span><span class="token string">'rep_user'</span> PASSWORD<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="主从复制错误2"><a href="#主从复制错误2" class="header-anchor">#</a> 主从复制错误2</h2> <p><strong>错误分析</strong></p> <p><code>show slave status\G</code> 查看从库状态时，发现 <code>IO</code> 和 <code>SQL</code> 都是 <code>yes</code> ，没有任何报错，但是复制却静止在如下状态</p> <div class="language-sql extra-class"><pre class="language-sql"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
···
Retrieved_Gtid_Set: <span class="token number">076</span>a961d<span class="token operator">-</span><span class="token number">4452</span><span class="token operator">-</span><span class="token number">11</span>e8<span class="token operator">-</span><span class="token number">9</span>b07<span class="token operator">-</span>c81f66fba165:<span class="token number">1</span><span class="token operator">-</span><span class="token number">8576114</span>
Executed_Gtid_Set: <span class="token number">076</span>a961d<span class="token operator">-</span><span class="token number">4452</span><span class="token operator">-</span><span class="token number">11</span>e8<span class="token operator">-</span><span class="token number">9</span>b07<span class="token operator">-</span>c81f66fba165:<span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>:<span class="token number">7</span><span class="token operator">-</span><span class="token number">8576113</span>
</code></pre></div><p>刷新多次，重启 <code>slave</code> 都无济于事，后来查看错误日志 <code>error.log</code></p> <blockquote><p>Slave SQL: Rolling back unfinished transaction (no COMMIT or ROLLBACK in relay log). A probable cause is partial transaction left on relay log because of restarting IO thread with auto-positioning protocol. Error_code: 0</p></blockquote> <p>显示一直在回滚一个事务，原因是这个事务的 <code>relay log</code> 中没有 <code>COMMIT</code> 或 <code>ROLLBACK</code> 操作，导致始终在执行、回滚当前事务。</p> <p><strong>错误处理</strong></p> <p>根据事务编号 <code>8576114</code> ，使用 <code>mysqlbinlog</code> 查找该事务的起始和结束 <code>position</code> 编号，分别是 <code>354588467</code> 和 <code>357186032</code> ，然后在 <code>Master</code> 上导出这一段 <code>binlog</code> 日志</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mysqlbinlog binlog.000029 <span class="token parameter variable">-vv</span> --base64-output<span class="token operator">=</span>decode-rows --start-position<span class="token operator">=</span><span class="token number">354588467</span> --stop-position<span class="token operator">=</span><span class="token number">357186032</span> <span class="token operator">&gt;</span> ~/b.sql
</code></pre></div><p><code>binlog</code> 日志中显示这个事务往 <code>a_b</code> 表中插入了一些数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> @<span class="token variable">@SESSION.GTID_NEXT</span><span class="token operator">=</span> <span class="token string">'076a961d-4452-11e8-9b07-c81f66fba165:8576114'</span><span class="token comment">/*!*/</span><span class="token punctuation">;</span>
<span class="token comment">### INSERT INTO `zhcj`.`a_b`</span>
<span class="token comment">### SET</span>
<span class="token comment">###   @1='李明' /* VARSTRING(765) meta=765 nullable=1 is_null=0 */</span>
<span class="token comment">###   @2='b496837b4a1fb60553c930e7158b1566-58346' /* VARSTRING(765) meta=765 nullable=1 is_null=0 */</span>
<span class="token comment">###   @3='2018-06-07 20:21:07' /* VARSTRING(765) meta=765 nullable=1 is_null=0 */</span>
<span class="token comment">###   @4='dev211' /* VARSTRING(765) meta=765 nullable=1 is_null=0 */</span>
···
</code></pre></div><p>经过询问研发人员， <code>a_b</code> 表是一张临时表，没有实际用途。查看 <code>binlog</code> 日志发现 <code>8576114</code> 事务都是对表 <code>a_b</code> 的操作，可以完全忽略，所以直接跳过当前事务，让同步继续执行</p> <div class="language-sql extra-class"><pre class="language-sql"><code>STOP SLAVE<span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">'076a961d-4452-11e8-9b07-c81f66fba165:8576114'</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> GTID_NEXT<span class="token operator">=</span><span class="token string">&quot;AUTOMATIC&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">START</span> SLAVE <span class="token keyword">USER</span><span class="token operator">=</span><span class="token string">'rep_user'</span> PASSWORD<span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">;</span>
</code></pre></div><p>操作完成之后，同步恢复正常， <code>error.log</code> 也没有继续报错。</p> <h2 id="不能打开innodb-index-stats表"><a href="#不能打开innodb-index-stats表" class="header-anchor">#</a> 不能打开innodb_index_stats表</h2> <p><code>innobackupex</code> 命令运行时，执行到 <code>InnoDB: Allocated tablespace ID 2 for mysql/innodb_index_stats, old maximum was 0</code> 时就停止了，并提示</p> <blockquote><p>InnoDB: Attempted to open a previously opened tablespace. Previous tablespace db1/table1 at filepath: ./db1/table1.ibd uses space ID: 1. Cannot open filepath: ./mysql/innodb_table_stats.ibd which uses the same space ID.</p></blockquote> <p>查看错误日志 <code>error.log</code> 之后发现有如下提示</p> <blockquote><p>[Warning] InnoDB: Cannot open table mysql/innodb_index_stats from the internal data dictionary of InnoDB though the .frm file for the table exists. See http://dev.mysql.com/doc/refman/5.6/en/innodb-troubleshooting.html for how you can resolve the problem.</p></blockquote> <p>不能打开 <code>innodb_index_stats</code> 表，类似的还有 <code>innodb_table_stats</code> <code>slave_master_info</code> <code>slave_master_info</code> <code>slave_worker_info</code> 都提示不能打开，但是查看 <code>mysql</code> 中的表清单时，这些表都存在</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
<span class="token keyword">Current</span> <span class="token keyword">database</span>: mysql
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> Tables_in_mysql           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> columns_priv              <span class="token operator">|</span>
<span class="token operator">|</span> ······                    <span class="token operator">|</span>
<span class="token operator">|</span> innodb_index_stats        <span class="token operator">|</span>
<span class="token operator">|</span> innodb_table_stats        <span class="token operator">|</span>
<span class="token operator">|</span> slave_master_info         <span class="token operator">|</span>
<span class="token operator">|</span> slave_relay_log_info      <span class="token operator">|</span>
<span class="token operator">|</span> slave_worker_info         <span class="token operator">|</span>
<span class="token operator">|</span> ······                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
</code></pre></div><p>然后使用 <code>mysqlcheck</code> 命令检查 <code>mysql</code> 库</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ mysqlcheck <span class="token parameter variable">--databases</span> mysql <span class="token parameter variable">--socket</span><span class="token operator">=</span>/home/mysql/u01/mysql-multi/3306/run/mysql.sock <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
Enter password:
mysql.columns_priv                                 OK
mysql.db                                           OK
mysql.event                                        OK
mysql.func                                         OK
mysql.general_log                                  OK
mysql.help_category                                OK
mysql.help_keyword                                 OK
mysql.help_relation                                OK
mysql.help_topic                                   OK
mysql.innodb_index_stats
Error    <span class="token builtin class-name">:</span> Table <span class="token string">'mysql.innodb_index_stats'</span> doesn<span class="token string">'t exist
status   : Operation failed
mysql.innodb_table_stats
Error    : Table '</span>mysql.innodb_table_stats<span class="token string">' doesn'</span>t exist
status   <span class="token builtin class-name">:</span> Operation failed
mysql.ndb_binlog_index                             OK
mysql.plugin                                       OK
mysql.proc                                         OK
mysql.procs_priv                                   OK
mysql.proxies_priv                                 OK
mysql.servers                                      OK
mysql.slave_master_info
Error    <span class="token builtin class-name">:</span> Table <span class="token string">'mysql.slave_master_info'</span> doesn<span class="token string">'t exist
status   : Operation failed
mysql.slave_relay_log_info
Error    : Table '</span>mysql.slave_relay_log_info<span class="token string">' doesn'</span>t exist
status   <span class="token builtin class-name">:</span> Operation failed
mysql.slave_worker_info
Error    <span class="token builtin class-name">:</span> Table <span class="token string">'mysql.slave_worker_info'</span> doesn't exist
status   <span class="token builtin class-name">:</span> Operation failed
mysql.slow_log                                     OK
mysql.tables_priv                                  OK
mysql.time_zone                                    OK
mysql.time_zone_leap_second                        OK
mysql.time_zone_name                               OK
mysql.time_zone_transition                         OK
mysql.time_zone_transition_type                    OK
mysql.user                                         OK
</code></pre></div><p>仍然提示这 <code>5</code> 张表不存在</p> <h3 id="问题分析"><a href="#问题分析" class="header-anchor">#</a> 问题分析</h3> <p>查阅资料发现， <code>MySQL 5.6</code> 以后，如果删除了 <code>ibdata1</code> 文件，重启服务之后会自动创建 <code>ibdata1</code> 文件，但是上述 <code>5</code> 张表不会重建， <code>MySQL 5.5</code> 会重建这 <code>5</code> 张表。
由于之前转移过 <code>data</code> 目录下的文件，导致了这个错误。</p> <h3 id="问题处理"><a href="#问题处理" class="header-anchor">#</a> 问题处理</h3> <p>备份数据库之后，首先 <code>drop</code> 掉这 <code>5</code> 张表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mysql<span class="token punctuation">.</span>innodb_index_stats<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mysql<span class="token punctuation">.</span>innodb_table_stats<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mysql<span class="token punctuation">.</span>slave_master_info<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mysql<span class="token punctuation">.</span>slave_relay_log_info<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> mysql<span class="token punctuation">.</span>slave_worker_info<span class="token punctuation">;</span>
</code></pre></div><p>检查数据库目录 <code>mysql</code> ，如果存在就删除它们</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rm</span> innodb_index_stats.*
<span class="token function">rm</span> innodb_table_stats.*
<span class="token function">rm</span> slave_master_info.*
<span class="token function">rm</span> slave_relay_log_info.*
<span class="token function">rm</span> slave_worker_info.*
</code></pre></div><p>重新建表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>innodb_index_stats<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>database_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>index_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>last_update<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>stat_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>stat_value<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sample_size<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>stat_description<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>database_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>index_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>stat_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin STATS_PERSISTENT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>innodb_table_stats<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>database_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>last_update<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>n_rows<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>clustered_index_size<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sum_of_other_index_sizes<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>database_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_bin STATS_PERSISTENT<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>slave_master_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>Number_of_lines<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Number of lines in the file.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The name of the master binary log currently being read from the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The master log position of the last read event.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Host<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'The host name of the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>User_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The user name used to connect to the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>User_password<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The password used to connect to the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Port<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The network port used to connect to the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Connect_retry<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The period (in seconds) that the slave will wait before trying to reconnect to the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Enabled_ssl<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Indicates whether the server supports SSL connections.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_ca<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The file used for the Certificate Authority (CA) certificate.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_capath<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The path to the Certificate Authority (CA) certificates.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_cert<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The name of the SSL certificate file.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_cipher<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The name of the cipher in use for the SSL connection.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_key<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The name of the SSL key file.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_verify_server_cert<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Whether to verify the server certificate.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Heartbeat<span class="token punctuation">`</span></span> <span class="token keyword">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Bind<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'Displays which interface is employed when connecting to the MySQL server'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ignored_server_ids<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The number of server IDs to be ignored, followed by the actual server IDs'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Uuid<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The master server uuid.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Retry_count<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Number of reconnect attempts, to the master, before giving up.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_crl<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The file used for the Certificate Revocation List (CRL)'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Ssl_crlpath<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token keyword">COMMENT</span> <span class="token string">'The path used for Certificate Revocation List (CRL) files'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Enabled_auto_position<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Indicates whether GTIDs will be used to retrieve events from the master.'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>Host<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>Port<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 STATS_PERSISTENT<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'Master Information'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>slave_relay_log_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>Number_of_lines<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Number of lines in the file or rows in the table. Used to version table definitions.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Relay_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The name of the current relay log file.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Relay_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The relay log position of the last executed event.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The name of the master binary log file from which the events in the relay log file were read.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The master log position of the last executed event.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Sql_delay<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'The number of seconds that the slave must lag behind the master.'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Number_of_workers<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'Internal Id that uniquely identifies this record.'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 STATS_PERSISTENT<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'Relay Log Information'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>slave_worker_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Relay_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Relay_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Master_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_relay_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_relay_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_master_log_name<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_master_log_pos<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_seqno<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_group_size<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Checkpoint_group_bitmap<span class="token punctuation">`</span></span> <span class="token keyword">blob</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 STATS_PERSISTENT<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'Worker Information'</span><span class="token punctuation">;</span>
</code></pre></div><p>操作完成之后，重新启动 <code>MySQL</code> 服务</p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://dba.stackexchange.com/questions/54608/innodb-error-table-mysql-innodb-table-stats-not-found-after-upgrade-to-mys" target="_blank" rel="noopener noreferrer">https://dba.stackexchange.com/questions/54608/innodb-error-table-mysql-innodb-table-stats-not-found-after-upgrade-to-mys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dba.stackexchange.com/questions/48166/cannot-open-table-mysql-innodb-index-stats/48189#48189" target="_blank" rel="noopener noreferrer">https://dba.stackexchange.com/questions/48166/cannot-open-table-mysql-innodb-index-stats/48189#48189<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MySQL/error_code.html" class="prev">
        常见错误代码
      </a></span> <span class="next"><a href="/MySQL/innodb.html">
        InnoDB特性
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ea617b8.js" defer></script><script src="/assets/js/2.6e381248.js" defer></script><script src="/assets/js/39.30bb1d36.js" defer></script>
  </body>
</html>
