(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{220:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"lsyncd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lsyncd"}},[s._v("#")]),s._v(" lsyncd")]),s._v(" "),t("ul",[t("li",[s._v("系统环境：CentOS 7")]),s._v(" "),t("li",[s._v("软件版本：lsyncd-2.2.2")]),s._v(" "),t("li",[s._v("Github地址："),t("a",{attrs:{href:"https://github.com/axkibe/lsyncd",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/axkibe/lsyncd"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("源服务器：192.168.10.52")]),s._v(" "),t("li",[s._v("目标服务器：192.168.10.54")])]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("在源服务器上安装 "),t("code",[s._v("lsyncd")]),s._v(" ，配置后启动 "),t("code",[s._v("lsyncd")]),s._v(" 服务")]),s._v(" "),t("p",[t("strong",[s._v("yum安装")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release.noarch\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lsyncd\n")])])]),t("p",[t("strong",[s._v("编译安装")])]),s._v(" "),t("p",[s._v("安装依赖包，并创建 "),t("code",[s._v("lsync")]),s._v(" 用户")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" cmake gcc gcc-c++ autoconf automake lua lua-devel\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" lsync\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" lsync\n")])])]),t("p",[s._v("切换到 "),t("code",[s._v("lsync")]),s._v(" 普通用户，编译安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - lsync\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ~/u01/lsyncd-2.2.2/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("src,log,run,etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/u01/lsyncd-2.2.2/src\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/axkibe/lsyncd/archive/release-2.2.2.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf release-2.2.2.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" lsyncd-release-2.2.2\ncmake "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DCMAKE_INSTALL_PREFIX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/lsync/u01/lsyncd-2.2.2\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/u01/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /home/lsync/u01/lsyncd-2.2.2/ /home/lsync/u01/lsyncd\n")])])]),t("h2",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("p",[s._v("编辑配置文件，编译安装的配置文件位于 "),t("code",[s._v("/home/lsync/u01/lsyncd/etc/lsyncd.conf")]),s._v(" ， "),t("code",[s._v("yum")]),s._v(" 安装的配置文件位于 "),t("code",[s._v("/etc/lsyncd.conf")])]),s._v(" "),t("p",[t("strong",[s._v("本地同步")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("settings "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    logfile      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/log/lsyncd.log"')]),s._v(",\n    statusFile   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/log/lsyncd.status"')]),s._v(",\n    pidfile      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/run/lsyncd.pid"')]),s._v(",\n    inotifyMode  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CloseWrite"')]),s._v(",\n    maxProcesses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(",\n    nodaemon "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" false,\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    default.rsync,\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/upload"')]),s._v(",\n    target    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/upload_bak"')]),s._v(",\n    delay     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(",\n    -- excludeFrom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsyncd.d/rsync_exclude.lst"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        binary    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/rsync"')]),s._v(",\n        archive   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        compress  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        verbose   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        bwlimit   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("strong",[s._v("通过ssh同步")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("settings "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    logfile      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/log/lsyncd.log"')]),s._v(",\n    statusFile   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/log/lsyncd.status"')]),s._v(",\n    pidfile      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/u01/lsyncd/run/lsyncd.pid"')]),s._v(",\n    inotifyMode  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CloseWrite"')]),s._v(",\n    maxProcesses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n    nodaemon "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" false,\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    default.rsyncssh,\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/lsync/master_backup"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql@192.168.10.54"')]),s._v(",\n    targetdir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/mysql/master_backup"')]),s._v(",\n    delay     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(",\n    -- excludeFrom "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsyncd.d/rsync_exclude.lst"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        binary    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/rsync"')]),s._v(",\n        archive   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        compress  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        verbose   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true,\n        bwlimit   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    port  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("62122")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),t("h3",{attrs:{id:"创建ssh秘钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建ssh秘钥"}},[s._v("#")]),s._v(" 创建ssh秘钥")]),s._v(" "),t("p",[t("code",[s._v("ssh")]),s._v(" 秘钥用于访问远程同步的目标服务器(192.168.10.54)，在本机(192.168.10.52)配置好后，向目标服务器导入 "),t("code",[s._v("ssh key")]),s._v(" ，实现通过 "),t("code",[s._v("ssh")]),s._v(" 秘钥免密远程同步")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" rsa\nssh-copy-id "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" ~/.ssh/id_rsa mysql@192.168.10.54\n")])])]),t("p",[s._v("按提示输入远程服务器用户的密码")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("创建远程服务器秘钥后，需要 "),t("code",[s._v("ssh")]),s._v(" 秘钥对应的远程服务器用户对 "),t("code",[s._v("lsyncd")]),s._v(" 配置的远程服务器路径有读写权限。")])]),s._v(" "),t("h3",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start lsyncd.service\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" lsyncd.service\n")])])]),t("p",[s._v("如果是编译安装，则通过以下方式启动服务")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - lsync\n/home/lsync/u01/lsyncd/bin/lsyncd /home/lsync/u01/lsyncd/etc/lsyncd.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.ssh.com/ssh/keygen/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.ssh.com/ssh/keygen/"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"http://seanlook.com/2015/05/06/lsyncd-synchronize-realtime/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://seanlook.com/2015/05/06/lsyncd-synchronize-realtime/"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://renwole.com/archives/1001",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://renwole.com/archives/1001"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);