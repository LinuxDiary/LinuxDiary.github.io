(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{221:function(a,s,e){"use strict";e.r(s);var t=e(6),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"lvm管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lvm管理"}},[a._v("#")]),a._v(" lvm管理")]),a._v(" "),s("ul",[s("li",[a._v("系统环境：CentOS 7")]),a._v(" "),s("li",[a._v("软件版本：lvm2")])]),a._v(" "),s("h2",{attrs:{id:"新建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建"}},[a._v("#")]),a._v(" 新建")]),a._v(" "),s("p",[a._v("通常在安装操作系统时就创建 "),s("code",[a._v("lvm")]),a._v(" ，这里是在已安装好操作系统且未配置过 "),s("code",[a._v("lvm")]),a._v(" 的环境下创建新的 "),s("code",[a._v("lvm")])]),a._v(" "),s("h3",{attrs:{id:"安装lvm2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装lvm2"}},[a._v("#")]),a._v(" 安装lvm2")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" lvm2\n")])])]),s("h3",{attrs:{id:"创建物理卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建物理卷"}},[a._v("#")]),a._v(" 创建物理卷")]),a._v(" "),s("p",[a._v("物理卷可以是一个分区，也可以是一整块磁盘")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("pvcreate /dev/sda2\n")])])]),s("p",[a._v("查看创建好的物理卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("pvs\n\nPV VG Fmt Attr PSize PFree\n/dev/sda2 cl lvm2 a-- "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29")]),a._v(".00g "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(".00m\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("pvdisplay\n\n--- Physical volume ---\nPV Name /dev/sda2\nVG Name cl\nPV Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29.00")]),a._v(" GiB / not usable "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.00")]),a._v(" MiB\nAllocatable "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v("\nPE Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.00")]),a._v(" MiB\nTotal PE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7423")]),a._v("\nFree PE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nAllocated PE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7422")]),a._v("\nPV UUID TN6Hvw-4C4D-pceR-Beqx-CTUm-7L7b-8oFozr\n")])])]),s("h3",{attrs:{id:"创建卷组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建卷组"}},[a._v("#")]),a._v(" 创建卷组")]),a._v(" "),s("p",[a._v("一个卷组就是一个物理卷的集合，创建时可以指定多个已创建的物理卷，也可以向已存在的卷组中添加新的物理卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("vgcreate VGNAME /dev/sda2\n")])])]),s("p",[a._v("查看创建好的卷组")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("vgs\n\nVG "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#PV #LV #SN Attr VSize VFree")]),a._v("\ncl "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" wz--n- "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29")]),a._v(".00g "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(".00m\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("vgdisplay\n\n--- Volume group ---\nVG Name cl\nSystem ID\nFormat lvm2\nMetadata Areas "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nMetadata Sequence No "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\nVG Access read/write\nVG Status resizable\nMAX LV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nCur LV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\nOpen LV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\nMax PV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nCur PV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nAct PV "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nVG Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29.00")]),a._v(" GiB\nPE Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.00")]),a._v(" MiB\nTotal PE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7423")]),a._v("\nAlloc PE / Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7422")]),a._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("28.99")]),a._v(" GiB\nFree PE / Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" / "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.00")]),a._v(" MiB\nVG UUID 3Wspeg-DuBe-V4yu-QuIk-90eS-D0TC-FLwOaU\n")])])]),s("h3",{attrs:{id:"创建逻辑卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建逻辑卷"}},[a._v("#")]),a._v(" 创建逻辑卷")]),a._v(" "),s("p",[a._v("逻辑卷的创建就是从卷组中获取指定的容量，来创建一个虚拟的可格式化的磁盘分区，卷组就相当于一个由多个真实的物理卷组成的存储池，而逻辑卷不关心物理卷的大小和数量。")]),a._v(" "),s("p",[a._v("这里创建一个 "),s("code",[a._v("20G")]),a._v(" 的逻辑卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvcreate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" LVNAME "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" 20G VGNAME\n")])])]),s("p",[a._v("查看逻辑卷")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvs\n\nLV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert\nroot cl -wi-ao---- "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("26")]),a._v(".99g\nswap cl -wi-ao---- "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".00g\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvdisplay\n\n--- Logical volume ---\nLV Path /dev/cl/swap\nLV Name swap\nVG Name cl\nLV UUID 2TMxpT-Ed6t-OJNr-rKbJ-Fep6-3kQO-A30ntK\nLV Write Access read/write\nLV Creation host, "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("time")]),a._v(" localhost.localdomain, "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2017")]),a._v("-09-04 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(":30:26 +0800\nLV Status available\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# open 2")]),a._v("\nLV Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.00")]),a._v(" GiB\nCurrent LE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("512")]),a._v("\nSegments "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nAllocation inherit\nRead ahead sectors auto\n- currently "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" to "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8192")]),a._v("\nBlock device "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("253")]),a._v(":1\n\n--- Logical volume ---\nLV Path /dev/cl/root\nLV Name root\nVG Name cl\nLV UUID UfjHjv-bWzI-FMKs-ze0A-7GoI-Z3ho-oguZ61\nLV Write Access read/write\nLV Creation host, "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("time")]),a._v(" localhost.localdomain, "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2017")]),a._v("-09-04 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(":30:26 +0800\nLV Status available\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# open 1")]),a._v("\nLV Size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("26.99")]),a._v(" GiB\nCurrent LE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6910")]),a._v("\nSegments "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\nAllocation inherit\nRead ahead sectors auto\n- currently "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" to "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8192")]),a._v("\nBlock device "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("253")]),a._v(":0\n")])])]),s("h3",{attrs:{id:"使用逻辑卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用逻辑卷"}},[a._v("#")]),a._v(" 使用逻辑卷")]),a._v(" "),s("p",[a._v("逻辑卷创建好之后，就和真实的物理磁盘分区一样，直接格式化就可以使用了，当然也可以添加到 "),s("code",[a._v("fstab")]),a._v(" 文件中")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mkfs.ext4 /dev/VGNAME/LVNAME\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" /dev/VGNAME/LVNAME /mnt\n")])])]),s("h3",{attrs:{id:"删除逻辑卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除逻辑卷"}},[a._v("#")]),a._v(" 删除逻辑卷")]),a._v(" "),s("p",[a._v("删除之前，一定要注意逻辑卷分区中的数据。要删除逻辑卷，要遵循顺序 "),s("code",[a._v("lv --\x3e vg --\x3e pv")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvremove /dev/VGNAME/LVNAME\nvgremove VGNAME\npvremove /dev/sdb\n")])])]),s("h2",{attrs:{id:"动态扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态扩展"}},[a._v("#")]),a._v(" 动态扩展")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("新增物理卷")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("pvcreate /dev/sdd\n")])])]),s("ul",[s("li",[s("strong",[a._v("把物理卷添加到卷组")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("vgextend VGNAME /dev/sdd\n")])])]),s("ul",[s("li",[s("strong",[a._v("扩展逻辑卷容量")])])]),a._v(" "),s("p",[a._v("扩展逻辑卷是热操作，可以直接在线执行，有以下两种扩展方式")]),a._v(" "),s("p",[a._v("增加10G到LVNAME卷中")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvextend "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" +10G /dev/VGNAME/LVNAME\n")])])]),s("p",[a._v("增加剩余所有容量到卷中")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvextend "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" +100%FREE /dev/VGNAME/LVNAME　　\n")])])]),s("ul",[s("li",[s("strong",[a._v("更新文件系统容量")])])]),a._v(" "),s("p",[a._v("扩展容量后，只有更新之后才会生效")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("resize2fs /dev/VGNAME/LVNAME  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#适用于ext2、3、4文件系统")]),a._v("\nxfs_growfs /dev/VGNAME/LVNAME  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#适用于xfs文件系统")]),a._v("\n")])])]),s("h2",{attrs:{id:"缩小lv并删除pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缩小lv并删除pv"}},[a._v("#")]),a._v(" 缩小lv并删除pv")]),a._v(" "),s("h3",{attrs:{id:"缩小逻辑卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缩小逻辑卷"}},[a._v("#")]),a._v(" 缩小逻辑卷")]),a._v(" "),s("p",[a._v("要执行逻辑卷缩小操作，必须先转移数据并取消挂载，且操作顺序必须是 "),s("code",[a._v("umount --\x3e resize2fs --\x3e lvreduce")]),a._v(" ，假设总容量 "),s("code",[a._v("20G")]),a._v(" ，要减少 "),s("code",[a._v("10G")]),a._v(" 左右")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("卸载逻辑卷")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("umount")]),a._v(" /dev/VGNAME/LVNAME\n")])])]),s("ul",[s("li",[s("strong",[a._v("重新定义逻辑卷大小")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("resize2fs /dev/VGNAME/LVNAME 10G\n")])])]),s("ul",[s("li",[s("strong",[a._v("减少逻辑卷容量")])])]),a._v(" "),s("p",[a._v("把逻辑卷较少 "),s("code",[a._v("9G")]),a._v(" 容量，为防止数据丢失，减少的容量尽量少于实际计算所得容量")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvreduce "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-9G")]),a._v(" /dev/VGNAME/LVNAME\n")])])]),s("p",[a._v("把逻辑卷减少到 "),s("code",[a._v("9G")]),a._v(" ，缩小后的容量必须大于已经使用的空间")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lvreduce "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" 9G /dev/VGNAME/LVNAME\n")])])]),s("ul",[s("li",[s("strong",[a._v("重新挂载逻辑卷")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" /dev/VGNAME/LVNAME /mnt\n")])])]),s("h3",{attrs:{id:"缩小卷组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缩小卷组"}},[a._v("#")]),a._v(" 缩小卷组")]),a._v(" "),s("p",[a._v("缩小卷组容量，退出物理卷（物理硬盘）。缩小前必须确认 "),s("code",[a._v("vg")]),a._v(" 空闲容量大于要退出的物理卷容量 "),s("code",[a._v("/dev/sdd")]),a._v(" ，否则可能造成数据丢失")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("vgreduce VGNAME /dev/sdd\npvremove /dev/sdd\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);