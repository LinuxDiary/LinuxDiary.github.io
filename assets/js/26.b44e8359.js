(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{225:function(t,a,s){"use strict";s.r(a);var e=s(6),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"sysctl基本优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysctl基本优化"}},[t._v("#")]),t._v(" sysctl基本优化")]),t._v(" "),a("h2",{attrs:{id:"sysctl-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysctl-conf"}},[t._v("#")]),t._v(" sysctl.conf")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁用ipv6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv6.conf.all.disable_ipv6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv6.conf.default.disable_ipv6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建TCP连接时，发送SYN的重试次数，小于127，默认为6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_syn_retries")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 被连接时，发送SYN+ACK的重试次数，小于255，默认为5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_synack_retries")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# keepalive 空闲时长，默认7200秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_keepalive_time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("600")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 tcp_keepalive_time 之后没有收到对方应答时，keepalive 探测包的发送个数，超过3个就认为TCP连接已中断，默认为9")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_keepalive_probes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("3")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# keepalive 探测包发送的时间间隔，默认为75秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_keepalive_intvl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("15")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 丢弃已激活的TCP连接前重试的次数，默认为15")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_retries2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("5")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FIN_WAIT_2的超时等待时间，默认为60秒")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_fin_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("30")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 系统允许的最大TIMEWAIT socket数，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_max_tw_buckets")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("60000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许重用TIMEWAIT socket为新连接，默认是2(仅用于loopback)，0为不允许")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_tw_reuse")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当SYN队列溢出时，启用syncookie来处理，可防止SYN flood攻击，默认为1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_syncookies")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 被连接端在回复ack之前，可接收最大的SYN队列，最小值128，可根据内存适当增加该值")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_max_syn_backlog")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("16384")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为每个TCP分配的写缓冲区大小，min default max 默认为 4096 16384 64K~4MB(根据内存大小)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_wmem")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("51200 131072 204800")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 为每个TCP分配的读缓冲区大小，min default max 默认为 4096 87380 87380~6MB(根据内存大小)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.tcp_rmem")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("51200 131072 204800")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义本地的TCP/UDP端口可用范围，默认32768~60999")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.ipv4.ip_local_port_range")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1024 65000")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 系统级的每个端口的监听(listen)队列长度，也是系统全连接最大队列数，默认为128")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.core.somaxconn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("16384")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的最大数目，一旦超过将被丢弃，默认为300")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.core.netdev_max_backlog")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("16384")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许超过CommitLimit继续申请内存，因为申请的内存不一定会全部使用，开启该项可用最大限度的使用内存")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("vm.overcommit_memory")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TCP连接超时时间，最后不低于tcp_keepalive_time，默认是432000秒(5天)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("net.netfilter.nf_conntrack_tcp_timeout_established")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1200")]),t._v("\n")])])]),a("p",[t._v("其中 "),a("code",[t._v("tcp_tw_recycle")]),t._v(" 参数已从新版内核中删除，且在 "),a("code",[t._v("NAT")]),t._v(" 环境下配置该参数为 "),a("code",[t._v("1")]),t._v(" 可能会出错\n"),a("code",[t._v("tcp_max_orphans")]),t._v(" 是为了防御简单 "),a("code",[t._v("DDOS")]),t._v(" 攻击，一般不设置")]),t._v(" "),a("p",[a("code",[t._v("net.nf_conntrack_max")]),t._v(" 和 "),a("code",[t._v("net.netfilter.nf_conntrack_max")]),t._v(" 为防火墙连接跟踪表的最大值，正确设置方法为")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/modprobe.d/nf_conntrack.conf\noptions nf_conntrack "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("hashsize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("262144")]),t._v("\n")])])]),a("p",[a("code",[t._v("CentOS7")]),t._v(" 下 "),a("code",[t._v("nf_conntrack_max=hashsize*8")]),t._v(" ，重启 "),a("code",[t._v("iptables")]),t._v(" 后 "),a("code",[t._v("nf_conntrack_max")]),t._v(" 会被重置为默认。")]),t._v(" "),a("h2",{attrs:{id:"sysctl命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysctl命令"}},[t._v("#")]),t._v(" sysctl命令")]),t._v(" "),a("p",[t._v("立即生效内核参数")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /etc/sysctl.conf\n")])])]),a("p",[t._v("查看所有内核参数")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v("\n")])])]),a("p",[t._v("临时修改内核参数")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysctl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VARIABLE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("VALUE\n")])])]),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://huoding.com/2016/09/05/542",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://huoding.com/2016/09/05/542"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/networking/ip-sysctl.txt?spm=a2c63.o282931.a3.10.4e9b2e8ehasJcw&file=ip-sysctl.txt",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/networking/ip-sysctl.txt?spm=a2c63.o282931.a3.10.4e9b2e8ehasJcw&file=ip-sysctl.txt"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/huangyimo/article/details/80077149",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/huangyimo/article/details/80077149"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://linuxperf.com/?p=102",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://linuxperf.com/?p=102"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://jm.taobao.org/2017/05/25/525-1/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://jm.taobao.org/2017/05/25/525-1/"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);