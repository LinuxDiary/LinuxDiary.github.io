(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{190:function(e,t,v){e.exports=v.p+"assets/img/osi.371ef676.png"},191:function(e,t,v){e.exports=v.p+"assets/img/3-ways.60421ceb.gif"},192:function(e,t,v){e.exports=v.p+"assets/img/3-ways-package.d8d39f01.png"},193:function(e,t,v){e.exports=v.p+"assets/img/data-transfer.f25c3f0a.gif"},194:function(e,t,v){e.exports=v.p+"assets/img/data-transfer-package.02bd7966.png"},195:function(e,t,v){e.exports=v.p+"assets/img/4-byes.6ca5e256.gif"},196:function(e,t,v){e.exports=v.p+"assets/img/4-byes-package.c47eba44.png"},269:function(e,t,v){"use strict";v.r(t);var _=v(6),a=Object(_.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"tcp三次握手四次挥手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp三次握手四次挥手"}},[e._v("#")]),e._v(" TCP三次握手四次挥手")]),e._v(" "),t("h2",{attrs:{id:"osi模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#osi模型"}},[e._v("#")]),e._v(" OSI模型")]),e._v(" "),t("p",[t("img",{attrs:{src:v(190),alt:"osi.png"}})]),e._v(" "),t("h2",{attrs:{id:"tcp特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp特点"}},[e._v("#")]),e._v(" TCP特点")]),e._v(" "),t("p",[t("code",[e._v("TCP")]),e._v(" 传输控制协议，最大的特点就是可靠性。 "),t("code",[e._v("TCP")]),e._v(" 的连接需要经过三次握手之后建立，经过四次挥手后关闭连接。三次握手和四次挥手是保证 "),t("code",[e._v("TCP")]),e._v(" 连接可靠性的重要过程。除此之外， "),t("code",[e._v("TCP")]),e._v(" 还具有丢包重传的特点。\n"),t("code",[e._v("TCP")]),e._v(" 建立连接时是三次握手，而关闭连接时是四次挥手，因为是三次握手中第二次是发送了 "),t("code",[e._v("2")]),e._v(" 个消息 "),t("code",[e._v("SYN+ACK")]),e._v(" ，其实这两个消息也可以分开发，在实际环境中有时候建立连接实际上是四次握手。")]),e._v(" "),t("h2",{attrs:{id:"三次握手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[e._v("#")]),e._v(" 三次握手")]),e._v(" "),t("p",[e._v("三次握手过程如下所示， "),t("code",[e._v("Client")]),e._v(" 与 "),t("code",[e._v("Server")]),e._v(" 是相对而言，并非指具体的客户端和服务端。")]),e._v(" "),t("p",[t("img",{attrs:{src:v(191),alt:"3-ways.gif"}})]),e._v(" "),t("p",[e._v("从具体数据包看三次握手过程")]),e._v(" "),t("p",[t("img",{attrs:{src:v(192),alt:"3-ways-package.png"}})]),e._v(" "),t("p",[e._v("每一个数据包都包含一个 "),t("code",[e._v("seq")]),e._v(" 序列号，具体的 "),t("code",[e._v("seq")]),e._v(" 和 "),t("code",[e._v("ack")]),e._v(" 变化过程如下")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Client")]),e._v(" 发送 "),t("code",[e._v("SYN")]),e._v(" 消息， "),t("code",[e._v("seq=u")])]),e._v(" "),t("li",[t("code",[e._v("Server")]),e._v(" 发送 "),t("code",[e._v("SYN+ACK")]),e._v(" 消息， "),t("code",[e._v("seq=w,ack=u+1")])]),e._v(" "),t("li",[t("code",[e._v("Client")]),e._v(" 发送 "),t("code",[e._v("ACK")]),e._v(" 消息， "),t("code",[e._v("seq=u+1,ack=w+1")])])]),e._v(" "),t("p",[e._v("由此看出，每一个数据包的 "),t("code",[e._v("ack")]),e._v(" 消息都与上一个数据包有所关联，这是 "),t("code",[e._v("TCP")]),e._v(" 可靠性的一种体现。")]),e._v(" "),t("h2",{attrs:{id:"数据传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据传输"}},[e._v("#")]),e._v(" 数据传输")]),e._v(" "),t("p",[e._v("数据传输过程如下所示")]),e._v(" "),t("p",[t("img",{attrs:{src:v(193),alt:"data-transfer.gif"}})]),e._v(" "),t("p",[e._v("从具体数据包看数据传输过程")]),e._v(" "),t("p",[t("img",{attrs:{src:v(194),alt:"data-transfer-package.png"}})]),e._v(" "),t("p",[e._v("在 "),t("code",[e._v("TCP")]),e._v(" 连接建立之后，一端向另一端发送数据包后，会收到一个 "),t("code",[e._v("ack")]),e._v(" 的回复以确定数据包已送达，如果在一定时间内没有收到 "),t("code",[e._v("ack")]),e._v(" 回复，则发送端会认为数据包没有送达，这时会重新发送一次，直到收到 "),t("code",[e._v("ack")]),e._v(" 回复。")]),e._v(" "),t("h2",{attrs:{id:"四次挥手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[e._v("#")]),e._v(" 四次挥手")]),e._v(" "),t("p",[e._v("四次挥手过程如下所示")]),e._v(" "),t("p",[t("img",{attrs:{src:v(195),alt:"4-byes.gif"}})]),e._v(" "),t("p",[e._v("从具体数据包看四次挥手")]),e._v(" "),t("p",[t("img",{attrs:{src:v(196),alt:"4-byes-package.png"}})]),e._v(" "),t("p",[e._v("四次挥手过程中 "),t("code",[e._v("seq")]),e._v(" 与 "),t("code",[e._v("ack")]),e._v(" 的具体变化如下")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Client")]),e._v(" 发送 "),t("code",[e._v("FIN")]),e._v(" 消息， "),t("code",[e._v("seq=u,ack=w")])]),e._v(" "),t("li",[t("code",[e._v("Server")]),e._v(" 发送 "),t("code",[e._v("ACK")]),e._v(" 消息， "),t("code",[e._v("seq=w,ack=u+1")])]),e._v(" "),t("li",[t("code",[e._v("Server")]),e._v(" 发送 "),t("code",[e._v("FIN")]),e._v(" 消息， "),t("code",[e._v("seq=w,ack=u+1")])]),e._v(" "),t("li",[t("code",[e._v("Client")]),e._v(" 发送 "),t("code",[e._v("ACK")]),e._v(" 消息， "),t("code",[e._v("seq=u+1,ack=w+1")])])]),e._v(" "),t("h2",{attrs:{id:"tcp状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp状态"}},[e._v("#")]),e._v(" TCP状态")]),e._v(" "),t("p",[t("code",[e._v("TCP")]),e._v(" 无论是在三次握手还是四次挥手过程中， "),t("code",[e._v("Client")]),e._v(" 和 "),t("code",[e._v("Server")]),e._v(" 端 (通过 "),t("code",[e._v("netstat -antp")]),e._v(" 命令可查看某时刻的 "),t("code",[e._v("TCP")]),e._v(" 状态) 都是从一个状态转换到另一个状态，直到双方都达到 "),t("code",[e._v("established")]),e._v(" 或 "),t("code",[e._v("closed")]),e._v(" 状态，常见的 "),t("code",[e._v("TCP")]),e._v(" 状态如下")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("状态")]),e._v(" "),t("th",[e._v("说明")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("LISTEN")]),e._v(" "),t("td",[e._v("侦听状态。")])]),e._v(" "),t("tr",[t("td",[e._v("SYN-SENT")]),e._v(" "),t("td",[e._v("Client 在发送连接请求后等待匹配的连接请求。通过connect()函数向 Server 发出一个同步（SYNC）信号后进入此状态。")])]),e._v(" "),t("tr",[t("td",[e._v("SYN-RECEIVED")]),e._v(" "),t("td",[e._v("Server 已经收到并发送同步（SYNC）信号之后等待确认（ACK）请求。")])]),e._v(" "),t("tr",[t("td",[e._v("ESTABLISHED")]),e._v(" "),t("td",[e._v("连接已建立，可以开始发送数据。")])]),e._v(" "),t("tr",[t("td",[e._v("FIN-WAIT-1")]),e._v(" "),t("td",[e._v("Client 或 Server 主动调用 close() 函数发出 FIN 请求包，表示本方的数据发送全部结束，等待连接另一端的确认包或 FIN 请求包。")])]),e._v(" "),t("tr",[t("td",[e._v("FIN-WAIT-2")]),e._v(" "),t("td",[e._v("Client 或 Server 主动关闭端在 FIN-WAIT-1 状态下收到确认包，进入等待远程 TCP 的连接终止请求的半关闭状态。这时可以接收数据，但不再发送数据。")])]),e._v(" "),t("tr",[t("td",[e._v("CLOSE-WAIT")]),e._v(" "),t("td",[e._v("Client 或 Server 被动关闭端接到 FIN 后，就发出 ACK 以回应 FIN 请求，并进入等待本地用户的连接终止请求的半关闭状态。这时可以发送数据，但不再接收数据。")])]),e._v(" "),t("tr",[t("td",[e._v("CLOSING")]),e._v(" "),t("td",[e._v("Client 或 Server 在发出 FIN 后，又收到对方发来的 FIN 后，进入等待对方对连接终止（FIN）的确认（ACK）的状态。")])]),e._v(" "),t("tr",[t("td",[e._v("LAST-ACK")]),e._v(" "),t("td",[e._v("Client 或 Server 被动关闭端全部数据发送完成之后，向主动关闭端发送 FIN ，进入等待确认包的状态。")])]),e._v(" "),t("tr",[t("td",[e._v("TIME-WAIT")]),e._v(" "),t("td",[e._v("Client 或 Server 主动关闭端接收到 FIN 后，就发送 ACK 包，等待足够时间以确保被动关闭端收到了终止请求的确认包。[按照RFC 793，一个连接可以在TIME-WAIT保证最大四分钟，即最大分段寿命（maximum segment lifetime）的2倍]")])]),e._v(" "),t("tr",[t("td",[e._v("CLOSED")]),e._v(" "),t("td",[e._v("连接完全关闭。")])])])]),e._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://jm.taobao.org/2017/06/08/20170608/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://jm.taobao.org/2017/06/08/20170608/"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.im/post/5b29d2c4e51d4558b80b1d8c",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://juejin.im/post/5b29d2c4e51d4558b80b1d8c"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.im/post/583d2d6a67f356006bb7d535",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://juejin.im/post/583d2d6a67f356006bb7d535"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.jianshu.com/p/6e9e4156ece3",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/6e9e4156ece3"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.jianshu.com/p/9f3e879a4c9c",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/9f3e879a4c9c"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://yq.aliyun.com/articles/607001?spm=a2c4e.11153959.teamhomeleft.46.13771810BuJFyF",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://yq.aliyun.com/articles/607001?spm=a2c4e.11153959.teamhomeleft.46.13771810BuJFyF"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=a.exports}}]);