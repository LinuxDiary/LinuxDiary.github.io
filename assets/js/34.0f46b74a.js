(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{235:function(a,s,t){"use strict";t.r(s);var e=t(6),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"备份与恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份与恢复"}},[a._v("#")]),a._v(" 备份与恢复")]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#mysqldump"}},[a._v("mysqldump")]),s("ul",[s("li",[s("a",{attrs:{href:"#备份方法"}},[a._v("备份方法")])]),s("li",[s("a",{attrs:{href:"#备份方案"}},[a._v("备份方案")])]),s("li",[s("a",{attrs:{href:"#恢复方法"}},[a._v("恢复方法")])])])]),s("li",[s("a",{attrs:{href:"#xtrabackup"}},[a._v("Xtrabackup")]),s("ul",[s("li",[s("a",{attrs:{href:"#安装"}},[a._v("安装")])]),s("li",[s("a",{attrs:{href:"#备份方法"}},[a._v("备份方法")])]),s("li",[s("a",{attrs:{href:"#备份方案"}},[a._v("备份方案")])]),s("li",[s("a",{attrs:{href:"#备份脚本和计划任务"}},[a._v("备份脚本和计划任务")])]),s("li",[s("a",{attrs:{href:"#恢复数据"}},[a._v("恢复数据")])])])]),s("li",[s("a",{attrs:{href:"#参考链接"}},[a._v("参考链接")])])])]),s("p"),a._v(" "),s("p",[s("code",[a._v("MySQL")]),a._v(" 版本为 "),s("code",[a._v("5.36")]),a._v(" ，已启用 "),s("code",[a._v("log_bin")]),a._v(" ，使用 "),s("code",[a._v("InnoDB")]),a._v(" 存储引擎，二进制日志格式为 "),s("code",[a._v("ROW")]),a._v(" ， "),s("code",[a._v("binlog-do-db")]),a._v(" 为 "),s("code",[a._v("db1")]),a._v(" ，只记录 "),s("code",[a._v("db1")]),a._v(" 的二进制日志，备份与恢复主要只针对 "),s("code",[a._v("db1")]),a._v(" 。")]),a._v(" "),s("h2",{attrs:{id:"mysqldump"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump"}},[a._v("#")]),a._v(" mysqldump")]),a._v(" "),s("p",[s("code",[a._v("mysqldump")]),a._v(" 是逻辑备份工具，导出的是逻辑的 "),s("code",[a._v("SQL")]),a._v(" 脚本文件，可以根据实际情况编辑 "),s("code",[a._v("SQL")]),a._v(" 文件。")]),a._v(" "),s("h3",{attrs:{id:"备份方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份方法"}},[a._v("#")]),a._v(" 备份方法")]),a._v(" "),s("p",[a._v("整库备份时如果同时有 "),s("code",[a._v("MyISAM")]),a._v(" 和 "),s("code",[a._v("InnoDB")]),a._v(" 数据库，则需要加上 "),s("code",[a._v("--lock-all-tables")]),a._v(" 选项，在备份期间会加上全局读锁。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" --master-data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --lock-all-tables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--routines")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--triggers")]),a._v(" --flush-logs --all-databases "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" all_data.sql\n")])])]),s("p",[a._v("使用压缩")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" --master-data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --lock-all-tables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--routines")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--triggers")]),a._v(" --flush-logs --all-databases "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" all_data.sql.gz\n")])])]),s("p",[a._v("如果需要对某一个或几个数据库备份，则使用 "),s("code",[a._v("--databases")]),a._v(" 选项并指定库名，即 "),s("code",[a._v("--databases db1 db2")]),a._v(" 。在备份 "),s("code",[a._v("MyISAM")]),a._v(" 数据库时，使用 "),s("code",[a._v("--lock-all-tables")]),a._v(" 选项，而备份 "),s("code",[a._v("InnoDB")]),a._v(" 数据库时，使用 "),s("code",[a._v("--single-transaction")]),a._v(" 选项启用单事务处理，不影响其他事务的执行。")]),a._v(" "),s("h3",{attrs:{id:"备份方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份方案"}},[a._v("#")]),a._v(" 备份方案")]),a._v(" "),s("p",[a._v("以周为单位，采用全量+增量的备份方式，每周一凌晨 "),s("code",[a._v("1:00")]),a._v(" 对 "),s("code",[a._v("db1")]),a._v(" 执行全量备份，然后每周一至周日 "),s("code",[a._v("23:55")]),a._v(" 对 "),s("code",[a._v("db1")]),a._v(" 执行增量备份，增量备份的频率可以根据实际情况调整。在这种方案下，一个单位备份之后，会缺失周日 "),s("code",[a._v("23:55")]),a._v(" 到周一 "),s("code",[a._v("1:00")]),a._v(" 之间的增量，一般来说可以接受。")]),a._v(" "),s("h4",{attrs:{id:"周一全量备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周一全量备份"}},[a._v("#")]),a._v(" 周一全量备份")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" ~/backup/week1\nmysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--opt")]),a._v(" --master-data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --single-transaction "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--routines")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--triggers")]),a._v(" --flush-logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--databases")]),a._v(" db1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ~/backup/week1/db1_full_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(".sql\n")])])]),s("h4",{attrs:{id:"周一增量备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周一增量备份"}},[a._v("#")]),a._v(" 周一增量备份")]),a._v(" "),s("p",[a._v("获取周一全量备份时记录的 "),s("code",[a._v("CHANGE MASTER")]),a._v(" 信息")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" db1_full_2017-12-12.sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'CHANGE MASTER'")]),a._v("\n-- CHANGE MASTER TO "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MASTER_LOG_FILE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'binlog.000006'")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MASTER_LOG_POS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("191")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("也就是说增量备份的起点是 "),s("code",[a._v("binlog.000006")]),a._v(" "),s("code",[a._v("191")]),a._v(" ，此时再检查当前的二进制日志情况")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"show master status;"')]),a._v("\n+---------------+----------+--------------+------------------+--------------------------------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" File          "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Position "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Binlog_Do_DB "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Binlog_Ignore_DB "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" Executed_Gtid_Set                          "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+---------------+----------+--------------+------------------+--------------------------------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" binlog.000006 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5486")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" db1          "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("                  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" 2d1581e0-781b-11e8-acb7-525400e231bc:1-646 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n+---------------+----------+--------------+------------------+--------------------------------------------+\n")])])]),s("p",[a._v("由此得知周一 "),s("code",[a._v("1:00")]),a._v(" 至此时的增量二进制日志全部在 "),s("code",[a._v("binlog.000006")]),a._v(" 文件中，且此时位置是 "),s("code",[a._v("5486")]),a._v(" ，因此将增量部分导出到备份目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqlbinlog --base64-output"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("decode-rows "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-vv")]),a._v(" --start-position"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("191")]),a._v(" --stop-position"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5486")]),a._v(" ~/u01/mysql/binlog/binlog.000006 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" ~/backup/week1/db1_incre_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(".sql\n")])])]),s("p",[a._v("如果增量涉及到多个 "),s("code",[a._v("binlog")]),a._v(" 文件，就多次执行 "),s("code",[a._v("mysqlbinlog")]),a._v(" 命令，将日志追加到增量 "),s("code",[a._v("db1_incre")]),a._v(" 文件中。后面周二到周日的增量备份步骤相同，可以写成脚本加入到计划任务中。")]),a._v(" "),s("h3",{attrs:{id:"恢复方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复方法"}},[a._v("#")]),a._v(" 恢复方法")]),a._v(" "),s("p",[a._v("依次导入全备和增量的 "),s("code",[a._v("SQL")]),a._v(" 脚本文件，例如 "),s("code",[a._v("db1_full_2017-12-12.sql")]),a._v(" 和 "),s("code",[a._v("db1_incre_2017-12-13.sql")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" db1_full_2017-12-12.sql\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" db1_incre_2017-12-13.sql\n")])])]),s("h2",{attrs:{id:"xtrabackup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xtrabackup"}},[a._v("#")]),a._v(" Xtrabackup")]),a._v(" "),s("h3",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" libev perl-DBD-MySQL perl-Digest-MD5 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ivh")]),a._v(" https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.12/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm\n")])])]),s("h3",{attrs:{id:"备份方法-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份方法-2"}},[a._v("#")]),a._v(" 备份方法")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("innobackupex --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --use-memory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" /home/mysql/backup "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    /home/mysql/backup_log/backup-progress-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(".log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),s("p",[s("code",[a._v("--no-timestamp")]),a._v(" 表示不自动生成时间戳，直接备份到指定目录 "),s("code",[a._v("/home/mysql/backup")]),a._v(" 中， "),s("code",[a._v("--parallel")]),a._v(" 表示并行数。 "),s("code",[a._v("innobackupex")]),a._v(" 支持备份单个 "),s("code",[a._v("InnoDB")]),a._v(" 数据库，指定参数 "),s("code",[a._v("--databases db1")]),a._v(" 。也可以通过指定 "),s("code",[a._v("--host")]),a._v(" 和 "),s("code",[a._v("--port")]),a._v(" 参数备份远程数据库。如果是 "),s("code",[a._v("Slave")]),a._v(" 库，可以指定 "),s("code",[a._v("--slave-info")]),a._v(" 记录 "),s("code",[a._v("slave")]),a._v(" 相关信息。最后输出 "),s("code",[a._v("completed OK!")]),a._v(" 表示执行成功。")]),a._v(" "),s("h3",{attrs:{id:"备份方案-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份方案-2"}},[a._v("#")]),a._v(" 备份方案")]),a._v(" "),s("p",[a._v("和前面的方案一样，每周一凌晨 "),s("code",[a._v("1:00")]),a._v(" 执行全量备份，然后每周一至周日半夜 "),s("code",[a._v("23:55")]),a._v(" 执行增量备份。与前面不同的是，这里对整库执行备份，恢复时比较方便。 "),s("code",[a._v("Xtrabackup")]),a._v(" 是基于 "),s("code",[a._v("LSN")]),a._v(" 进行增量备份的，可以通过查看 "),s("code",[a._v("xtrabackup_checkpoints")]),a._v(" 获取 "),s("code",[a._v("LSN")]),a._v(" 的位置。")]),a._v(" "),s("h4",{attrs:{id:"周一全量备份-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周一全量备份-2"}},[a._v("#")]),a._v(" 周一全量备份")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" ~/backup/week1/full\n$ innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" /home/mysql/week1/full\n")])])]),s("h4",{attrs:{id:"周一增量备份-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周一增量备份-2"}},[a._v("#")]),a._v(" 周一增量备份")]),a._v(" "),s("p",[a._v("第一个增量备份基于全量的 "),s("code",[a._v("LSN")]),a._v(" 位置进行增量")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /home/mysql/backup/week1/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\ninnobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --incremental-basedir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/week1/full "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--incremental")]),a._v(" /home/mysql/backup/week1/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("h4",{attrs:{id:"周二增量备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#周二增量备份"}},[a._v("#")]),a._v(" 周二增量备份")]),a._v(" "),s("p",[a._v("第二个增量备份基于第一个增量的 "),s("code",[a._v("LSN")]),a._v(" 位置进行增量，后面每个增量执行方法一样。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /home/mysql/backup/week1/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\ninnobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --incremental-basedir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/week1/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'last day'")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'last day'")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--incremental")]),a._v(" /home/mysql/backup/week1/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("h4",{attrs:{id:"查看lsn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看lsn"}},[a._v("#")]),a._v(" 查看LSN")]),a._v(" "),s("p",[a._v("分别查看全量、增量1、增量2的 "),s("code",[a._v("xtrabackup_checkpoints")])]),a._v(" "),s("p",[s("strong",[a._v("full")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 2120671\nlast_lsn = 2120671\ncompact = 0\nrecover_binlog_info = 0\n")])])]),s("p",[s("strong",[a._v("incre1")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("backup_type = incremental\nfrom_lsn = 2120671\nto_lsn = 2123065\nlast_lsn = 2123065\ncompact = 0\nrecover_binlog_info = 0\n")])])]),s("p",[s("strong",[a._v("incre2")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("backup_type = incremental\nfrom_lsn = 2123065\nto_lsn = 2126937\nlast_lsn = 2126937\ncompact = 0\nrecover_binlog_info = 0\n")])])]),s("h3",{attrs:{id:"备份脚本和计划任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份脚本和计划任务"}},[a._v("#")]),a._v(" 备份脚本和计划任务")]),a._v(" "),s("p",[a._v("使用 "),s("code",[a._v("Xtrabackup")]),a._v(" 作为备份工具，编写周一全量备份脚本 "),s("code",[a._v("full.backup.sh")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"PASSWORD"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("cnf")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/u01/mysql/etc/my.cnf"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/u01/mysql/run/mysql.sock"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("week")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%V"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("full_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v("/full_"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$day")]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("log_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v('/log"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$full_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    /usr/bin/mkdir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$full_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    /usr/bin/mkdir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n/usr/bin/innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$cnf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --use-memory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$socket")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$password")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$full_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v("/full_backup_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(".log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),s("p",[a._v("周一至周日的增量备份脚本 "),s("code",[a._v("incre.backup.sh")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"PASSWORD"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("cnf")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/u01/mysql/etc/my.cnf"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/u01/mysql/run/mysql.sock"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("week")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%V"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("full_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v("/full_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("log_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v('/log"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("last_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$full_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("last_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v("/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'last day'")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'last day'")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("incre_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/home/mysql/week/'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$week")]),a._v("/incre"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%u"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    /usr/bin/mkdir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$incre_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    /usr/bin/mkdir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$incre_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("/usr/bin/ls "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" $last_dir "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v(" /dev/null"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    /usr/bin/innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$cnf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        --use-memory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$socket")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$password")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        --incremental-basedir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$last_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--incremental")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$incre_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v("/incre_backup_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(".log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"incremental basedir is empty,quit..."')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$log_dir")]),a._v("/error_"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%F"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(".log\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),s("p",[a._v("脚本包含了数据库明文密码，注意权限")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("700")]),a._v(" full.backup.sh incre.backup.sh\n")])])]),s("p",[a._v("在 "),s("code",[a._v("mysql")]),a._v(" 用户 "),s("code",[a._v("bash")]),a._v(" 下设置 "),s("code",[a._v("crontab")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n00 01 * * "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" /bin/bash /home/mysql/full.backup.sh\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("55")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" * * * /bin/bash /home/mysql/incre.backup.sh\n")])])]),s("h3",{attrs:{id:"恢复数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复数据"}},[a._v("#")]),a._v(" 恢复数据")]),a._v(" "),s("p",[a._v("以 "),s("code",[a._v("周一全备+周一增量+周二增量")]),a._v(" 为例，将数据库恢复到周二，此时数据如下")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" id  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" name    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql1  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n     ······\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("156")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql7  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("157")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql8  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("158")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql9  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("159")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql10 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("160")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql11 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("161")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql12 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("162")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql13 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n")])])]),s("p",[a._v("将备份恢复到与原数据库配置完全相同的新数据库中，首先停止新库运行，然后备份数据库根目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqladmin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" /home/mysql/u01/mysql-5.6.39 /home/mysql/u01/mysql-5.6.39.bak\n")])])]),s("p",[a._v("预备恢复数据，只有最后一个增量不加 "),s("code",[a._v("--redo-only")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --apply-log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --redo-only /home/mysql/week1/full\nInnoDB: Shutdown completed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" log sequence number "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2120680")]),a._v("\nInnoDB: Number of pools: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("171218")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v(":52:35 completed OK"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n\n$ innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --apply-log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --redo-only /home/mysql/week1/full "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --incremental-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/week1/incre1_2017-12-11\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("171218")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(":10:46 completed OK"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n\n$ innobackupex "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --apply-log /home/mysql/week1/full "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --incremental-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/week1/incre2_2017-12-12\nInnoDB: Shutdown completed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" log sequence number "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2132520")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("171218")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(":11:25 completed OK"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n")])])]),s("p",[a._v("清空数据文件和 "),s("code",[a._v("InnoDB")]),a._v(" 日志文件，一般是 "),s("code",[a._v("data")]),a._v(" 目录。如果它们是分开存放，则需要分别删除，例如 "),s("code",[a._v("data")]),a._v(" "),s("code",[a._v("iblog")]),a._v(" "),s("code",[a._v("ibdata")]),a._v(" 目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /home/mysql/u01/mysql-5.6.39/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("data,iblog,ibdata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("/*\n")])])]),s("p",[a._v("拷贝预备好的备份目录 "),s("code",[a._v("backup")]),a._v(" 到新库服务器中，数据库处于关闭状态，执行恢复操作")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("innobackupex --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf --copy-back /home/mysql/backup/\n")])])]),s("p",[a._v("直到提示 "),s("code",[a._v("completed OK!")]),a._v(" 表示恢复成功，然后验证恢复")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("uroot "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'select * from db1.table1;'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" id  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" name    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql1  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n     ······\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("156")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql7  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("157")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql8  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("158")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql9  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("159")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql10 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("160")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql11 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("161")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql12 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("162")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql13 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-----+---------+")]),a._v("\n")])])]),s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[a._v("#")]),a._v(" 参考链接")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/incremental_backups_innobackupex.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/incremental_backups_innobackupex.html"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/restoring_individual_tables_ibk.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/restoring_individual_tables_ibk.html"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"http://www.yunweipai.com/archives/13462.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://www.yunweipai.com/archives/13462.html"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);