(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{236:function(a,s,t){"use strict";t.r(s);var e=t(6),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"迁移案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#迁移案例"}},[a._v("#")]),a._v(" 迁移案例")]),a._v(" "),s("h2",{attrs:{id:"境数据库现状"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#境数据库现状"}},[a._v("#")]),a._v(" 境数据库现状")]),a._v(" "),s("p",[a._v("之前生产环境 "),s("code",[a._v("MySQL")]),a._v(" 由研发人员使用和管理，单库单服务器运行。接手后发现存在以下问题：")]),a._v(" "),s("ul",[s("li",[a._v("业务程序使用 "),s("code",[a._v("root")]),a._v(" 用户连接数据库；")]),a._v(" "),s("li",[s("code",[a._v("binlog")]),a._v(" 没有开启，慢查询日志没有开启；")]),a._v(" "),s("li",[a._v("同一库中的表，使用了两种存储引擎： "),s("code",[a._v("MyISAM")]),a._v(" 和 "),s("code",[a._v("InnoDB")]),a._v(" ；")]),a._v(" "),s("li",[s("code",[a._v("max_connections")]),a._v(" 和 "),s("code",[a._v("open_files_limit")]),a._v(" 都是默认的 "),s("code",[a._v("151")]),a._v(" 和 "),s("code",[a._v("1024")]),a._v(" ；")])]),a._v(" "),s("p",[a._v("其他影响较小的问题未列出")]),a._v(" "),s("h2",{attrs:{id:"整改目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整改目标"}},[a._v("#")]),a._v(" 整改目标")]),a._v(" "),s("ul",[s("li",[a._v("规范用户权限，限制业务应用连接数据库的权限(增删改查)；")]),a._v(" "),s("li",[a._v("开启 "),s("code",[a._v("binlog")]),a._v(" 和慢查询日志；")]),a._v(" "),s("li",[a._v("配置主从同步，使用 "),s("code",[a._v("GTID")]),a._v(" ；")]),a._v(" "),s("li",[a._v("同一表的存储引擎为 "),s("code",[a._v("InnoDB")]),a._v(" ；")]),a._v(" "),s("li",[a._v("配置 "),s("code",[a._v("MySQL")]),a._v(" 的默认字符集和校验集；")]),a._v(" "),s("li",[a._v("优化连接数和打开文件数；")]),a._v(" "),s("li",[a._v("优化 "),s("code",[a._v("InnoDB")]),a._v(" 相关参数；")]),a._v(" "),s("li",[a._v("使用 "),s("code",[a._v("XtraBackup")]),a._v(" 定时备份数据库")])]),a._v(" "),s("h2",{attrs:{id:"重新规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重新规划"}},[a._v("#")]),a._v(" 重新规划")]),a._v(" "),s("p",[s("strong",[a._v("Master")])]),a._v(" "),s("ul",[s("li",[a._v("IP：192.168.1.11 (原库所在服务器)")]),a._v(" "),s("li",[a._v("硬件配置：E5-2620 12核*2/32G/1800G Raid5")])]),a._v(" "),s("p",[s("strong",[a._v("Slave")])]),a._v(" "),s("ul",[s("li",[a._v("IP：192.168.1.13")]),a._v(" "),s("li",[a._v("硬件配置：E5-2620 12核/16G/1400G Raid5")])]),a._v(" "),s("p",[a._v("原库当前运行在 "),s("code",[a._v("Master")]),a._v(" 上，计划在 "),s("code",[a._v("Master")]),a._v(" 上新建一个 "),s("code",[a._v("MySQL")]),a._v(" 的专用用户，用来运行新的 "),s("code",[a._v("MySQL")]),a._v(" 服务，使用 "),s("code",[a._v("3307")]),a._v(" 端口，与原库区分开来，部署过程中原库不关闭。")]),a._v(" "),s("h3",{attrs:{id:"mysql规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql规划"}},[a._v("#")]),a._v(" MySQL规划")]),a._v(" "),s("p",[s("code",[a._v("Master")]),a._v(" 和 "),s("code",[a._v("Slave")]),a._v(" 的 "),s("code",[a._v("MySQL")]),a._v(" 结构保持一致")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("/home/mysql/u01/mysql-5.6.39     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#mysql根目录")]),a._v("\n├── binlog     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#binlog目录")]),a._v("\n│ ├── binlog.000001\n│ ├── binlog.000002\n│ ├── binlog.000003\n│ └── binlog.index\n├── data    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#数据目录")]),a._v("\n├── etc     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#配置文件目录")]),a._v("\n│ └── my.cnf\n├── ibdata     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#innodb共享表空间目录")]),a._v("\n├── iblog      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#redo log目录")]),a._v("\n├── log        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#错误日志、慢查询日志目录")]),a._v("\n│ ├── error.log\n│ └── slow.log\n├── run     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#MySQL运行文件目录")]),a._v("\n│ ├── mysqld.pid\n│ └── mysql.sock\n├── src     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#MySQL源码目录")]),a._v("\n└── tmp     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#临时文件目录")]),a._v("\n")])])]),s("h3",{attrs:{id:"部署mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署mysql"}},[a._v("#")]),a._v(" 部署MySQL")]),a._v(" "),s("p",[s("code",[a._v("Master")]),a._v(" 和 "),s("code",[a._v("Slave")]),a._v(" 上同时安装新的 "),s("code",[a._v("MySQL")]),a._v(" ，"),s("RouterLink",{attrs:{to:"/MySQL/mysql_installation.html"}},[a._v("安装过程")])],1),a._v(" "),s("h3",{attrs:{id:"配置文件my-cnf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件my-cnf"}},[a._v("#")]),a._v(" 配置文件my.cnf")]),a._v(" "),s("p",[s("strong",[a._v("Master")])]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3307")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("socket")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\nauto-rehash\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("prompt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token inner-value"}},[a._v("\\\\u@\\\\h \\\\d>")]),a._v('"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("mysqld")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("autocommit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("general_log")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("explicit_defaults_for_timestamp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("interactive_timeout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("600")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("wait_timeout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("300")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# system")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3307")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("basedir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("datadir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/data")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("tmpdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/tmp")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("socket")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("pid-file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/run/mysqld.pid")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_allowed_packet")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1G")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_connections")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_user_connections")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2800")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("open_files_limit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("65535")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server_id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("101")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sql_mode")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("skip_name_resolve")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("transaction_isolation")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("READ-COMMITTED")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("default_storage_engine")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("InnoDB")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("gtid_mode")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("enforce_gtid_consistency")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# binlog")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_bin")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/binlog/binlog")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("binlog_cache_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("32768")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("binlog_format")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ROW")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("expire_logs_days")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("14")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_slave_updates")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_binlog_cache_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2147483648")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("max_binlog_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("524288000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sync_binlog")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# relay")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("relay_log")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/log/relaylog")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("relay_log_index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/log/relay.index")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("relay_log_info_file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/log/relay-log.info")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# slave")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("slave_load_tmpdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/tmp")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("slave_skip_errors")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\nskip-slave-start\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# logging")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_error")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/log/error.log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("long_query_time")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("slow_query_log")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("slow_query_log_file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/log/slow.log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_queries_not_using_indexes")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_throttle_queries_not_using_indexes")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_slow_admin_statements")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# innodb")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_data_home_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/ibdata")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_log_group_home_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/home/mysql/u01/mysql-5.6.39/iblog")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_adaptive_flushing")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_adaptive_hash_index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_autoinc_lock_mode")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_buffer_pool_instances")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("8")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_buffer_pool_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10G")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_change_buffering")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("inserts")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_checksums")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_data_file_path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ibdata1:32M;ibdata2:16M:autoextend")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_doublewrite")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_file_format")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Barracuda")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_file_per_table")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_flush_log_at_trx_commit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_flush_method")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("O_DIRECT")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_io_capacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("300")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_lock_wait_timeout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_log_buffer_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("67108864")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_log_file_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1048576000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_log_files_in_group")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_max_dirty_pages_pct")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("75")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_open_files")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("60000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_stats_on_metadata")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_support_xa")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_use_native_aio")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("OFF")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_read_io_threads")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("4")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_purge_threads")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("innodb_write_io_threads")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("myisamchk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("key_buffer_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("20M")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sort_buffer_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("20M")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("read_buffer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2M")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("write_buffer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2M")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("mysqlhotcopy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\ninteractive-timeout\n")])])]),s("p",[s("strong",[a._v("Slave")])]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 不同于 Master 的选项")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3307 -> port = 3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3307 -> port = 3306")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server_id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("101 -> server_id = 102")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Slave 上额外的选项")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("slave_skip_errors")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1032,1062,1007,1008")]),a._v("\nskip-slave-start\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("read_only")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ON")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 为了防止因 Slave 服务器崩溃导致 master_info 中继日志信息不完整，在 Slave 上开启如下选项，但是它会增加服务器的开销")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sync_master_info")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sync_relay_log")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sync_relay_log_info")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n")])])]),s("p",[s("code",[a._v("server_id")]),a._v(" 需要全局唯一，在 "),s("code",[a._v("Slave")]),a._v(" 上跳过几个可忽略的错误 "),s("code",[a._v("1032,1062,1007,1008")]),a._v(" ，并设置 "),s("code",[a._v("MySQL")]),a._v(" 启动时不自动开启 "),s("code",[a._v("slave")]),a._v(" ，而进行手动 "),s("code",[a._v("start slave；")]),a._v(" "),s("code",[a._v("Slave")]),a._v(" 上设置 "),s("code",[a._v("read_only")]),a._v(" 不允许普通用户修改数据。")]),a._v(" "),s("h3",{attrs:{id:"转储数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#转储数据"}},[a._v("#")]),a._v(" 转储数据")]),a._v(" "),s("p",[a._v("总共有 "),s("code",[a._v("2")]),a._v(" 个库需要转储， "),s("code",[a._v("zhcj")]),a._v(" 和 "),s("code",[a._v("data_sync")]),a._v(" ，数据基本都在 "),s("code",[a._v("zhcj")]),a._v(" 中， "),s("code",[a._v("data_sync")]),a._v(" 是辅助的库，体量很小。")]),a._v(" "),s("p",[a._v("在原库服务器上使用 "),s("code",[a._v("mysqldump")]),a._v(" 工具导出原数据库，由于存储引擎不统一，只能进行全局锁表的导出方式")]),a._v(" "),s("p",[s("s",[a._v("mysqldump -uroot -p --socket=/var/lib/mysql/mysql.sock --events --lock-all-tables --databases zhcj data_sync > all.sql")])]),a._v(" "),s("p",[a._v("在导 "),s("code",[a._v("zhcj")]),a._v(" 库时出现问题，由于原数据库默认使用了 "),s("code",[a._v("latin1")]),a._v(" 编码，在导出 "),s("code",[a._v("zhcj")]),a._v(" 库之后，中文乱码，即便是使用了 "),s("code",[a._v("--default-character-set")]),a._v(" 选项也无济于事，但是导出表结构却是正常，整库导出就乱码，于是分表导出，然后批量修改引擎。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("screen")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" dump\n")])])]),s("p",[a._v("创建 "),s("code",[a._v("dump.sh")]),a._v(" 脚本")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/mysql/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"show tables from zhcj\\G"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" Tables_in_zhcj "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{print $2}'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" table_list\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("table")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" table_list"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\nmysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/mysql/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v(" --lock-all-tables zhcj "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$table")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" table_out/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$table")]),a._v(".sql\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" ~/dump.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" table_out\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("table")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'s/ENGINE=MyISAM/ENGINE=InnoDB/g'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$table")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" ~/sed.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),s("p",[a._v("在导入数据到新 "),s("code",[a._v("Master")]),a._v(" 库之前，临时配置一下 "),s("code",[a._v("innodb_flush_log_at_trx_commit=0")]),a._v(" ，这样导入数据时速度会稍微快一点。这样的配置，假如出现故障，可能会丢失1s的数据。但是由于当前已确保服务器的正常运行，因此暂时配置该选项。")]),a._v(" "),s("p",[a._v("数据导出并修改好存储引擎之后，将数据导入到新 "),s("code",[a._v("Master")]),a._v(" 数据库中")]),a._v(" "),s("p",[a._v("先导入表结构，原因是库中存在关联的表，直接导入所有数据可能会因为有些表还未创建，导致错误提示：找不到xxx表")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("screen")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" mysql_in\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" mysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/mysql/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--events")]),a._v(" --lock-all-tables --no-data zhcj  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" zhcj_s.sql\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'s/ENGINE=MyISAM/ENGINE=InnoDB/g'")]),a._v(" zhcj_s.sql\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" zhcj "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" zhcj_s.sql\n")])])]),s("p",[a._v("再执行批量导入")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" table_out\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("table")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'linuxd.cc'")]),a._v(" zhcj "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$table")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" ~/run.log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),s("p",[a._v("在数据转储的整个过程中，由于原库没有配置 "),s("code",[a._v("binlog")]),a._v(" ，无法做增量，势必丢失一些新写入的数据，无法避免。")]),a._v(" "),s("p",[s("code",[a._v("zhcj")]),a._v(" 转储完成之后，导入 "),s("code",[a._v("data_sync")]),a._v(" ，整个转储就完成了，如果 "),s("code",[a._v("Master")]),a._v(" 中还没有 "),s("code",[a._v("data_sync")]),a._v(" ，就手动创建")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--socket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql-5.6.39/run/mysql.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" -p"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" data_sync "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" data_sync.sql\n")])])]),s("h3",{attrs:{id:"创建专用mysql用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建专用mysql用户"}},[a._v("#")]),a._v(" 创建专用MySQL用户")]),a._v(" "),s("p",[a._v("在 "),s("code",[a._v("Master")]),a._v(" 新库上创建应用用户、同步用户、备份用户")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UPDATE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DELETE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INSERT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" zhcj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" zhcj_user"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SELECT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UPDATE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DELETE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INSERT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" data_sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" zhcj_user"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("REPLICATION")]),a._v(" SLAVE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" rep_user"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'%'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("grant")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLESPACE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" RELOAD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" PROCESS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" SUPER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("LOCK")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("REPLICATION")]),a._v(" CLIENT "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("on")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("backup")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@'localhost'")]),a._v(" identified "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nFLUSH PRIVIELEGS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("创建好之后，在应用系统中配置新的数据库连接信息，测试应用系统")]),a._v(" "),s("h3",{attrs:{id:"配置slave"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置slave"}},[a._v("#")]),a._v(" 配置Slave")]),a._v(" "),s("p",[a._v("确定 "),s("code",[a._v("Master")]),a._v(" 运行正常之后，清空 "),s("code",[a._v("Slave")]),a._v(" 的 "),s("code",[a._v("binlog")]),a._v(" 和 "),s("code",[a._v("relay-log")]),a._v(" ，如果之前 "),s("code",[a._v("Slave")]),a._v(" 上有同步报错，这里可以一并清除")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[a._v("RESET MASTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nRESET SLAVE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ALL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("开启 "),s("code",[a._v("slave")]),a._v(" ，在 "),s("code",[a._v("CHANGE MASTER")]),a._v(" 时不包含用户密码，而是在 "),s("code",[a._v("START SLAVE")]),a._v(" 时使用密码，注意用户密码信息就不会保存在"),s("code",[a._v("master.info")]),a._v(" 文件中，所以在设置 "),s("code",[a._v("MySQL")]),a._v(" 配置文件时使用了 "),s("code",[a._v("skip-slave-start")]),a._v(" 选项")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[a._v("CHANGE MASTER "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TO")]),a._v(" MASTER_HOST"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'192.168.1.11'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" MASTER_PORT"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3307")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" MASTER_AUTO_POSITION"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("START")]),a._v(" SLAVE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'rep_user'")]),a._v(" PASSWORD"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("检查 "),s("code",[a._v("Slave")]),a._v(" 状态，看同步是否正常")]),a._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SHOW")]),a._v(" SLAVE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("STATUS")]),a._v("\\G\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("row")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n               Slave_IO_State: Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" master "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" send event\n                  Master_Host: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".11")]),a._v("\n                  Master_User: rep_user\n                  Master_Port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3307")]),a._v("\n                Connect_Retry: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v("\n              Master_Log_File: binlog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000020")]),a._v("\n          Read_Master_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("207856009")]),a._v("\n               Relay_Log_File: relaylog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000023")]),a._v("\n                Relay_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("325850963")]),a._v("\n        Relay_Master_Log_File: binlog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("000010")]),a._v("\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table:\n       Replicate_Ignore_Table:\n      Replicate_Wild_Do_Table:\n  Replicate_Wild_Ignore_Table:\n                   Last_Errno: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n                   Last_Error:\n                 Skip_Counter: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n          Exec_Master_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("325850759")]),a._v("\n              Relay_Log_Space: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5254864517")]),a._v("\n              Until_Condition: None\n               Until_Log_File:\n                Until_Log_Pos: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n           Master_SSL_Allowed: "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("No")]),a._v("\n           Master_SSL_CA_File:\n           Master_SSL_CA_Path:\n              Master_SSL_Cert:\n            Master_SSL_Cipher:\n               Master_SSL_Key:\n        Seconds_Behind_Master: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21933")]),a._v("\nMaster_SSL_Verify_Server_Cert: "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("No")]),a._v("\n                Last_IO_Errno: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n                Last_IO_Error:\n               Last_SQL_Errno: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n               Last_SQL_Error:\n  Replicate_Ignore_Server_Ids:\n             Master_Server_Id: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("101")]),a._v("\n                  Master_UUID: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("076")]),a._v("a961d"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4452")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v("e8"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("b07"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("c81f66fba165\n             Master_Info_File: "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("u01"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.6")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".39")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("info\n                    SQL_Delay: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n          SQL_Remaining_Delay: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v("\n      Slave_SQL_Running_State: copy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" tmp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),a._v("\n           Master_Retry_Count: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("86400")]),a._v("\n                  Master_Bind:\n      Last_IO_Error_Timestamp:\n     Last_SQL_Error_Timestamp:\n               Master_SSL_Crl:\n           Master_SSL_Crlpath:\n           Retrieved_Gtid_Set: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("076")]),a._v("a961d"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4452")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v("e8"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("b07"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("c81f66fba165:"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15198")]),a._v("\n            Executed_Gtid_Set: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("076")]),a._v("a961d"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4452")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v("e8"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("b07"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("c81f66fba165:"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(":"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6476")]),a._v("\n                Auto_Position: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])])]),s("h3",{attrs:{id:"定时物理备份master"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定时物理备份master"}},[a._v("#")]),a._v(" 定时物理备份Master")]),a._v(" "),s("p",[a._v("每天凌晨 "),s("code",[a._v("1")]),a._v(" 点备份数据库， "),s("code",[a._v("2")]),a._v(" 点检查超过 "),s("code",[a._v("30")]),a._v(" 天的备份并删除")]),a._v(" "),s("p",[a._v("使用 "),s("code",[a._v("XtraBackup")]),a._v(" 对数据库执行热备任务，创建日志目录 "),s("code",[a._v("mkdir /home/mysql/backup_log")]),a._v(" 后，然后创建备份脚本 "),s("code",[a._v("full_backup.sh")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("backup_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/master_backup/"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y-%m-%d"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$backup_dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("backup_dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/master_backup/"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y-%m-%d"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("_1\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$backup_dir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$backup_dir")]),a._v("\n\ninnobackupex --defaults-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/mysql/u01/mysql/etc/my.cnf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --no-timestamp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --use-memory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1G "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--parallel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'PASSWORD'")]),a._v(" ./ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ~/backup_log/backup-progress-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y-%m-%d"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(".log "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),s("p",[a._v("定时任务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" * * * /bin/bash /home/mysql/full_backup.sh\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" * * * /usr/bin/find /home/mysql/master_backup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" d "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +30 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h3",{attrs:{id:"rsync定时同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rsync定时同步"}},[a._v("#")]),a._v(" rsync定时同步")]),a._v(" "),s("p",[a._v("将备份的数据库文件定时同步到其他服务器上")]),a._v(" "),s("ul",[s("li",[a._v("rsync服务器：192.168.1.13（Slave）")]),a._v(" "),s("li",[a._v("rsync客户端：192.168.1.11（Master）")])]),a._v(" "),s("p",[s("strong",[a._v("部署rsync服务端")])]),a._v(" "),s("p",[a._v("编辑配置文件 "),s("code",[a._v("/etc/rsyncd.conf")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("uid "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mysql   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#文件传输到本地后的属主")]),a._v("\ngid "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mysql   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#文件传输到本地后的属组")]),a._v("\nmax connections "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("36000")]),a._v("\nuse "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" no\nlog "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/log/rsyncd.log\npid "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/rsyncd.pid\nlock "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/run/rsyncd.lock\ndont compress   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("backup_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#模块id")]),a._v("\npath "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /home/mysql/backup_dir   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#模块对应的路径")]),a._v("\nignore errors   \n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("read")]),a._v(" only "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("write")]),a._v(" only "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nhosts allow "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24\nhosts deny "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/32\nauth "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("users")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" rsync_user   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#认证用户")]),a._v("\nsecrets "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /etc/rsyncd.pass   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#认证用户密码，权限必须是600")]),a._v("\n")])])]),s("p",[a._v("用户密码文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/rsyncd.pass\nrsync_user:123456\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" /etc/rsyncd.pass\n")])])]),s("p",[a._v("启动rsync服务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("systemctl start rsyncd.service\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" rsyncd.service\n")])])]),s("p",[a._v("配置 "),s("code",[a._v("SELinux")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("setsebool "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" rsync_full_access on\n")])])]),s("p",[a._v("创建模块目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" - mysql\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /home/mysql/backup_dir\n")])])]),s("p",[s("strong",[a._v("客户端测试rsync连接")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'echo \"123456\" >> /etc/rsync.pass'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" /etc/rsync.pass\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" --list-only rsync://rsync_user@192.168.1.13:873/backup_dir  --password-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/rsync.pass\ndrwxrwxr-x              "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2018")]),a._v("/05/10 09:45:06 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),s("p",[s("code",[a._v("rsync")]),a._v(" 服务搭建成功后，在 "),s("code",[a._v("Master")]),a._v(" 上添加再一个计划任务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("crontab")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" * * * /bin/bash /home/mysql/full_backup.sh\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" * * * /usr/bin/find /home/mysql/master_backup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" d "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +30 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" * * * /usr/bin/rsync "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-az")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--delete")]),a._v(" /home/mysql/master_backup rsync://rsync_user@192.168.1.13:873/backup_dir --password-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/etc/rsyncd.pass\n")])])]),s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[a._v("#")]),a._v(" 参考链接")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/f-ck-need-u/p/7220009.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.cnblogs.com/f-ck-need-u/p/7220009.html"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/MikeZhang/p/rsyncExample_20160818.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.cnblogs.com/MikeZhang/p/rsyncExample_20160818.html"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);