(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{246:function(a,t,s){"use strict";s.r(t);var e=s(6),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"运行环境优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行环境优化"}},[a._v("#")]),a._v(" 运行环境优化")]),a._v(" "),t("h2",{attrs:{id:"cpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu"}},[a._v("#")]),a._v(" CPU")]),a._v(" "),t("p",[a._v("关闭 "),t("code",[a._v("NUMA")]),a._v(" ， "),t("code",[a._v("NUMA")]),a._v(" 是非一致性内存访问架构，不适合数据库服务的运行，可以在系统内核中关闭")]),a._v(" "),t("p",[t("strong",[a._v("CentOS6")])]),a._v(" "),t("p",[a._v("编辑 "),t("code",[a._v("/etc/grub.conf")]),a._v(" 文件，在 "),t("code",[a._v("kernel")]),a._v(" 参数后面追加 "),t("code",[a._v("numa=off")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kernel /vmlinuz-2.6.32-431.el6.x86_64 ro "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("root")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("UUID"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("2cccbdae-d43f-4109-9679-e4ab6c32afde rd_NO_LUKS rd_NO_LVM "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("en_US.UTF-8 rd_NO_MD "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SYSFONT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("latarcyrheb-sun16 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("crashkernel")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("auto  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KEYBOARDTYPE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("pc "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KEYTABLE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("us rd_NO_DM rhgb quiet "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("numa")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("off\n")])])]),t("p",[t("strong",[a._v("CentOS7")])]),a._v(" "),t("p",[a._v("编辑内核参数 "),t("code",[a._v("/etc/default/grub")]),a._v(" 追加 "),t("code",[a._v("numa=off")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GRUB_CMDLINE_LINUX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet numa=off"')]),a._v("\n")])])]),t("p",[a._v("重新生成 "),t("code",[a._v("grub")]),a._v(" 配置，然后重启系统")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("grub2-mkconfig "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /boot/grub2/grub.cfg\n")])])]),t("h2",{attrs:{id:"内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存"}},[a._v("#")]),a._v(" 内存")]),a._v(" "),t("p",[a._v("设置 "),t("code",[a._v("vm.swappiness")]),a._v(" 参数，尽可能的不使用交换空间")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"vm.swappiness = 1"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])])]),t("h2",{attrs:{id:"i-o"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#i-o"}},[a._v("#")]),a._v(" I/O")]),a._v(" "),t("p",[a._v("针对机械硬盘，更改 "),t("code",[a._v("I/O")]),a._v(" 调度算法为 "),t("code",[a._v("Deadline")]),a._v(" ；针对 "),t("code",[a._v("SSD")]),a._v(" ，更改 "),t("code",[a._v("I/O")]),a._v(" 调度算法为 "),t("code",[a._v("NOOP")])]),a._v(" "),t("p",[t("strong",[a._v("临时生效")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" deadline "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /sys/block/sda/queue/scheduler\n")])])]),t("p",[t("strong",[a._v("永久生效")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("grubby --update-kernel"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ALL "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--args")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"elevator=deadline"')]),a._v("\n")])])]),t("h2",{attrs:{id:"文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件系统"}},[a._v("#")]),a._v(" 文件系统")]),a._v(" "),t("p",[a._v("文件系统是 "),t("code",[a._v("xfs")]),a._v(" 或 "),t("code",[a._v("ext3/4")]),a._v(" ，使用挂载参数 "),t("code",[a._v("noatime")]),a._v(" 和 "),t("code",[a._v("nodiratime")]),a._v(" ，能一定程度上提供磁盘的性能")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("/dev/sda /mountlocation xfs default, noatime, nodiratime, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("data")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("writeback "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n")])])]),t("h2",{attrs:{id:"操作系统内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作系统内核"}},[a._v("#")]),a._v(" 操作系统内核")]),a._v(" "),t("p",[a._v("以 "),t("code",[a._v("CentOS 7")]),a._v(" 为例，在 "),t("code",[a._v("sysctl.conf")]),a._v(" 中添加以下参数")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.somaxconn")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("65535")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.netdev_max_backlog")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("20000")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_max_syn_backlog")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("65535")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_fin_timeout")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_tw_recycle")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_tw_reuse")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.wmem_default")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("212992")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.wmem_max")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("16777216")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.rmem_default")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("212992")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.core.rmem_max")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("16777216")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_keepalive_time")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_keepalive_intvl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("net.ipv4.tcp_keepalive_probes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("3")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 最大共享内存段大小，默认是物理内存的两倍，可以设置成略小于物理内存")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("kernel.shmmax")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("68719476736")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("vm.swappiness")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n")])])]),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[a._v("#")]),a._v(" 参考链接")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://www.importnew.com/27624.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://www.importnew.com/27624.html"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://huoding.com/2016/09/05/542",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://huoding.com/2016/09/05/542"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://jaminzhang.github.io/linux/understand-Linux-backlog-and-somaxconn-kernel-arguments/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://jaminzhang.github.io/linux/understand-Linux-backlog-and-somaxconn-kernel-arguments/"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"http://liaoph.com/mysql-optimize-in-linux/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://liaoph.com/mysql-optimize-in-linux/"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://wiki.mikejung.biz/Sysctl_tweaks",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://wiki.mikejung.biz/Sysctl_tweaks"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"http://mdba.cn/2013/12/24/%E9%92%88%E5%AF%B9mysql%E7%9A%84linux%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E6%8A%80%E5%B7%A7/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://mdba.cn/2013/12/24/针对mysql的linux性能调优技巧/"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);