(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{250:function(_,v,t){"use strict";t.r(v);var o=t(6),e=Object(o.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"参数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[_._v("#")]),_._v(" 参数")]),_._v(" "),v("h2",{attrs:{id:"binlog-format"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#binlog-format"}},[_._v("#")]),_._v(" binlog_format")]),_._v(" "),v("h3",{attrs:{id:"statement"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#statement"}},[_._v("#")]),_._v(" STATEMENT")]),_._v(" "),v("p",[v("code",[_._v("STATEMENT-based replication(SBR)")]),_._v(" 基于 "),v("code",[_._v("SQL")]),_._v(" 语句的复制模式。 "),v("code",[_._v("binlog")]),_._v(" 只记录对数据库执行了更改的 "),v("code",[_._v("SQL")]),_._v(" 语句，在 "),v("code",[_._v("Slave")]),_._v(" 端能够正确的执行这些语句。对于某些函数(例如 "),v("code",[_._v("sleep()")]),_._v(" )无法被复制，可能导致 "),v("code",[_._v("Master")]),_._v(" 和 "),v("code",[_._v("Slave")]),_._v(" 数据不一致的情况。因为只记录了 "),v("code",[_._v("SQL")]),_._v(" 语句，所以日志的大小会比较小。")]),_._v(" "),v("h3",{attrs:{id:"row"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#row"}},[_._v("#")]),_._v(" ROW")]),_._v(" "),v("p",[v("code",[_._v("ROW-based replication(RBR)")]),_._v(" 基于行的复制模式。 "),v("code",[_._v("binlog")]),_._v(" 会清楚的记录表中每一行发生的变化，对于某些函数执行的结果也一样记录，但不记录对数据库更改时执行的 "),v("code",[_._v("SQL")]),_._v(" 语句和上下文关系。因为要记录每一行的改变细节，所以 "),v("code",[_._v("ROW")]),_._v(" 模式可能会产生大量的日志。")]),_._v(" "),v("h3",{attrs:{id:"mixed"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mixed"}},[_._v("#")]),_._v(" MIXED")]),_._v(" "),v("p",[v("code",[_._v("MIXED-based replication(MBR)")]),_._v(" 以上两种模式的混合使用，"),v("code",[_._v("MySQL 5.6")]),_._v(" 版本中默认使用这种格式，一般的复制使用 "),v("code",[_._v("STATEMENT")]),_._v(" 模式记录 "),v("code",[_._v("binlog")]),_._v(" ，大多数情况下， "),v("code",[_._v("MIXED")]),_._v(" 与 "),v("code",[_._v("STATEMENT")]),_._v(" 的效果一样。对于 "),v("code",[_._v("STATEMENT")]),_._v(" 模式无法记录的操作使用 "),v("code",[_._v("ROW")]),_._v(" 模式记录 "),v("code",[_._v("binlog")]),_._v(" ， "),v("code",[_._v("MySQL")]),_._v(" 会根据执行的 "),v("code",[_._v("SQL")]),_._v(" 语句选择日志保存方式。")]),_._v(" "),v("h2",{attrs:{id:"binlog-do-db"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#binlog-do-db"}},[_._v("#")]),_._v(" binlog-do-db")]),_._v(" "),v("p",[v("code",[_._v("binlog-do-db、binlog-ignore-db、replicate-do-db、replicate-ignore-db")]),_._v(" 是同类的四个选项，在 "),v("code",[_._v("MySQL")]),_._v(" 主从复制的场景中使用。 "),v("code",[_._v("binlog-do-db")]),_._v(" 基本含义是指定要记录或忽略不记录的 "),v("code",[_._v("binlog")]),_._v(" 的数据库名，指定要复制或不复制的数据库名。")]),_._v(" "),v("h3",{attrs:{id:"binlog-do-db生效机制链接"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#binlog-do-db生效机制链接"}},[_._v("#")]),_._v(" binlog-do-db生效机制链接")]),_._v(" "),v("h4",{attrs:{id:"情况1"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#情况1"}},[_._v("#")]),_._v(" 情况1")]),_._v(" "),v("ul",[v("li",[_._v("binlog_format = ROW")]),_._v(" "),v("li",[_._v("binlog-do-db = db1")]),_._v(" "),v("li",[_._v("mysql> USE db1; 或 mysql> USE db2;")])]),_._v(" "),v("p",[_._v("在 "),v("code",[_._v("ROW")]),_._v(" 模式下，所有的 "),v("code",[_._v("DDL/DML")]),_._v(" 操作都只对 "),v("code",[_._v("binlog-do-db = db1")]),_._v(" 起作用，即便 "),v("code",[_._v("USE db2")]),_._v(" 之后，也不会对 "),v("code",[_._v("db2")]),_._v(" 产生任何影响。换言之， "),v("code",[_._v("ROW")]),_._v(" 模式下对选项 "),v("code",[_._v("binlog-do-db")]),_._v(" 的 "),v("code",[_._v("binlog")]),_._v(" 记录，只针对于 "),v("code",[_._v("binlog-do-db")]),_._v(" 所指定的库。")]),_._v(" "),v("h4",{attrs:{id:"情况2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#情况2"}},[_._v("#")]),_._v(" 情况2")]),_._v(" "),v("ul",[v("li",[_._v("binlog_format = STATEMENT")]),_._v(" "),v("li",[_._v("binlog-do-db = db1")]),_._v(" "),v("li",[_._v("mysql> USE db1;")])]),_._v(" "),v("p",[_._v("指定的是库 "),v("code",[_._v("db1")]),_._v(" ，只有在 "),v("code",[_._v("USE db1")]),_._v(" 之后，默认库是 "),v("code",[_._v("db1")]),_._v(" 的情况下，所执行的所有操作(包括 "),v("code",[_._v("DDL/DML")]),_._v(" )都会记录 "),v("code",[_._v("binlog")]),_._v(" ，即便执行的是针对 "),v("code",[_._v("db2")]),_._v(" 的操作。换言之， "),v("code",[_._v("STATEMENT")]),_._v(" 模式下对选项 "),v("code",[_._v("binlog-do-db")]),_._v(" 的 "),v("code",[_._v("binlog")]),_._v(" 记录，完全依赖于默认数据库(即 "),v("code",[_._v("USE dbname")]),_._v(" )。")]),_._v(" "),v("h4",{attrs:{id:"情况3"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#情况3"}},[_._v("#")]),_._v(" 情况3")]),_._v(" "),v("ul",[v("li",[_._v("binlog_format = MIXED")]),_._v(" "),v("li",[_._v("binlog-do-db = db1")])]),_._v(" "),v("p",[_._v("在多数情况下， "),v("code",[_._v("MIXED")]),_._v(" 和 "),v("code",[_._v("STATEMENT")]),_._v(" 效果一样，只有在 "),v("code",[_._v("STATEMENT")]),_._v(" 模式无法记录的操作才会切换到 "),v("code",[_._v("ROW")]),_._v(" 模式进行记录，在对应模式下的记录 "),v("code",[_._v("binlog")]),_._v(" 的规则同上。")]),_._v(" "),v("h4",{attrs:{id:"情况4"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#情况4"}},[_._v("#")]),_._v(" 情况4")]),_._v(" "),v("ul",[v("li",[_._v("binlog_format = STATEMENT 或 ROW 或 MIXED")]),_._v(" "),v("li",[_._v("binlog-do-db = db1")])]),_._v(" "),v("p",[_._v("与前面 "),v("code",[_._v("3")]),_._v(" 种情况不同，在使用 "),v("code",[_._v("DCL")]),_._v(" 语句( "),v("code",[_._v("GRANT、REVOKE")]),_._v(" 等授权语句)的时候，不适用于上述规则。例如在执行 "),v("code",[_._v("GRANT")]),_._v(" 授权语句时，只有在执行 "),v("code",[_._v("USE db1")]),_._v(" 之后， "),v("code",[_._v("GRANT")]),_._v(" 的操作才会被 "),v("code",[_._v("Slave")]),_._v(" 复制，在其他库的时候， "),v("code",[_._v("GRANT")]),_._v(" 的操作不会被 "),v("code",[_._v("Slave")]),_._v(" 复制。")]),_._v(" "),v("h3",{attrs:{id:"参考链接"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[_._v("#")]),_._v(" 参考链接")]),_._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-options-binary-log.html#option_mysqld_binlog-do-db",target:"_blank",rel:"noopener noreferrer"}},[_._v("https://dev.mysql.com/doc/refman/5.5/en/replication-options-binary-log.html#option_mysqld_binlog-do-db"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"http://blog.51cto.com/wujianwei/2063450",target:"_blank",rel:"noopener noreferrer"}},[_._v("http://blog.51cto.com/wujianwei/2063450"),v("OutboundLink")],1)])]),_._v(" "),v("h2",{attrs:{id:"nteractive-timeout和wait-timeout"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#nteractive-timeout和wait-timeout"}},[_._v("#")]),_._v(" nteractive_timeout和wait_timeout")]),_._v(" "),v("ul",[v("li",[_._v("interactive_timeout : 交互式连接的超时时间，默认是28800(8小时)")]),_._v(" "),v("li",[_._v("wait_timeout : 超时等待时间，默认是28800(8小时)")])]),_._v(" "),v("h3",{attrs:{id:"生效机制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#生效机制"}},[_._v("#")]),_._v(" 生效机制")]),_._v(" "),v("p",[v("strong",[_._v("交互式连接")])]),_._v(" "),v("p",[_._v("典型的是 "),v("code",[_._v("MySQL")]),_._v(" 客户端，实际起作用的参数是 "),v("code",[_._v("wait_timeout")]),_._v(" ，这个参数决定了连接的超时时间。在交互式连接中， "),v("code",[_._v("wait_timeout")]),_._v(" 的值可以由两种方式获得")]),_._v(" "),v("blockquote",[v("p",[_._v("set session wait_timeout =100;  只生效与当前连接")]),_._v(" "),v("p",[_._v("set global interactive_timeout =100;  设置之后，下一个交互式 "),v("code",[_._v("session")]),_._v(" 的 "),v("code",[_._v("wait_timeout")]),_._v(" 将继承 "),v("code",[_._v("interactive_timeout")]),_._v(" 的值")])]),_._v(" "),v("p",[v("strong",[_._v("非交互式连接")])]),_._v(" "),v("p",[_._v("一般是程序与 "),v("code",[_._v("MySQL")]),_._v(" 的连接，例如 "),v("code",[_._v("PHP")]),_._v(" 、 "),v("code",[_._v("Python")]),_._v(" 等，此时 "),v("code",[_._v("wait_timeout")]),_._v(" 将继承自全局的 "),v("code",[_._v("wait_timeout")]),_._v(" 值，也就是说 "),v("code",[_._v("set global wait_timeout =100;")]),_._v("   将决定下一个非交互式连接的超时时间")]),_._v(" "),v("h3",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),v("p",[v("code",[_._v("MySQL")]),_._v(" 连接的超时等待时间(无论是交互式还是非交互式)，实际是由当前连接的 "),v("code",[_._v("wait_timeout")]),_._v(" 值所决定，而 "),v("code",[_._v("MySQL")]),_._v(" 根据连接的类型决定 "),v("code",[_._v("wait_timeout")]),_._v(" 继承哪一个值，全局的 "),v("code",[_._v("interactive_timeout")]),_._v(" 还是 "),v("code",[_._v("wait_timeout")])]),_._v(" "),v("p",[_._v("一般这两个值的设定根据实际情况而定，例如 "),v("code",[_._v("interactive_timeout =600")]),_._v(" "),v("code",[_._v("wait_timeout=300")])])])}),[],!1,null,null,null);v.default=e.exports}}]);