(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{258:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("h2",{attrs:{id:"依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[t._v("#")]),t._v(" 依赖")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" prce pcre-devel openssl openssl-devel policycoreutils-python gcc gcc-c++ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])])]),s("h2",{attrs:{id:"运行用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行用户"}},[t._v("#")]),t._v(" 运行用户")]),t._v(" "),s("p",[t._v("创建一个普通用户来运行 "),s("code",[t._v("Nginx")]),t._v(" ，而不使用 "),s("code",[t._v("root")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useradd")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("passwd")]),t._v(" nginx\n")])])]),s("p",[t._v("设置 "),s("code",[t._v("nginx")]),t._v(" 用户的最大打开文件数和最大进程数，设置完成后最好重启一遍系统")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/security/limits.d/20-nproc.conf\nnginx   soft    nproc   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\nnginx   hard    nproc   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\nnginx   soft    nofile  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\nnginx   hard    nofile  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n")])])]),s("h2",{attrs:{id:"编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[t._v("#")]),t._v(" 编译")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx_path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/nginx/u01/nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/src\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/src\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4")]),t._v(" http://nginx.org/download/nginx-1.18.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf nginx-1.18.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.18.0\n./configure "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.pid "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.lock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/error.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/access.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_gzip_static_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-pcre "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-file-aio "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_realip_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_v2_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-stream\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h2",{attrs:{id:"服务端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端口"}},[t._v("#")]),t._v(" 服务端口")]),t._v(" "),s("p",[t._v("非 "),s("code",[t._v("root")]),t._v(" 用户不能使用 "),s("code",[t._v("1024")]),t._v(" 以下的端口，有2种解决办法")]),t._v(" "),s("h3",{attrs:{id:"sudo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sudo"}},[t._v("#")]),t._v(" sudo")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n")])])]),s("h3",{attrs:{id:"iptables端口转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iptables端口转发"}},[t._v("#")]),t._v(" iptables端口转发")]),t._v(" "),s("p",[t._v("重定向 "),s("code",[t._v("80")]),t._v(" 端口到 "),s("code",[t._v("8888")]),t._v(" 端口")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-A")]),t._v(" PREROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" eth0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--dport")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-j")]),t._v(" REDIRECT --to-port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" INPUT "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--dport")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-j")]),t._v(" ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iptables-save > /etc/sysconfig/iptables"')]),t._v("\n")])])]),s("p",[t._v("如果开启了 "),s("code",[t._v("SELinux")]),t._v(" ，查看允许的 "),s("code",[t._v("http")]),t._v(" 端口")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" semanage port "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" http_port_t\n")])])]),s("p",[t._v("输出结果")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http_port_t                    tcp      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("488")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8008")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8009")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8443")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\n")])])]),s("p",[s("code",[t._v("8888")]),t._v(" 端口不在允许范围内，添加 "),s("code",[t._v("8888")]),t._v(" 端口")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" semanage port "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" http_port_t "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" tcp "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])]),s("p",[t._v("配置完成之后，可以修改 "),s("code",[t._v("Nginx")]),t._v(" 配置文件的监听端口为 "),s("code",[t._v("8888")]),t._v(" ，然后直接访问服务器的 "),s("code",[t._v("80")]),t._v(" 端口即可")]),t._v(" "),s("h2",{attrs:{id:"配置文件语法高亮"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件语法高亮"}},[t._v("#")]),t._v(" 配置文件语法高亮")]),t._v(" "),s("h3",{attrs:{id:"针对所有用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#针对所有用户"}},[t._v("#")]),t._v(" 针对所有用户")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://www.vim.org/scripts/download_script.php?src_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19394")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" /usr/share/vim/vim74/syntax/nginx.vim\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /usr/share/vim/vim74/filetype.vim\n")])])]),s("p",[t._v("在 "),s("code",[t._v("filetype.vim")]),t._v(" 追加一行，添加 "),s("code",[t._v("nginx")]),t._v(" 配置文件路径")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("au BufRead,BufNewFile /etc/nginx/*,/etc/nginx/conf.d/*,/home/nginx/u01/nginx-1.13.12/conf/*,/home/nginx/u01/nginx-1.13.12/conf.d/* "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("ft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" setfiletype nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" endif\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[s("code",[t._v("nginx")]),t._v(" 配置文件路径一定是绝对路径，不能包含软链接")])]),t._v(" "),s("h3",{attrs:{id:"针对普通用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#针对普通用户"}},[t._v("#")]),t._v(" 针对普通用户")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" ~/.vim/syntax/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://www.vim.org/scripts/download_script.php?src_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19394")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" ~/.vim/syntax/nginx.vim\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" ~/.vim/filetype.vim\n")])])]),s("p",[t._v("同样添加 "),s("code",[t._v("nginx")]),t._v(" 配置文件路径")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("au BufRead,BufNewFile /etc/nginx/*,/etc/nginx/conf.d/*,/home/www/u01/nginx-1.13.12/conf/*,/home/www/u01/nginx-1.13.12/conf.d/* "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("ft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" setfiletype nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" endif\n")])])]),s("h2",{attrs:{id:"在root下安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在root下安装"}},[t._v("#")]),t._v(" 在root下安装")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx_path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/root/u01/nginx\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" prce pcre-devel openssl openssl-devel policycoreutils-python gcc gcc-c++ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/src\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("$\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4O")]),t._v(" nginx-1.18.0.tar.gz https://nginx.org/download/nginx-1.18.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf nginx-1.18.0.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nginx-1.18.0\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4O")]),t._v(" nginx-http-flv-module-1.2.10.tar.gz https://github.com/winshining/nginx-http-flv-module/archive/refs/tags/v1.2.10.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf nginx-http-flv-module-1.2.10.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" nginx-http-flv-module-1.2.10 nginx-http-flv-module\n./configure "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.pid "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.lock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/error.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/access.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_gzip_static_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-pcre "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-file-aio "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_realip_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_v2_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_flv_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-stream "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-stream_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--add-module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-http-flv-module\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n")])])]),s("p",[t._v("安装完成后，默认用户是编译时指定的"),s("code",[t._v("root")]),t._v("，如果改成其他，目录权限也需对应，否则出现"),s("code",[t._v("403 Forbidden")]),t._v("拒绝访问")]),t._v(" "),s("h2",{attrs:{id:"tengine安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tengine安装"}},[t._v("#")]),t._v(" Tengine安装")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx_path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/root/u01/nginx\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" prce pcre-devel openssl openssl-devel policycoreutils-python gcc gcc-c++ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/src\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("$\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4O")]),t._v(" tengine-2.3.3.tar.gz http://tengine.taobao.org/download/tengine-2.3.3.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf tengine-2.3.3.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" tengine-2.3.3\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4O")]),t._v(" nginx-http-flv-module-1.2.10.tar.gz https://github.com/winshining/nginx-http-flv-module/archive/refs/tags/v1.2.10.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf nginx-http-flv-module-1.2.10.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" nginx-http-flv-module-1.2.10 nginx-http-flv-module\n./configure "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.pid "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/run/nginx.lock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/error.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nginx_path")]),t._v("/logs/access.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_gzip_static_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_stub_status_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-pcre "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-file-aio "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_realip_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_v2_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-http_flv_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-stream "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--with-stream_ssl_module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--add-module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-http-flv-module\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用日志分割功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用日志分割功能"}},[t._v("#")]),t._v(" 使用日志分割功能")]),t._v(" "),s("p",[t._v("安装"),s("code",[t._v("cronolog")]),t._v("日志分割工具，需要配置"),s("code",[t._v("epel")]),t._v("源")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" cronolog\n")])])]),s("p",[t._v("日志分割配置")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ...\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v(" wwwlogs "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),t._v(",,"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr,,SERVER_IPADDR,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_time_msec,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_user,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_iso8601,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")]),t._v("://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(",,"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent,,")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for,,PROJECT_CODE")]),t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ...\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pipe:/usr/sbin/cronolog /5w/nginx/logs/ywtg/%Y-%m-%d-access_http_log"')]),t._v(" wwwlogs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_log")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pipe:/usr/sbin/cronolog /5w/nginx/logs/ywtg/%Y-%m-%d-error_log"')]),t._v(" warn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("注意：日志路径必须是绝对路径，相对路径会生成日志到Nginx可执行文件目录下")])]),t._v(" "),s("h2",{attrs:{id:"nginx命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx命令"}},[t._v("#")]),t._v(" nginx命令")]),t._v(" "),s("h3",{attrs:{id:"查看命令帮助"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看命令帮助"}},[t._v("#")]),t._v(" 查看命令帮助")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v("\nnginx version: nginx/1.13.12\nUsage: nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-?hvVtTq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-s signal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-c filename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-p prefix"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-g directives"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nOptions:\n  -?,-h         "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" this "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" show version and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-V")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" show version and configure options "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" configuration and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-T")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" configuration, dump it and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" suppress non-error messages during configuration testing\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" signal     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" send signal to a master process: stop, quit, reopen, reload\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" prefix     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" prefix path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: /home/www/u01/nginx-1.13.12/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" filename   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: conf/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-g")]),t._v(" directives "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" global directives out of configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n")])])]),s("h3",{attrs:{id:"查看nginx版本和编译参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看nginx版本和编译参数"}},[t._v("#")]),t._v(" 查看Nginx版本和编译参数")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-V")]),t._v("\nnginx version: nginx/1.13.12\nbuilt by gcc "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.8")]),t._v(".5 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20150623")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Red Hat "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.8")]),t._v(".5-28"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GCC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nbuilt with OpenSSL "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(".2k-fips  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" Jan "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2017")]),t._v("\nTLS SNI support enabled\nconfigure arguments: "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/www/u01/nginx-1.13.12 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("www "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("www --pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/www/u01/nginx-1.13.12/run/nginx.pid --lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/www/u01/nginx-1.13.12/run/nginx.lock --error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/www/u01/nginx-1.13.12/logs/error.log --http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/www/u01/nginx-1.13.12/logs/access.log --with-http_ssl_module --with-http_stub_status_module --with-http_gzip_static_module --with-http_stub_status_module --with-pcre --with-file-aio --with-http_realip_module --with-http_v2_module --with-stream\n")])])]),s("h3",{attrs:{id:"检查配置文件语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查配置文件语法"}},[t._v("#")]),t._v(" 检查配置文件语法")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -T 检查配置文件语法，输出完整配置文件内容，并展开 include 的内容")]),t._v("\nnginx: the configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /home/www/u01/nginx-1.13.12/conf/nginx.conf syntax is ok\nnginx: configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /home/www/u01/nginx-1.13.12/conf/nginx.conf "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" is successful\n")])])]),s("h3",{attrs:{id:"给主进程发送信号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#给主进程发送信号"}},[t._v("#")]),t._v(" 给主进程发送信号")]),t._v(" "),s("p",[t._v("快速关闭 "),s("code",[t._v("Nginx")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" stop\n")])])]),s("p",[t._v("优雅关闭 "),s("code",[t._v("Nginx")]),t._v(" ，停止接收连接请求，并等待已接收连接处理完成之后才退出")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" quit\n")])])]),s("p",[s("code",[t._v("Nginx")]),t._v(" 服务运行时重新打开日志，一般在手动切割日志时使用")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reopen\n")])])]),s("p",[t._v("重载 "),s("code",[t._v("Nginx")]),t._v(" 配置")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("h3",{attrs:{id:"启动时指定配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动时指定配置文件"}},[t._v("#")]),t._v(" 启动时指定配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /usr/local/nginx/conf/nginx.conf\n")])])]),s("h2",{attrs:{id:"ffmpeg安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ffmpeg安装"}},[t._v("#")]),t._v(" ffmpeg安装")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" epel-release\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Uvh")]),t._v(" http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" x264-devel\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-4")]),t._v(" https://www.ffmpeg.org/releases/ffmpeg-4.1.8.tar.gz --no-check-certificate\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf ffmpeg-4.1.8.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ffmpeg-4.1.8\n./configure "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/ffmpeg --enable-gpl --enable-shared --enable-libx264 --disable-x86asm\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$a /usr/local/ffmpeg/lib/'")]),t._v(" /etc/ld.so.conf\nldconfig\n\n/usr/local/ffmpeg/bin/ffmpeg "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-version")]),t._v("\n")])])]),s("h2",{attrs:{id:"rtmp配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rtmp配置"}},[t._v("#")]),t._v(" rtmp配置")]),t._v(" "),s("p",[t._v("rtmp.conf")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_auto_push")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_auto_push_reconnect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1s")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_socket_dir")]),t._v(" /tmp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("out_queue")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("out_cork")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timeout")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15s")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("drop_idle_publisher")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15s")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5s")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log 模块在 libfdk_aacess.log 中记录日志的间隔时间，对调试非常有用")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_size")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1m")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log 模块用来记录日志的缓冲区大小")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1935")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        server_name www.test.*; #用于虚拟主机名后缀通配")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("application")]),t._v(" jdp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gop_cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#打开 GOP 缓存，减少首屏等待时间")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#record all;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#record_unique on;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#record_max_size 500M;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#record_path /5w/nginx/html/rtmp/record;")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#record_suffix -%Y-%m-%d-%H_%M_%S.flv;")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),t._v(" /usr/local/ffmpeg/bin/ffmpeg -i rtmp://localhost:1935/jdp/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),t._v(" -i /5w/nginx/html/rtmp/images/td1.png -filter_complex "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay=10:10,split=1[td1]"')]),t._v(" -map "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[td1]'")]),t._v(" -map 0:a -s 1280x720 -c:v libx264 -c:a aac -g "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -r "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -tune zerolatency -preset veryfast -crf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" -f flv rtmp://localhost:1935/live/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name_td1")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),t._v(" /usr/local/ffmpeg/bin/ffmpeg -i rtmp://localhost:1935/jdp/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),t._v(" -i /5w/nginx/html/rtmp/images/td2.png -filter_complex "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay=10:10,split=1[td2]"')]),t._v(" -map "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[td2]'")]),t._v(" -map 0:a -s 1280x720 -c:v libx264 -c:a aac -g "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -r "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -tune zerolatency -preset veryfast -crf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" -f flv rtmp://localhost:1935/live/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name_td2")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),t._v(" /usr/local/ffmpeg/bin/ffmpeg -i rtmp://localhost:1935/jdp/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name")]),t._v(" -i /5w/nginx/html/rtmp/images/td3.png -filter_complex "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay=10:10,split=1[td3]"')]),t._v(" -map "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[td3]'")]),t._v(" -map 0:a -s 1280x720 -c:v libx264 -c:a aac -g "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -r "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -tune zerolatency -preset veryfast -crf "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" -f flv rtmp://localhost:1935/live/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$name_td3")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("application")]),t._v(" live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gop_cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("application")]),t._v(" hls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hls_path")]),t._v(" /5w/nginx/html/rtmp/hls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("application")]),t._v(" dash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("dash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("dash_path")]),t._v(" /5w/nginx/html/rtmp/dash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("rtmp_http.conf")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("81")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /flv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("flv_live")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#打开 HTTP 播放 FLV 直播流功能")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("chunked_transfer_encoding")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#支持 'Transfer-Encoding: chunked' 方式回复")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加额外的 HTTP 头")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Credentials'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加额外的 HTTP 头")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /hls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("types")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("application/vnd.apple.mpegurl")]),t._v(" m3u8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("video/mp2t")]),t._v(" ts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /5w/nginx/html/rtmp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-cache'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /dash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /5w/nginx/html/rtmp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-cache'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /stat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#推流播放和录制统计数据的配置")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_stat")]),t._v(" all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_stat_stylesheet")]),t._v(" stat.xsl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /stat.xsl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /5w/nginx/html/rtmp/stat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定 stat.xsl 的位置")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#如果需要 JSON 风格的 stat, 不用指定 stat.xsl")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#但是需要指定一个新的配置项 rtmp_stat_format")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location /stat {")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    rtmp_stat all;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    rtmp_stat_format json;")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /control")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rtmp_control")]),t._v(" all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#rtmp 控制模块的配置")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);