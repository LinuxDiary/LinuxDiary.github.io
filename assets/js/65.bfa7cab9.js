(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{266:function(e,v,_){"use strict";_.r(v);var t=_(6),a=Object(t.a)({},(function(){var e=this,v=e._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"memcached基础"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#memcached基础"}},[e._v("#")]),e._v(" Memcached基础")]),e._v(" "),v("h2",{attrs:{id:"安装"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),v("h3",{attrs:{id:"安装依赖"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[e._v("#")]),e._v(" 安装依赖")]),e._v(" "),v("div",{staticClass:"language-shell extra-class"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[v("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" yum "),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" libevent-devel\n")])])]),v("p",[e._v("也可以编译源码安装 "),v("code",[e._v("libevent")]),e._v(" ，如果编译安装，则需要在安装 "),v("code",[e._v("Memcached")]),e._v(" 时需要指定 "),v("code",[e._v("libevent")]),e._v(" 路径，例如 "),v("code",[e._v("--with-libevent=/usr/local/libevent")])]),e._v(" "),v("h3",{attrs:{id:"安装-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),v("div",{staticClass:"language-shell extra-class"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[v("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" ~/u01/memcached/src\n"),v("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" ~/u01/memcached/src\n"),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" http://www.memcached.org/files/memcached-1.5.10.tar.gz\n"),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" xf memcached-1.5.10.tar.gz\n"),v("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" memcached-1.5.10\n./configure "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--prefix")]),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/home/www/u01/memcached\n"),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n")])])]),v("h3",{attrs:{id:"常用启动参数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#常用启动参数"}},[e._v("#")]),e._v(" 常用启动参数")]),e._v(" "),v("p",[e._v("启动方式")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("memcached -d -m 256m -c 200 -p 11211 -P memcached.pid\n")])])]),v("p",[e._v("使用 "),v("code",[e._v("-v/-vv/-vvv")]),e._v(" 选项开启日志，或者重定向到文件中")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("memcached -d -m 256m -c 200 -p 11211 -P memcached.pid -v >> mem.log 2>&1\n")])])]),v("ul",[v("li",[e._v("-p: 指定服务的 "),v("code",[e._v("TCP")]),e._v(" 端口号")]),e._v(" "),v("li",[e._v("-s: 使用 "),v("code",[e._v("socket")]),e._v(" 方式启动，指定 "),v("code",[e._v("socket")]),e._v(" 路径")]),e._v(" "),v("li",[e._v("-A: 启用 "),v("code",[e._v("shutdown")]),e._v(" 命令，命令行客户端中可使用 "),v("code",[e._v("shutdown")]),e._v(" 关闭 "),v("code",[e._v("memcached")]),e._v(" 服务")]),e._v(" "),v("li",[e._v("-l: 指定监听的 "),v("code",[e._v("IP")])]),e._v(" "),v("li",[e._v("-d: 以守护进程方式运行")]),e._v(" "),v("li",[e._v("-u: 指定用户(root)")]),e._v(" "),v("li",[e._v("-m: 指定最大可用内存")]),e._v(" "),v("li",[e._v("-c: 指定最大并发连接数，默认 "),v("code",[e._v("1024")])]),e._v(" "),v("li",[e._v("-P: 指定 "),v("code",[e._v("pid")]),e._v(" 文件路径")]),e._v(" "),v("li",[e._v("-f: 指定自增长因子，默认是 "),v("code",[e._v("1.25")])]),e._v(" "),v("li",[e._v("-n: 设置最小 "),v("code",[e._v("slab size")]),e._v(" ，默认是 "),v("code",[e._v("48 byte")]),e._v(" ，加上 "),v("code",[e._v("64")]),e._v(" 位机器的 "),v("code",[e._v("item")]),e._v(" 大小 "),v("code",[e._v("48 byte")]),e._v(" ，共同构成 "),v("code",[e._v("chunk")]),e._v(" 的默认初始大小 "),v("code",[e._v("96 byte")])])]),e._v(" "),v("h2",{attrs:{id:"常用命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[e._v("#")]),e._v(" 常用命令")]),e._v(" "),v("ul",[v("li",[e._v("set 新增一个 "),v("code",[e._v("item")]),e._v(" ， "),v("code",[e._v("set key flags exTime length")]),e._v(" -> "),v("code",[e._v("value")]),e._v(" ，可以直接插入，不管 "),v("code",[e._v("key")]),e._v(" 是否存在")]),e._v(" "),v("li",[e._v("add 只有当 "),v("code",[e._v("key")]),e._v(" 不存在时才能插入，"),v("code",[e._v("add key flags exTime length")]),e._v(" -> "),v("code",[e._v("value")])]),e._v(" "),v("li",[e._v("replace 只能修改已存在的 "),v("code",[e._v("key")]),e._v(" ，如果 "),v("code",[e._v("key")]),e._v(" 不存在，则不执行操作")]),e._v(" "),v("li",[e._v("append 在 "),v("code",[e._v("key")]),e._v(" 的 "),v("code",[e._v("value")]),e._v(" 后面追加内容， "),v("code",[e._v("length")]),e._v(" 是追加的长度")]),e._v(" "),v("li",[e._v("prepend 在 "),v("code",[e._v("key")]),e._v(" 的 "),v("code",[e._v("value")]),e._v(" 前面追加内容， "),v("code",[e._v("length")]),e._v(" 是追加的长度")]),e._v(" "),v("li",[e._v("get 获取 "),v("code",[e._v("key")]),e._v(" 的值")]),e._v(" "),v("li",[e._v("cas "),v("code",[e._v("check and set")]),e._v(" ， 检查版本号是否正确，然后执行操作， "),v("code",[e._v("cas key flags exTime length unique_cas_token")]),e._v(" -> "),v("code",[e._v("value")])]),e._v(" "),v("li",[e._v("gets 获取带有 "),v("code",[e._v("unique_cas_token")]),e._v(" 的 "),v("code",[e._v("item")]),e._v(" 值")]),e._v(" "),v("li",[e._v("delete 删除 "),v("code",[e._v("key")]),e._v(" ，给 "),v("code",[e._v("key")]),e._v(" 打上 "),v("code",[e._v("delete")]),e._v(" 标签，并非真正删除")]),e._v(" "),v("li",[e._v("incr/decr 对 "),v("code",[e._v("key")]),e._v(" 进行自增长或自减少， "),v("code",[e._v("incr/decr key increment_value")]),e._v(" ，只能对无符号的整数执行操作")]),e._v(" "),v("li",[e._v("flush_all 清理缓存中的所有数据，危险操作，尽量不使用")])]),e._v(" "),v("h2",{attrs:{id:"常用状态信息"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#常用状态信息"}},[e._v("#")]),e._v(" 常用状态信息")]),e._v(" "),v("p",[e._v("通过 "),v("code",[e._v("stats")]),e._v(" 命令查看 "),v("code",[e._v("Memcached")]),e._v(" 整体状态信息")]),e._v(" "),v("p",[v("strong",[e._v("命中率相关")])]),e._v(" "),v("ul",[v("li",[e._v("cmd_get 总 "),v("code",[e._v("get")]),e._v(" 次数  "),v("code",[e._v("cmd_get=get_hits+get_misses")])]),e._v(" "),v("li",[e._v("get_hits    命中次数")]),e._v(" "),v("li",[e._v("get_misses  未命中次数")])]),e._v(" "),v("p",[e._v("命中率通过 "),v("code",[e._v("get_hits/cmd_get")]),e._v(" 计算获得")]),e._v(" "),v("p",[v("strong",[e._v("数据量相关")])]),e._v(" "),v("ul",[v("li",[e._v("curr_items  当前可用的 "),v("code",[e._v("item")]),e._v(" 数量")]),e._v(" "),v("li",[e._v("total_items 从系统运行起的 "),v("code",[e._v("item")]),e._v(" 总量")]),e._v(" "),v("li",[e._v("evictions   "),v("code",[e._v("LRU")]),e._v(" 释放的 "),v("code",[e._v("item")]),e._v(" 总量，如果此项过高，说明已经没有 "),v("code",[e._v("chunk")]),e._v(" 可用，原因可能是 "),v("code",[e._v("chunk")]),e._v(" 大小分配不合理或内存用尽")]),e._v(" "),v("li",[e._v("bytes       当前所占用的存储空间")]),e._v(" "),v("li",[e._v("bytes_read  读取的总字节数")]),e._v(" "),v("li",[e._v("bytes_written   写入的总字节数")])]),e._v(" "),v("p",[v("strong",[e._v("资源使用相关")])]),e._v(" "),v("ul",[v("li",[e._v("rusage_user     进程累计的执行命令时间")]),e._v(" "),v("li",[e._v("rusage_system   进程累计使用系统 "),v("code",[e._v("CPU")]),e._v(" 的时间")])]),e._v(" "),v("h3",{attrs:{id:"stats相关其他命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#stats相关其他命令"}},[e._v("#")]),e._v(" stats相关其他命令")]),e._v(" "),v("ul",[v("li",[e._v("stats items : 各个 "),v("code",[e._v("slab")]),e._v(" 中 "),v("code",[e._v("item")]),e._v(" 的数目和存储时长")]),e._v(" "),v("li",[e._v("stats slabs : 显示各个 "),v("code",[e._v("slab")]),e._v(" 的详细信息，包括 "),v("code",[e._v("chunk")]),e._v(" 大小和数量等详细信息")])]),e._v(" "),v("h2",{attrs:{id:"调优"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#调优"}},[e._v("#")]),e._v(" 调优")]),e._v(" "),v("h3",{attrs:{id:"chunk的使用机制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#chunk的使用机制"}},[e._v("#")]),e._v(" Chunk的使用机制")]),e._v(" "),v("p",[v("code",[e._v("Memcached")]),e._v(" 中使用 "),v("code",[e._v("Chunk")]),e._v(" 的机制是优先使用 "),v("code",[e._v("Slot")]),e._v(" 中的 "),v("code",[e._v("Chunk")]),e._v(" ，其中 "),v("code",[e._v("Slot")]),e._v(" 中是被删除数据或过期数据释放的 "),v("code",[e._v("Chunk")]),e._v(" 。"),v("code",[e._v("Slot")]),e._v(" 中用尽以后，再去 "),v("code",[e._v("Slab")]),e._v(" 中申请新的 "),v("code",[e._v("Chunk")]),e._v(" ，直到所有 "),v("code",[e._v("Chunk")]),e._v(" 用尽，用尽之后会启用 "),v("code",[e._v("LRU")]),e._v(" 机制，释放最近最少使用的 "),v("code",[e._v("Chunk")]),e._v(" 空间， "),v("code",[e._v("Memcached")]),e._v(" 并不会使用不匹配 "),v("code",[e._v("item")]),e._v(" 大小的其他空闲 "),v("code",[e._v("Chunk")]),e._v(" ，因此需要调整初始 "),v("code",[e._v("Chunk")]),e._v(" 大小和自增长因子。")]),e._v(" "),v("p",[v("strong",[e._v("内存浪费的几种情况")])]),e._v(" "),v("ul",[v("li",[v("code",[e._v("Chunk")]),e._v(" 总是不能被存满")]),e._v(" "),v("li",[e._v("热点数据无法命中位于中间位置的 "),v("code",[e._v("Chunk")])]),e._v(" "),v("li",[v("code",[e._v("Slab")]),e._v(" 不能被 "),v("code",[e._v("Page")]),e._v(" 整除")]),e._v(" "),v("li",[v("code",[e._v("Page")]),e._v(" 不能被 "),v("code",[e._v("Chunk")]),e._v(" 整除")])]),e._v(" "),v("p",[v("code",[e._v("Memcached")]),e._v(" 调优多数情况下是调整 "),v("code",[e._v("Chunk")]),e._v(" 大小和 自增长因子，通过具体的业务情况，计算主要的 "),v("code",[e._v("Chunk")]),e._v(" 分布情况，然后根据分布情况调整初始 "),v("code",[e._v("Chunk")]),e._v(" 大小和自增长因子，例如")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("memcached -d -m 256m -n 32 -f 1.1 \n")])])]),v("h2",{attrs:{id:"限制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#限制"}},[e._v("#")]),e._v(" 限制")]),e._v(" "),v("ul",[v("li",[e._v("不提供持久化机制")]),e._v(" "),v("li",[e._v("数据最多保存 "),v("code",[e._v("30")]),e._v(" 天，无论 "),v("code",[e._v("Memcached")]),e._v(" 进程是否终止")]),e._v(" "),v("li",[e._v("不提供安全机制，一般配合防火墙使用")]),e._v(" "),v("li",[v("code",[e._v("key")]),e._v(" 的最大长度为 "),v("code",[e._v("250 byte")])]),e._v(" "),v("li",[e._v("单个 "),v("code",[e._v("item")]),e._v(" 最大长度为 "),v("code",[e._v("1m")])]),e._v(" "),v("li",[e._v("不提供冗余机制")])]),e._v(" "),v("h2",{attrs:{id:"参考链接"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://www.jianshu.com/p/59b4e61f61d2",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.jianshu.com/p/59b4e61f61d2"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=a.exports}}]);