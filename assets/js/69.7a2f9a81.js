(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{273:function(a,s,t){"use strict";t.r(s);var e=t(6),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("ul",[s("li",[a._v("系统环境： CentOS 7")]),a._v(" "),s("li",[a._v("Python版本： Python 3.6.6")])]),a._v(" "),s("h2",{attrs:{id:"依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[a._v("#")]),a._v(" 依赖")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel gcc "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n")])])]),s("h2",{attrs:{id:"编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[a._v("#")]),a._v(" 编译")]),a._v(" "),s("p",[a._v("编译安装，这里不指定 "),s("code",[a._v("Python 3")]),a._v(" 的安装路径，编译时不带参数，且在 "),s("code",[a._v("root")]),a._v(" 权限下进行安装。这样配置的目的是让其他程序能够找得到 "),s("code",[a._v("Python 3")]),a._v(" 的 "),s("code",[a._v("lib")]),a._v(" 文件和 "),s("code",[a._v("include")]),a._v(" 文件，例如在安装 "),s("code",[a._v("mysqlclient")]),a._v(" 时就需要使用到这些文件，如果指定了安装路径，将可能出现找不到库文件的错误")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tar.xz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xf python-3.6.6.tar.xz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" python-3.6.6\n./configure --enable-optimizations\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n")])])]),s("h2",{attrs:{id:"虚拟环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#虚拟环境"}},[a._v("#")]),a._v(" 虚拟环境")]),a._v(" "),s("h3",{attrs:{id:"virtualenvwrapper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#virtualenvwrapper"}},[a._v("#")]),a._v(" virtualenvwrapper")]),a._v(" "),s("p",[a._v("安装 "),s("code",[a._v("virtualenvwrapper")]),a._v(" "),s("code",[a._v("，CentOS")]),a._v(" 上默认自带 "),s("code",[a._v("Python 2.7")]),a._v(" ，这里使用 "),s("code",[a._v("pip")]),a._v(" 的时候需要确认一下是 "),s("code",[a._v("Python 3")]),a._v(" 的 "),s("code",[a._v("pip")]),a._v(" ，只有这样， "),s("code",[a._v("pip")]),a._v(" 才会将包安装到 "),s("code",[a._v("Python 3")]),a._v(" 的包目录中")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ pip "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-V")]),a._v("\npip "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.0")]),a._v(" from /usr/local/lib/python3.6/site-packages/pip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("python "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("全局安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" pip "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" virtualenvwrapper\n")])])]),s("p",[s("code",[a._v("pip")]),a._v(" 安装默认使用的官方源，速度可能很慢，可以在安装时指定国内 "),s("code",[a._v("pypi")]),a._v(" 源")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ sudo pip install virtualenvwrapper -i https://mirrors.aliyun.com/pypi/simple\n")])])]),s("p",[a._v("也可以修改默认源")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ vi ~/.pip/pip.conf\n[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple/\n\n[install]\ntrusted-host=mirrors.aliyun.com\n")])])]),s("p",[a._v("配置环境变量， "),s("code",[a._v("WORKON_HOME")]),a._v(" 是虚拟环境根目录， "),s("code",[a._v("VIRTUALENVWRAPPER_PYTHON")]),a._v(" 指定了使用哪个 "),s("code",[a._v("Python")]),a._v(" 程序来创建虚拟环境， "),s("code",[a._v("source virtualenvwrapper.sh")]),a._v(" 的目的是加载 "),s("code",[a._v("mkvirtualenv")]),a._v(" "),s("code",[a._v("rmvirtualenv")]),a._v(" "),s("code",[a._v("workon")]),a._v(" 等命令，编辑并重载 "),s("code",[a._v("~/.bashrc")]),a._v(" 文件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("WORKON_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$HOME")]),a._v("/.local\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("VIRTUALENVWRAPPER_PYTHON")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/local/bin/python3\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /usr/local/bin/virtualenvwrapper.sh\n")])])]),s("p",[a._v("编辑完成之后重新加载一下 "),s("code",[a._v("~/.bashrc")])]),a._v(" "),s("p",[a._v("常用命令")]),a._v(" "),s("ul",[s("li",[a._v("mkvirtualenv: 在虚拟环境根目录 WORKON_HOME 下创建虚拟环境")]),a._v(" "),s("li",[a._v("rmvirtualenv: 删除虚拟环境")]),a._v(" "),s("li",[a._v("workon: 列出或切换到指定虚拟环境")]),a._v(" "),s("li",[a._v("deactivate: 退出虚拟环境")])]),a._v(" "),s("p",[a._v("切换到虚拟环境后，会出现类似如下提示符")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("venv_django_11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("www@localhost python"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$\n")])])]),s("p",[a._v("在该环境下使用 "),s("code",[a._v("pip")]),a._v(" 安装的包都只属于虚拟环境，虚拟环境之间相互独立。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("在 "),s("code",[a._v("~/.bashrc")]),a._v(" 或 "),s("code",[a._v("~/.zshrc")]),a._v(" 中添加以下内容可以实现 "),s("code",[a._v("pip")]),a._v(" 命令自动补全")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("pip completion "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zsh")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('"')]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## .zshrc")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("eval")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("pip completion "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bash")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v('"')]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## .bashrc")]),a._v("\n")])])])]),a._v(" "),s("h3",{attrs:{id:"pipenv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipenv"}},[a._v("#")]),a._v(" pipenv")]),a._v(" "),s("p",[a._v("首先确认 "),s("code",[a._v("pip")]),a._v(" 的位置")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ pip "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-V")]),a._v("\npip "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.0")]),a._v(" from /usr/local/lib/python3.6/site-packages/pip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("python "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("全局安装 "),s("code",[a._v("pipenv")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" pip "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" pipenv\n")])])]),s("p",[a._v("切到项目目录下，直接运行 "),s("code",[a._v("pipenv shell")]),a._v(" 命令，会自动创建虚拟环境")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Creating a virtualenv for this project…\nPipfile: /home/nginx/u01/hola/Pipfile\nUsing /usr/local/bin/python3 (3.6.6) to create virtualenv…\n⠙ Creating virtual environment...Using base prefix '/usr/local'\nNew python executable in /home/nginx/.local/share/virtualenvs/hola-2pee34yt/bin/python3\nAlso creating executable in /home/nginx/.local/share/virtualenvs/hola-2pee34yt/bin/python\nInstalling setuptools, pip, wheel...\ndone.\nRunning virtualenv with interpreter /usr/local/bin/python3\n\n✔ Successfully created virtual environment!\n")])])]),s("p",[a._v("如果需要更换 "),s("code",[a._v("pip")]),a._v(" 源，可以编辑 "),s("code",[a._v("Pipfile")]),a._v(" 文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('url = "https://pypi.doubanio.com/simple/"\n')])])]),s("p",[a._v("常用命令")]),a._v(" "),s("ul",[s("li",[a._v("install 安装程序包，并自动绑定包依赖关系")]),a._v(" "),s("li",[a._v("uninstall 解除安装，解绑依赖关系")]),a._v(" "),s("li",[a._v("shell 在当前目录下启动虚拟环境")]),a._v(" "),s("li",[a._v("graph 查看包依赖关系")]),a._v(" "),s("li",[a._v("clean 删除不在 Pipfile.lock 中的包")])]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("pipenv 可能存在一些小 bug 或者不兼容性，例如在安装 "),s("code",[a._v("mysqlclient")]),a._v(" 时，可以成功安装，但是在 "),s("code",[a._v("runserver")]),a._v(" 时总是提示找不到 "),s("code",[a._v("Did you install mysqlclient?")]),a._v(" ，但是如果使用 "),s("code",[a._v("pip install mysqlclient")]),a._v(" 安装就没有问题")])]),a._v(" "),s("h2",{attrs:{id:"一些技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些技巧"}},[a._v("#")]),a._v(" 一些技巧")]),a._v(" "),s("h3",{attrs:{id:"autoenv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autoenv"}},[a._v("#")]),a._v(" autoenv")]),a._v(" "),s("p",[a._v("autoenv 可以帮助我们在切换到项目目录时自动加载虚拟环境，首先需要全局安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" pip "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" autoenv\n")])])]),s("p",[a._v("然后编辑 "),s("code",[a._v("~/.bashrc")]),a._v(" 文件，追加以下内容，然后重载一下 "),s("code",[a._v("~/.bashrc")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" activate.sh"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("p",[a._v("然后进入到项目根目录下，创建 "),s("code",[a._v(".env")]),a._v(" 文件，追加进入虚拟环境命令，如果使用的是 "),s("code",[a._v("virtualenvwrapper")]),a._v(" ，则追加以下内容，"),s("code",[a._v("test")]),a._v(" 是创建的虚拟环境名称")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("workon test\n")])])]),s("h3",{attrs:{id:"mysqlclient安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysqlclient安装"}},[a._v("#")]),a._v(" mysqlclient安装")]),a._v(" "),s("p",[a._v("在安装 "),s("code",[a._v("mysqlclient")]),a._v(" 时经常会报错，主要有两种错误(环境是 CentOS 7)")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("OSError: mysql_config not found\n")])])]),s("p",[a._v("解决该问题需要安装 MySQL 开发包，比如 CentOS 下可以安装以下包，到官网选择合适的版本")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ivh")]),a._v(" https://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-devel-5.6.42-1.el7.x86_64.rpm\n")])])]),s("p",[a._v("解决了上述问题，还可能出现如下问题")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\n/bin/ld: cannot find -lmysqlclient'\n...\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module.\nDid you install mysqlclient?\n")])])]),s("p",[a._v("意思是找不到 MySQL 的客户端连接库文件，例如 "),s("code",[a._v("/usr/lib64/libmysqlclient.so.18")]),a._v(" 文件，此时需要安装 MySQL 另外一个包 "),s("code",[a._v("MySQL-shared")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ivh")]),a._v(" https://dev.mysql.com/get/Downloads/MySQL-5.6/MySQL-shared-5.6.42-1.el7.x86_64.rpm\n")])])]),s("p",[a._v("重新安装 "),s("code",[a._v("mysqlclient")])])])}),[],!1,null,null,null);s.default=n.exports}}]);