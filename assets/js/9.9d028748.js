(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{183:function(a,t,e){a.exports=e.p+"assets/img/iptables.c06790f8.png"},217:function(a,t,e){"use strict";e.r(t);var s=e(6),r=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[a._v("#")]),a._v(" iptables")]),a._v(" "),t("h2",{attrs:{id:"表和链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#表和链"}},[a._v("#")]),a._v(" 表和链")]),a._v(" "),t("p",[t("code",[a._v("iptables")]),a._v(" 默认有 "),t("code",[a._v("4")]),a._v(" 张表，每张表分别包含了不同的链，表和链的关系如下")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("        +-----------------+     +-----------------+     +-----------------+\n        |                 |     |                 |     |                 |\n        |      Table      | --- |      Chain      | --- |  Rules(Action)  |\n        |                 |     |                 |     |                 |\n        +-----------------+     +-----------------+     +-----------------+\n                 |                       |                       |\n        +-----------------+     +-----------------+     +-----------------+\n        |                 |     |      INPUT      |     |      ACCEPT     |\n        |      filter     | --- |     FORWARD     |     +-----------------+\n        |                 |     |      OUTPUT     |              |\n        +-----------------+     +-----------------+     +-----------------+\n                 |                       |              |       DROP      |\n        +-----------------+     +-----------------+     +-----------------+\n        |                 |     |   PREROUTING    |              |\n        |       nat       | --- |      INPUT      |     +-----------------+\n        |                 |     |      OUTPUT     |     |      REJECT     |\n        |                 |     |   POSTROUTING   |     +-----------------+\n        +-----------------+     +-----------------+              |\n                 |                       |              +-----------------+\n        +-----------------+     +-----------------+     |       SNAT      |\n        |                 |     |   PREROUTING    |     +-----------------+\n        |                 |     |      INPUT      |              |\n        |      mangle     | --- |     FORWARD     |     +-----------------+\n        |                 |     |      OUTPUT     |     |       DNAT      |\n        |                 |     |   POSTROUTING   |     +-----------------+\n        +-----------------+     +-----------------+              |\n                 |                       |              +-----------------+\n        +-----------------+     +-----------------+     |    MASQUERADE   |\n        |       raw       | --- |      OUTPUT     |     +-----------------+\n        |                 |     |    PREROUTING   |              |\n        +-----------------+     +-----------------+     +-----------------+\n                                                        |     REDIRECT    |\n                                                        +-----------------+\n                                                                 |\n                                                        +-----------------+\n                                                        |       LOG       |\n                                                        +-----------------+\n")])])]),t("p",[a._v("数据表在 "),t("code",[a._v("iptables")]),a._v(" 中的匹配流程和规则")]),a._v(" "),t("p",[t("img",{attrs:{src:e(183),alt:"iptables.png"}})]),a._v(" "),t("p",[a._v("图中反映了数据包的流向，同时也反映了同一个链中表的优先级，优先级由高到低 "),t("code",[a._v("raw -> mangle -> nat -> filter")])]),a._v(" "),t("h2",{attrs:{id:"常用选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用选项"}},[a._v("#")]),a._v(" 常用选项")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("选项")]),a._v(" "),t("th",[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("-t")]),a._v(" "),t("td",[a._v("指定要操纵的表")])]),a._v(" "),t("tr",[t("td",[a._v("-A")]),a._v(" "),t("td",[a._v("向规则链中添加条目")])]),a._v(" "),t("tr",[t("td",[a._v("-D")]),a._v(" "),t("td",[a._v("从规则链中删除条目")])]),a._v(" "),t("tr",[t("td",[a._v("-I")]),a._v(" "),t("td",[a._v("向规则链中插入条目")])]),a._v(" "),t("tr",[t("td",[a._v("-R")]),a._v(" "),t("td",[a._v("替换规则链中的条目")])]),a._v(" "),t("tr",[t("td",[a._v("-L")]),a._v(" "),t("td",[a._v("显示规则链中已有的条目")])]),a._v(" "),t("tr",[t("td",[a._v("-F")]),a._v(" "),t("td",[a._v("清楚规则链中已有的条目")])]),a._v(" "),t("tr",[t("td",[a._v("-Z")]),a._v(" "),t("td",[a._v("清空规则链中的数据包计算器和字节计数器")])]),a._v(" "),t("tr",[t("td",[a._v("-X")]),a._v(" "),t("td",[a._v("删除用户自定义的空链")])]),a._v(" "),t("tr",[t("td",[a._v("-N")]),a._v(" "),t("td",[a._v("创建新的用户自定义规则链")])]),a._v(" "),t("tr",[t("td",[a._v("-P")]),a._v(" "),t("td",[a._v("定义规则链中的默认目标")])]),a._v(" "),t("tr",[t("td",[a._v("-n")]),a._v(" "),t("td",[a._v("不显示服务名，只显示端口号")])]),a._v(" "),t("tr",[t("td",[a._v("-p")]),a._v(" "),t("td",[a._v("指定要匹配的数据包协议类型")])]),a._v(" "),t("tr",[t("td",[a._v("-s")]),a._v(" "),t("td",[a._v("指定要匹配的数据包源ip地址")])]),a._v(" "),t("tr",[t("td",[a._v("-j")]),a._v(" "),t("td",[a._v("指定动作")])]),a._v(" "),t("tr",[t("td",[a._v("-i")]),a._v(" "),t("td",[a._v("指定数据包进入本机的网络接口")])]),a._v(" "),t("tr",[t("td",[a._v("-o")]),a._v(" "),t("td",[a._v("指定数据包离开本机的网络接口")])])])]),a._v(" "),t("h2",{attrs:{id:"命令基本语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令基本语法"}},[a._v("#")]),a._v(" 命令基本语法")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" 表名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-A/I/D/R"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 规则链名 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("规则号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-i/o 网卡名"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 协议名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-s 源IP/源子网"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" 源端口 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-d 目标IP/目标子网"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" 目标端口 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" 动作\n")])])]),t("p",[a._v("使用 "),t("code",[a._v("iptables")]),a._v(" 命令创建或更新的规则是临时生效，如果需要永久保存可以使用以下命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"iptables-save > /etc/sysconfig/iptables"')]),a._v("\n")])])]),t("h2",{attrs:{id:"防火墙常用策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙常用策略"}},[a._v("#")]),a._v(" 防火墙常用策略")]),a._v(" "),t("h3",{attrs:{id:"filter表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filter表"}},[a._v("#")]),a._v(" filter表")]),a._v(" "),t("p",[a._v("设置默认规则，默认允许数据包通过 "),t("code",[a._v("INPUT")]),a._v(" "),t("code",[a._v("FORWARD")]),a._v(" "),t("code",[a._v("OUTPUT")]),a._v(" 链")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" INPUT ACCEPT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" OUTPUT ACCEPT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" FORWARD ACCEPT\n")])])]),t("p",[a._v("允许相关连接和已建立连接的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" RELATED,ESTABLISHED "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("允许 "),t("code",[a._v("ping")]),a._v(" ，即允许 "),t("code",[a._v("icmp")]),a._v(" 数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" icmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("允许本地环回地址的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" lo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("允许访问 "),t("code",[a._v("22")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("拒绝所有数据包进入以及转发")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT --reject-with icmp-host-prohibited\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT --reject-with icmp-host-prohibited\n")])])]),t("p",[a._v("如下是 "),t("code",[a._v("iptables")]),a._v(" 首次安装时所生成的规则")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n")])])]),t("p",[a._v("允许转发除了 "),t("code",[a._v("icmp")]),a._v(" 以外的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" icmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("允许转发来自 "),t("code",[a._v("192.168.1.0/24")]),a._v(" 网段中除了 "),t("code",[a._v("192.168.1.10")]),a._v(" 的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.10 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("拒绝从 "),t("code",[a._v("eth0")]),a._v(" 接口进入本机的源地址为 "),t("code",[a._v("192.168.1.0/24")]),a._v(" 网段的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" eth0 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\n")])])]),t("p",[a._v("拒绝地址段 "),t("code",[a._v("192.168.1.100-192.168.1.150")]),a._v(" 的数据包访问本机")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" iprange --src-range "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.100-192.168.1.150 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\n")])])]),t("p",[a._v("只允许 "),t("code",[a._v("192.168.1.0/24")]),a._v(" 网段连接 "),t("code",[a._v("22")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\n")])])]),t("p",[a._v("允许访问本机的 "),t("code",[a._v("3000-4000")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":4000 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("允许访问本机的 "),t("code",[a._v("22")]),a._v(" "),t("code",[a._v("443")]),a._v(" "),t("code",[a._v("80")]),a._v(" "),t("code",[a._v("8080")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" multiport "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22,80")]),a._v(",443,8080 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("拒绝来自 "),t("code",[a._v("MAC")]),a._v(" 地址为 "),t("code",[a._v("00:E0:4C:38:86:68")]),a._v(" 的数据包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" mac --mac-source 00:E0:4C:38:86:68 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT\n")])])]),t("h3",{attrs:{id:"nat表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nat表"}},[a._v("#")]),a._v(" nat表")]),a._v(" "),t("p",[a._v("私网地址通过 "),t("code",[a._v("nat")]),a._v(" 地址转换连接互联网，假设私网接口 "),t("code",[a._v("eth0")]),a._v(" ， "),t("code",[a._v("IP 192.168.1.1")]),a._v(" ，公网接口 "),t("code",[a._v("eth1")]),a._v(" ， "),t("code",[a._v("IP 202.103.24.68")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\n")])])]),t("p",[a._v("公网 "),t("code",[a._v("2122")]),a._v(" 端口映射到私网 "),t("code",[a._v("22")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" eth1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("202.103")]),a._v(".24.68 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2122")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-destination "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.100:22\n")])])]),t("p",[a._v("将访问本机的 "),t("code",[a._v("80")]),a._v(" 端口重定向到 "),t("code",[a._v("8888")]),a._v(" 端口，重定向的同时，需要在 "),t("code",[a._v("filter")]),a._v(" 表中允许访问本机 "),t("code",[a._v("8888")]),a._v(" 端口")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" eth1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REDIRECT --to-port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("p",[a._v("SS 中转服务器规则示例, 中转服务器处于 NAT 环境中, 如果是非 NAT 环境, 就将内网地址换成服务器接口上的公网地址")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.40")]),a._v(".55.131 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4433")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-destination "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("54.92")]),a._v(".100.218:443\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.40")]),a._v(".55.131 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4433")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-destination "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("54.92")]),a._v(".100.218:443\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("54.92")]),a._v(".100.218 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SNAT --to-source "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.40")]),a._v(".55.131\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("54.92")]),a._v(".100.218 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" udp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SNAT --to-source "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.40")]),a._v(".55.131\n")])])]),t("h2",{attrs:{id:"官方文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#官方文档"}},[a._v("#")]),a._v(" 官方文档")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://ipset.netfilter.org/iptables.man.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://ipset.netfilter.org/iptables.man.html"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);